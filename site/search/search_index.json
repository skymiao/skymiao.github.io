{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"\u653e\u85aa\u7ba1\u5bb6-\u5357\u4eac\u94f6\u884c-\u90e8\u7f72\u6587\u6863","title":"\u9996\u9875"},{"location":"topological.html","text":"","title":"\u67b6\u6784\u62d3\u6251\u56fe"},{"location":"topological2.html","text":"","title":"\u5e94\u7528\u62d3\u6251\u56fe"},{"location":"manifests/app.html","text":"\u5e94\u7528\u540d \u5206\u7c7b \u7528\u9014 jdk\u7248\u672c gradle\u7248\u672c nanjing-fx-manage \u524d\u7aef \u653e\u85aa\u7ba1\u5bb6\u524d\u7aef fx-payroll \u524d\u7aef \u5de5\u8d44\u6761\u524d\u7aef package-wage \u524d\u7aef \u5c0f\u7a0b\u5e8f\u7ecf\u7406\u524d\u7aef fx-manage-faq \u524d\u7aef \u653e\u85aa\u7ba1\u5bb6FQA cloud-fxdataext \u540e\u7aef \u6570\u636e\u8dd1\u6279\u670d\u52a1 1.8.232 4.9 cloud-gateway \u540e\u7aef \u7edf\u4e00\u7f51\u5173 1.8.232 6.5.1 cloud-zipkin \u540e\u7aef \u94fe\u8def\u8ddf\u8e2a 1.8.232 4.9 data-analysis \u540e\u7aef \u6570\u636e\u7edf\u8ba1 1.8.232 4.9 payroll-service \u540e\u7aef \u5de5\u8d44\u6761 1.8.232 6.5.1 rs-account \u540e\u7aef \u7edf\u4e00\u8d26\u6237 1.8.232 6.2.2 njcb-payroll \u540e\u7aef \u5357\u4eac\u94f6\u884c\u5bf9\u63a5 1.8.232 4.9 njcb-payroll \u540e\u7aef \u5b9a\u65f6\u4efb\u52a1\u8dd1\u6279 1.8.232 4.9 rs-datacount \u540e\u7aef \u6570\u636e\u7edf\u8ba1 1.8.232 4.9 rs-empUpload \u540e\u7aef \u5458\u5de5\u4e0a\u4f20 1.8.232 4.9 rs-ent \u540e\u7aef \u4f01\u4e1a\u670d\u52a1 1.8.232 4.9 rs-fxgj \u540e\u7aef \u653e\u85aa\u7ba1\u5bb6\u6838\u5fc3\u670d\u52a1 1.8.232 4.9 rs-ids \u540e\u7aef \u7edf\u4e00\u8ba4\u8bc1 1.8.232 4.9 rs-manager \u540e\u7aef \u653e\u85aa\u7ecf\u7406 1.8.232 4.9 rs-news \u540e\u7aef \u6d88\u606f\u770b\u677f 1.8.232 6.5.1 rs-operate \u540e\u7aef \u653e\u85aa\u7ba1\u5bb6\u7ba1\u7406\u540e\u53f0 1.8.232 4.9 rs-payroll \u540e\u7aef \u5de5\u8d44\u6761 1.8.232 6.5.1 rs-wage \u540e\u7aef \u4ee3\u53d1\u670d\u52a1 1.8.232 4.9 rs-wageUpload \u540e\u7aef \u5de5\u8d44\u4e0a\u4f20 1.8.232 4.9 wage-service \u540e\u7aef \u4ee3\u53d1\u670d\u52a1 1.8.232 6.5.1","title":"APP\u5e94\u7528"},{"location":"manifests/db.html","text":"\u6570\u636e\u5e93\u4fe1\u606f \u7528\u9014 \u6570\u636e\u7c7b\u578b \u6570\u636e\u5e93\u540d \u7528\u6237 \u5bc6\u7801 mysql \u4e1a\u52a1\u5e93 mysql kayak_nanjingbank nanjing mongo \u4e1a\u52a1\u5e93 mongodb kayaknanjingbank nanjing mongo \u65e5\u5fd7 mongodblogs nanjingbanklogs nanjinglogs mongo \u5206\u6790\u5e93 nanjingbankdatacount nanjingbankdatacount nanjingdata mongo \u6d88\u606f\u5e93 nanjingbanknews nanjingbanknews nanjingnews mongo ids\u7edf\u4e00\u8ba4\u8bc1 nanjingbankids nanjingbankids nanjingids mongo \u7ecf\u653e\u85aa\u7406\u5e93 nanjingbankmanager nanjingbankmanager anjingmanager","title":"\u6570\u636e\u5e93\u4fe1\u606f"},{"location":"manifests/db.html#_1","text":"\u7528\u9014 \u6570\u636e\u7c7b\u578b \u6570\u636e\u5e93\u540d \u7528\u6237 \u5bc6\u7801 mysql \u4e1a\u52a1\u5e93 mysql kayak_nanjingbank nanjing mongo \u4e1a\u52a1\u5e93 mongodb kayaknanjingbank nanjing mongo \u65e5\u5fd7 mongodblogs nanjingbanklogs nanjinglogs mongo \u5206\u6790\u5e93 nanjingbankdatacount nanjingbankdatacount nanjingdata mongo \u6d88\u606f\u5e93 nanjingbanknews nanjingbanknews nanjingnews mongo ids\u7edf\u4e00\u8ba4\u8bc1 nanjingbankids nanjingbankids nanjingids mongo \u7ecf\u653e\u85aa\u7406\u5e93 nanjingbankmanager nanjingbankmanager anjingmanager","title":"\u6570\u636e\u5e93\u4fe1\u606f"},{"location":"manifests/indexes.html","text":"MySQL\u6570\u636e\u5e93\u7d22\u5f15\u6e05\u5355 \u8868\u540d \u7d22\u5f15\u540d \u7d22\u5f15\u5217 account_sign_info PRIMARY account account_sign_info_his PRIMARY account activity_flow_log FKqprjkcu3gs4hnqtlx3n5jpbx9 activity_id activity_flow_log PRIMARY id activity_group FK33e1mme1o7p7kgt1ag6m7wtw4 activity_id activity_group PRIMARY id activity_info PRIMARY id activity_info_answer FKhvxk9932qe221kufmf5g0tpt8 activity_id activity_info_answer PRIMARY id activity_info_rain FKlsby7emocbn8pxu1ckcns6af1 activity_id activity_info_rain PRIMARY id activity_info_random FKdqe0calo8o05y7ecwsoy5frdb activity_id activity_info_random PRIMARY id activity_prize PRIMARY id activity_trans_log PRIMARY id advertising_info PRIMARY id advertising_version_info PRIMARY id bank_account_flow_log PRIMARY id bank_branch_info PRIMARY id bank_branch_info_20200610 PRIMARY id bank_business_info PRIMARY trans_no bank_business_info_his PRIMARY trans_no bank_cust_mark PRIMARY id bank_cust_product PRIMARY id bank_fetch_data PRIMARY id bank_product_cust FK11cb691rs6igyp5oo958fxqxb product_id bank_product_cust PRIMARY id bank_product_image FKog5f7rt63sk922oqo1j38kgrx product_id bank_product_image PRIMARY id bank_product_info PRIMARY id bank_product_intention FKnag7tnpwjwoasrf5y7ivktp5o product_id bank_product_intention PRIMARY id bank_product_mark FKhmtivpbpk5l4b0bkp6eu3snxs product_id bank_product_mark PRIMARY id bank_product_operate PRIMARY id bank_relation_info PRIMARY id bank_sp_detail PRIMARY detail_id bank_sp_detail_his PRIMARY detail_id bank_trans_info PRIMARY flw_no bank_trans_info_his PRIMARY flw_no cardbin_info PRIMARY id certificate_upload_log IDXfdttwes40aae3ha1ohchg8wig account_id certificate_upload_log PRIMARY id check_group_info PRIMARY id check_wage_info FKgxtct2b08ae2atcp3pcpqkenm sheet_id check_wage_info PRIMARY id check_wage_info_history PRIMARY id employee_card_bank PRIMARY id employee_card_info card_index del_status,card_no employee_card_info FKgfv65vhyjq1iule0yep367pu5 employee_id employee_card_info PRIMARY id employee_info ent_id ent_id,id_number,group_id employee_info IDXlqd82vkraw27m1bbl30gyaa34 group_id,id_number,ent_id employee_info PRIMARY id employee_info_phone PRIMARY id employee_upload_temp_card_info FK8oka8sufsk4m2rwdmtrlaxcu7 employee_id employee_upload_temp_card_info PRIMARY id employee_upload_temp_info IDXjvl4anwp3ib5n09dfti35g3yg group_id,upload_status employee_upload_temp_info PRIMARY id employee_wage_info FK3iwhfdd3renn5b957cbbrk9uv employee_id employee_wage_info FKpr2yq1nyx79y6po6rofydml18 wage_id employee_wechat_info IDXdm2qk5a3m8h9aquiyj3f8e7d4 open_id employee_wechat_info IDXn19md93mggo9vhlpvfse9feg9 id_number employee_wechat_info PRIMARY id enterprise_init_info PRIMARY id enterprise_statistics PRIMARY id enterprise_statistics UK_2chu1061xi113000rix4sdiqg sta_date enterprise_store_info PRIMARY id ent_account_info IDXfc9m5wy9x9r8b362hhdd44ptx ent_id ent_account_info PRIMARY id ent_account_info UK_3abhhbsvbeiu7lemo0h0wne5q account ent_account_limit_amt_log PRIMARY id ent_account_sign_log PRIMARY id ent_business_white_list PRIMARY id ent_erprise_info PRIMARY id ent_erprise_review_info PRIMARY id ent_group_account PRIMARY id ent_group_emp_unit IDXkqt9588duot8h3955a55pa0sv group_id ent_group_emp_unit PRIMARY id ent_group_emp_unit UK_kqt9588duot8h3955a55pa0sv group_id ent_group_info FKbv1ajl419n0slgdtl710yiib0 group_invoice_id ent_group_info FKgh68m2myl7xe3tugcd3tv6hyf ent_id ent_group_info PRIMARY id ent_group_invoice_info PRIMARY id ent_group_project IDX368dw91ua6oyergve3fcmlhds group_id ent_group_project PRIMARY id ent_group_wage_head PRIMARY id ent_group_withdraw_limit PRIMARY id ent_industry_info PRIMARY id ent_none_manager PRIMARY id ent_project_employee PRIMARY id exportwechatinfo PRIMARY id export_emp_month_pay_info PRIMARY id export_hangzhou_info PRIMARY id export_wechat_info PRIMARY id export_yichun_info PRIMARY id ftp_upload_log PRIMARY id group_account_info FK2g5u89va4yb6gda4evbbwy9xi group_id group_account_info FKt1c5kubmnrvm9m590dhktcpv0 account_id group_account_info_20200611 FK2g5u89va4yb6gda4evbbwy9xi group_id group_account_info_20200611 FKt1c5kubmnrvm9m590dhktcpv0 account_id liquidation_version_advertising_info FKp2bel38jl8o59lya8i5vtclrw advertising_id liquidation_version_advertising_info PRIMARY id liquidation_version_notice_info FKdsxuopskdlw0vywcs3gu0ernk notice_id liquidation_version_notice_info PRIMARY id manager_chat_log FK2ydtw4li171kceeiro9q2ji80 chat_session_id manager_chat_log PRIMARY id manager_chat_session PRIMARY id manager_info IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info IDXmrixup68i7932bw5h67bprk85 officer manager_info IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info PRIMARY id manager_info_20200512 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_20200512 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_20200512 IDXmrixup68i7932bw5h67bprk85 officer manager_info_20200512 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_20200512 PRIMARY id manager_info_202005211729 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_202005211729 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_202005211729 IDXmrixup68i7932bw5h67bprk85 officer manager_info_202005211729 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_202005211729 PRIMARY id manager_info_202005211837 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_202005211837 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_202005211837 IDXmrixup68i7932bw5h67bprk85 officer manager_info_202005211837 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_202005211837 PRIMARY id manager_info_20210113 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_20210113 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_20210113 IDXmrixup68i7932bw5h67bprk85 officer manager_info_20210113 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_20210113 PRIMARY id msg_code_log PRIMARY id msg_model_info PRIMARY id msg_warn_info PRIMARY id notice_info PRIMARY id notice_version_info PRIMARY id other_elife_user_wechat IDXok2leovb3iatoqxbfx848qscg open_id other_elife_user_wechat PRIMARY id other_elife_wechat IDXfmx6ft5kyxpja7p5k0jwnny7w open_id other_elife_wechat PRIMARY id search_keyword_log IDX6kydbc8mdh686ae4cqb03524a channel_id,keyword search_keyword_log PRIMARY id send_push_records IDXsrf5ob8ggjaumu243tbh0c41e wage_sheet_id send_push_records PRIMARY id static_ent_amount PRIMARY id static_ent_info PRIMARY id system_authority_info PRIMARY id sys_param PRIMARY id sys_sequence PRIMARY seq_code sys_server_info PRIMARY id user_authority_info FKl5bgiiq7g0q3sa7m68xvcio2m user_id user_authority_info FKm89uviouqfj96yvjkq1ukkgru authority_id user_group_info FKao3u8754r6aevvsb0w6alwc46 group_id user_group_info FKodxoypp43jg72kgkt5cg9bn72 user_id user_info FK2hi7y8n8i8672p2yurt3w7t14 ent_id user_info PRIMARY id user_read_notice_info PRIMARY id user_session_log IDXbpb7x7nqf473y0s46mdt04lns user_id user_session_log IDXrhtxxe4e813970r4m2k88ql0e jsession_id user_session_log PRIMARY id virtual_account IDXjklkh6rew1p8b7nbow6fxugru account_name virtual_account PRIMARY id virtual_account_connect_info PRIMARY id virtual_account_flow_log PRIMARY id virtual_unit_account PRIMARY id wage_detail_info channel_trans_no channel_trans_no wage_detail_info employee_sid employee_sid,group_id,ent_id wage_detail_info FKsdixh5ok2wvatmhugfi1ruc59 wage_sheet_id wage_detail_info IDXgrryt848xh615xhg12kpaf1q5 ent_id,employee_sid,group_id,is_count_status wage_detail_info id_number id_number,wage_sheet_id wage_detail_info index_one id_number,ent_id,group_id wage_detail_info PRIMARY id wage_detail_info_history count group_id,is_count_status,employee_sid,ent_id wage_detail_info_history employee_sid employee_sid,group_id,ent_id wage_detail_info_history id_number wage_sheet_id,id_number wage_detail_info_history index_one group_id,id_number,ent_id wage_detail_info_history index_two ent_id,group_id,push_status wage_detail_info_history PRIMARY id wage_detail_info_history wage_sheet_id wage_sheet_id wage_file_transfer PRIMARY id wage_fund_type_info PRIMARY id wage_interval_info PRIMARY id wage_merchant_detail_info PRIMARY id wage_merchant_info PRIMARY flw_no wage_nxy_pay_batch_detail FKb2xt64ul7o13v5aa9f4lupgpv pay_batch_id wage_nxy_pay_batch_detail FKbp6ud6deok82xtn1omkqm635f wage_detail_id wage_nxy_pay_batch_detail PRIMARY id wage_nxy_pay_batch_detail_20200521 FKb2xt64ul7o13v5aa9f4lupgpv pay_batch_id wage_nxy_pay_batch_detail_20200521 FKbp6ud6deok82xtn1omkqm635f wage_detail_id wage_nxy_pay_batch_detail_20200521 PRIMARY id wage_nxy_pay_batch_info FKl23npfoe01xi2h2qichug6k7q wage_sheet_id wage_nxy_pay_batch_info PRIMARY id wage_nxy_pay_batch_info_20200521 FKl23npfoe01xi2h2qichug6k7q wage_sheet_id wage_nxy_pay_batch_info_20200521 PRIMARY id wage_operate_log FKfiyv41xvit8maqogd97t20nrl account_id wage_operate_log FKiux3c6jrwkp67f1xstxluevxn wage_sheet_id wage_operate_log FKtjwc4equgjuqkb6bvao4cm5yl user_id wage_operate_log PRIMARY id wage_operate_log_history PRIMARY id wage_pay_batch_detail FK3m884j0e45hqkf3n6pydaumv6 wage_detail_id wage_pay_batch_detail FKdapmpdkepukc1c9aslop1frv4 pay_batch_id wage_pay_batch_detail PRIMARY id wage_pay_batch_detail_20200521 FK3m884j0e45hqkf3n6pydaumv6 wage_detail_id wage_pay_batch_detail_20200521 FKdapmpdkepukc1c9aslop1frv4 pay_batch_id wage_pay_batch_detail_20200521 PRIMARY id wage_pay_batch_detail_history PRIMARY id wage_pay_batch_info FKtl374otnw8ud741vpfjebsgul wage_sheet_id wage_pay_batch_info PRIMARY id wage_pay_batch_info_20200521 FKtl374otnw8ud741vpfjebsgul wage_sheet_id wage_pay_batch_info_20200521 PRIMARY id wage_pay_batch_info_history PRIMARY id wage_receipt_msg FKqm5k69gsbo4j6gup62wxd59cj wage_detail_id wage_receipt_msg PRIMARY id wage_receipt_msg_history PRIMARY id wage_sheet_info FK8w5n056wa7yuhv3pk605xefb4 account_id wage_sheet_info FKdv0s9f5gdvxv9c1it8f943wrr upload_id wage_sheet_info index1 ent_id,wage_status,group_id wage_sheet_info PRIMARY id wage_sheet_info_history PRIMARY id wage_show_info FKb3s8uifutyqgvnwgpnekke6hp wage_sheet_id wage_show_info PRIMARY id wage_show_info_history PRIMARY id wage_upload_info PRIMARY id wage_wechat_push index_detail detail_id wage_wechat_push PRIMARY id wage_wechat_sheet PRIMARY id wechat_follow_info IDXhrr1ppx3vsuk7792tgw1kumeo open_id wechat_follow_info PRIMARY id welfare_activity_charge_log PRIMARY id welfare_activity_info PRIMARY id welfare_activity_type_info PRIMARY id welfare_charge_operate_log PRIMARY id will_cust_info PRIMARY id \u653e\u85aa\u7ba1\u5bb6\u751f\u4ea7\u6570\u636e\u5e93\u4e0e\u672c\u5730\u6d4b\u8bd5\u6570\u636e\u5e93\u7d22\u5f15\u5dee\u5f02\u90e8\u5206 \u8868\u540d \u7d22\u5f15\u540d \u7d22\u5f15\u5217 bank_relation_info PRIMARY id employee_card_info card_index del_status,card_no employee_info ent_id ent_id,id_number,group_id enterprise_statistics UK_2chu1061xi113000rix4sdiqg sta_date export_hangzhou_info PRIMARY id exportwechatinfo PRIMARY id liquidation_version_advertising_info FKp2bel38jl8o59lya8i5vtclrw advertising_id liquidation_version_advertising_info PRIMARY id liquidation_version_notice_info FKdsxuopskdlw0vywcs3gu0ernk notice_id liquidation_version_notice_info PRIMARY id notice_info PRIMARY id search_keyword_log IDX6kydbc8mdh686ae4cqb03524a channel_id,keyword static_ent_amount PRIMARY id static_ent_info PRIMARY id wage_detail_info employee_sid employee_sid,group_id,ent_id wage_detail_info_history count is_count_status,group_id,ent_id,employee_sid wage_detail_info_history employee_sid employee_sid,group_id,ent_id wage_detail_info_history id_number wage_sheet_id,id_number wage_detail_info_history index_one group_id,ent_id,id_number wage_detail_info_history index_two group_id,ent_id,push_status wage_detail_info_history wage_sheet_id wage_sheet_id wage_detail_info id_number id_number,wage_sheet_id wage_detail_info IDXgrryt848xh615xhg12kpaf1q5 ent_id,is_count_status,group_id,employee_sid wage_detail_info index_one ent_id,id_number,group_id wage_sheet_info index1 group_id,ent_id,wage_status wage_wechat_push index_detail detail_id wage_wechat_push PRIMARY id MongoDB\u6570\u636e\u5e93\u7d22\u5f15\u6e05\u5355 \u96c6\u5408 \u7d22\u5f15\u540d \u7d22\u5f15\u5217 employee_card_info cardNo cardNo wage_detail_info crtDateTime crtDateTime wage_detail_info entId entId","title":"\u6570\u636e\u5e93\u7d22\u5f15"},{"location":"manifests/indexes.html#mysql","text":"\u8868\u540d \u7d22\u5f15\u540d \u7d22\u5f15\u5217 account_sign_info PRIMARY account account_sign_info_his PRIMARY account activity_flow_log FKqprjkcu3gs4hnqtlx3n5jpbx9 activity_id activity_flow_log PRIMARY id activity_group FK33e1mme1o7p7kgt1ag6m7wtw4 activity_id activity_group PRIMARY id activity_info PRIMARY id activity_info_answer FKhvxk9932qe221kufmf5g0tpt8 activity_id activity_info_answer PRIMARY id activity_info_rain FKlsby7emocbn8pxu1ckcns6af1 activity_id activity_info_rain PRIMARY id activity_info_random FKdqe0calo8o05y7ecwsoy5frdb activity_id activity_info_random PRIMARY id activity_prize PRIMARY id activity_trans_log PRIMARY id advertising_info PRIMARY id advertising_version_info PRIMARY id bank_account_flow_log PRIMARY id bank_branch_info PRIMARY id bank_branch_info_20200610 PRIMARY id bank_business_info PRIMARY trans_no bank_business_info_his PRIMARY trans_no bank_cust_mark PRIMARY id bank_cust_product PRIMARY id bank_fetch_data PRIMARY id bank_product_cust FK11cb691rs6igyp5oo958fxqxb product_id bank_product_cust PRIMARY id bank_product_image FKog5f7rt63sk922oqo1j38kgrx product_id bank_product_image PRIMARY id bank_product_info PRIMARY id bank_product_intention FKnag7tnpwjwoasrf5y7ivktp5o product_id bank_product_intention PRIMARY id bank_product_mark FKhmtivpbpk5l4b0bkp6eu3snxs product_id bank_product_mark PRIMARY id bank_product_operate PRIMARY id bank_relation_info PRIMARY id bank_sp_detail PRIMARY detail_id bank_sp_detail_his PRIMARY detail_id bank_trans_info PRIMARY flw_no bank_trans_info_his PRIMARY flw_no cardbin_info PRIMARY id certificate_upload_log IDXfdttwes40aae3ha1ohchg8wig account_id certificate_upload_log PRIMARY id check_group_info PRIMARY id check_wage_info FKgxtct2b08ae2atcp3pcpqkenm sheet_id check_wage_info PRIMARY id check_wage_info_history PRIMARY id employee_card_bank PRIMARY id employee_card_info card_index del_status,card_no employee_card_info FKgfv65vhyjq1iule0yep367pu5 employee_id employee_card_info PRIMARY id employee_info ent_id ent_id,id_number,group_id employee_info IDXlqd82vkraw27m1bbl30gyaa34 group_id,id_number,ent_id employee_info PRIMARY id employee_info_phone PRIMARY id employee_upload_temp_card_info FK8oka8sufsk4m2rwdmtrlaxcu7 employee_id employee_upload_temp_card_info PRIMARY id employee_upload_temp_info IDXjvl4anwp3ib5n09dfti35g3yg group_id,upload_status employee_upload_temp_info PRIMARY id employee_wage_info FK3iwhfdd3renn5b957cbbrk9uv employee_id employee_wage_info FKpr2yq1nyx79y6po6rofydml18 wage_id employee_wechat_info IDXdm2qk5a3m8h9aquiyj3f8e7d4 open_id employee_wechat_info IDXn19md93mggo9vhlpvfse9feg9 id_number employee_wechat_info PRIMARY id enterprise_init_info PRIMARY id enterprise_statistics PRIMARY id enterprise_statistics UK_2chu1061xi113000rix4sdiqg sta_date enterprise_store_info PRIMARY id ent_account_info IDXfc9m5wy9x9r8b362hhdd44ptx ent_id ent_account_info PRIMARY id ent_account_info UK_3abhhbsvbeiu7lemo0h0wne5q account ent_account_limit_amt_log PRIMARY id ent_account_sign_log PRIMARY id ent_business_white_list PRIMARY id ent_erprise_info PRIMARY id ent_erprise_review_info PRIMARY id ent_group_account PRIMARY id ent_group_emp_unit IDXkqt9588duot8h3955a55pa0sv group_id ent_group_emp_unit PRIMARY id ent_group_emp_unit UK_kqt9588duot8h3955a55pa0sv group_id ent_group_info FKbv1ajl419n0slgdtl710yiib0 group_invoice_id ent_group_info FKgh68m2myl7xe3tugcd3tv6hyf ent_id ent_group_info PRIMARY id ent_group_invoice_info PRIMARY id ent_group_project IDX368dw91ua6oyergve3fcmlhds group_id ent_group_project PRIMARY id ent_group_wage_head PRIMARY id ent_group_withdraw_limit PRIMARY id ent_industry_info PRIMARY id ent_none_manager PRIMARY id ent_project_employee PRIMARY id exportwechatinfo PRIMARY id export_emp_month_pay_info PRIMARY id export_hangzhou_info PRIMARY id export_wechat_info PRIMARY id export_yichun_info PRIMARY id ftp_upload_log PRIMARY id group_account_info FK2g5u89va4yb6gda4evbbwy9xi group_id group_account_info FKt1c5kubmnrvm9m590dhktcpv0 account_id group_account_info_20200611 FK2g5u89va4yb6gda4evbbwy9xi group_id group_account_info_20200611 FKt1c5kubmnrvm9m590dhktcpv0 account_id liquidation_version_advertising_info FKp2bel38jl8o59lya8i5vtclrw advertising_id liquidation_version_advertising_info PRIMARY id liquidation_version_notice_info FKdsxuopskdlw0vywcs3gu0ernk notice_id liquidation_version_notice_info PRIMARY id manager_chat_log FK2ydtw4li171kceeiro9q2ji80 chat_session_id manager_chat_log PRIMARY id manager_chat_session PRIMARY id manager_info IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info IDXmrixup68i7932bw5h67bprk85 officer manager_info IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info PRIMARY id manager_info_20200512 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_20200512 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_20200512 IDXmrixup68i7932bw5h67bprk85 officer manager_info_20200512 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_20200512 PRIMARY id manager_info_202005211729 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_202005211729 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_202005211729 IDXmrixup68i7932bw5h67bprk85 officer manager_info_202005211729 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_202005211729 PRIMARY id manager_info_202005211837 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_202005211837 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_202005211837 IDXmrixup68i7932bw5h67bprk85 officer manager_info_202005211837 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_202005211837 PRIMARY id manager_info_20210113 IDX5brvab45sr93t6nc8f17rshjw branch_org_no manager_info_20210113 IDX6lbl4e6ec54gwasjvvy3c9vmi branch_no manager_info_20210113 IDXmrixup68i7932bw5h67bprk85 officer manager_info_20210113 IDXn8q7tmxdxlb59c3xf77xrk0rp manager_name manager_info_20210113 PRIMARY id msg_code_log PRIMARY id msg_model_info PRIMARY id msg_warn_info PRIMARY id notice_info PRIMARY id notice_version_info PRIMARY id other_elife_user_wechat IDXok2leovb3iatoqxbfx848qscg open_id other_elife_user_wechat PRIMARY id other_elife_wechat IDXfmx6ft5kyxpja7p5k0jwnny7w open_id other_elife_wechat PRIMARY id search_keyword_log IDX6kydbc8mdh686ae4cqb03524a channel_id,keyword search_keyword_log PRIMARY id send_push_records IDXsrf5ob8ggjaumu243tbh0c41e wage_sheet_id send_push_records PRIMARY id static_ent_amount PRIMARY id static_ent_info PRIMARY id system_authority_info PRIMARY id sys_param PRIMARY id sys_sequence PRIMARY seq_code sys_server_info PRIMARY id user_authority_info FKl5bgiiq7g0q3sa7m68xvcio2m user_id user_authority_info FKm89uviouqfj96yvjkq1ukkgru authority_id user_group_info FKao3u8754r6aevvsb0w6alwc46 group_id user_group_info FKodxoypp43jg72kgkt5cg9bn72 user_id user_info FK2hi7y8n8i8672p2yurt3w7t14 ent_id user_info PRIMARY id user_read_notice_info PRIMARY id user_session_log IDXbpb7x7nqf473y0s46mdt04lns user_id user_session_log IDXrhtxxe4e813970r4m2k88ql0e jsession_id user_session_log PRIMARY id virtual_account IDXjklkh6rew1p8b7nbow6fxugru account_name virtual_account PRIMARY id virtual_account_connect_info PRIMARY id virtual_account_flow_log PRIMARY id virtual_unit_account PRIMARY id wage_detail_info channel_trans_no channel_trans_no wage_detail_info employee_sid employee_sid,group_id,ent_id wage_detail_info FKsdixh5ok2wvatmhugfi1ruc59 wage_sheet_id wage_detail_info IDXgrryt848xh615xhg12kpaf1q5 ent_id,employee_sid,group_id,is_count_status wage_detail_info id_number id_number,wage_sheet_id wage_detail_info index_one id_number,ent_id,group_id wage_detail_info PRIMARY id wage_detail_info_history count group_id,is_count_status,employee_sid,ent_id wage_detail_info_history employee_sid employee_sid,group_id,ent_id wage_detail_info_history id_number wage_sheet_id,id_number wage_detail_info_history index_one group_id,id_number,ent_id wage_detail_info_history index_two ent_id,group_id,push_status wage_detail_info_history PRIMARY id wage_detail_info_history wage_sheet_id wage_sheet_id wage_file_transfer PRIMARY id wage_fund_type_info PRIMARY id wage_interval_info PRIMARY id wage_merchant_detail_info PRIMARY id wage_merchant_info PRIMARY flw_no wage_nxy_pay_batch_detail FKb2xt64ul7o13v5aa9f4lupgpv pay_batch_id wage_nxy_pay_batch_detail FKbp6ud6deok82xtn1omkqm635f wage_detail_id wage_nxy_pay_batch_detail PRIMARY id wage_nxy_pay_batch_detail_20200521 FKb2xt64ul7o13v5aa9f4lupgpv pay_batch_id wage_nxy_pay_batch_detail_20200521 FKbp6ud6deok82xtn1omkqm635f wage_detail_id wage_nxy_pay_batch_detail_20200521 PRIMARY id wage_nxy_pay_batch_info FKl23npfoe01xi2h2qichug6k7q wage_sheet_id wage_nxy_pay_batch_info PRIMARY id wage_nxy_pay_batch_info_20200521 FKl23npfoe01xi2h2qichug6k7q wage_sheet_id wage_nxy_pay_batch_info_20200521 PRIMARY id wage_operate_log FKfiyv41xvit8maqogd97t20nrl account_id wage_operate_log FKiux3c6jrwkp67f1xstxluevxn wage_sheet_id wage_operate_log FKtjwc4equgjuqkb6bvao4cm5yl user_id wage_operate_log PRIMARY id wage_operate_log_history PRIMARY id wage_pay_batch_detail FK3m884j0e45hqkf3n6pydaumv6 wage_detail_id wage_pay_batch_detail FKdapmpdkepukc1c9aslop1frv4 pay_batch_id wage_pay_batch_detail PRIMARY id wage_pay_batch_detail_20200521 FK3m884j0e45hqkf3n6pydaumv6 wage_detail_id wage_pay_batch_detail_20200521 FKdapmpdkepukc1c9aslop1frv4 pay_batch_id wage_pay_batch_detail_20200521 PRIMARY id wage_pay_batch_detail_history PRIMARY id wage_pay_batch_info FKtl374otnw8ud741vpfjebsgul wage_sheet_id wage_pay_batch_info PRIMARY id wage_pay_batch_info_20200521 FKtl374otnw8ud741vpfjebsgul wage_sheet_id wage_pay_batch_info_20200521 PRIMARY id wage_pay_batch_info_history PRIMARY id wage_receipt_msg FKqm5k69gsbo4j6gup62wxd59cj wage_detail_id wage_receipt_msg PRIMARY id wage_receipt_msg_history PRIMARY id wage_sheet_info FK8w5n056wa7yuhv3pk605xefb4 account_id wage_sheet_info FKdv0s9f5gdvxv9c1it8f943wrr upload_id wage_sheet_info index1 ent_id,wage_status,group_id wage_sheet_info PRIMARY id wage_sheet_info_history PRIMARY id wage_show_info FKb3s8uifutyqgvnwgpnekke6hp wage_sheet_id wage_show_info PRIMARY id wage_show_info_history PRIMARY id wage_upload_info PRIMARY id wage_wechat_push index_detail detail_id wage_wechat_push PRIMARY id wage_wechat_sheet PRIMARY id wechat_follow_info IDXhrr1ppx3vsuk7792tgw1kumeo open_id wechat_follow_info PRIMARY id welfare_activity_charge_log PRIMARY id welfare_activity_info PRIMARY id welfare_activity_type_info PRIMARY id welfare_charge_operate_log PRIMARY id will_cust_info PRIMARY id","title":"MySQL\u6570\u636e\u5e93\u7d22\u5f15\u6e05\u5355"},{"location":"manifests/indexes.html#_1","text":"\u8868\u540d \u7d22\u5f15\u540d \u7d22\u5f15\u5217 bank_relation_info PRIMARY id employee_card_info card_index del_status,card_no employee_info ent_id ent_id,id_number,group_id enterprise_statistics UK_2chu1061xi113000rix4sdiqg sta_date export_hangzhou_info PRIMARY id exportwechatinfo PRIMARY id liquidation_version_advertising_info FKp2bel38jl8o59lya8i5vtclrw advertising_id liquidation_version_advertising_info PRIMARY id liquidation_version_notice_info FKdsxuopskdlw0vywcs3gu0ernk notice_id liquidation_version_notice_info PRIMARY id notice_info PRIMARY id search_keyword_log IDX6kydbc8mdh686ae4cqb03524a channel_id,keyword static_ent_amount PRIMARY id static_ent_info PRIMARY id wage_detail_info employee_sid employee_sid,group_id,ent_id wage_detail_info_history count is_count_status,group_id,ent_id,employee_sid wage_detail_info_history employee_sid employee_sid,group_id,ent_id wage_detail_info_history id_number wage_sheet_id,id_number wage_detail_info_history index_one group_id,ent_id,id_number wage_detail_info_history index_two group_id,ent_id,push_status wage_detail_info_history wage_sheet_id wage_sheet_id wage_detail_info id_number id_number,wage_sheet_id wage_detail_info IDXgrryt848xh615xhg12kpaf1q5 ent_id,is_count_status,group_id,employee_sid wage_detail_info index_one ent_id,id_number,group_id wage_sheet_info index1 group_id,ent_id,wage_status wage_wechat_push index_detail detail_id wage_wechat_push PRIMARY id","title":"\u653e\u85aa\u7ba1\u5bb6\u751f\u4ea7\u6570\u636e\u5e93\u4e0e\u672c\u5730\u6d4b\u8bd5\u6570\u636e\u5e93\u7d22\u5f15\u5dee\u5f02\u90e8\u5206"},{"location":"manifests/indexes.html#mongodb","text":"\u96c6\u5408 \u7d22\u5f15\u540d \u7d22\u5f15\u5217 employee_card_info cardNo cardNo wage_detail_info crtDateTime crtDateTime wage_detail_info entId entId","title":"MongoDB\u6570\u636e\u5e93\u7d22\u5f15\u6e05\u5355"},{"location":"manifests/prod.html","text":"\u673a\u5668\u914d\u7f6e \u53f0\u6570 \u7528\u9014 \u5907\u6ce8 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 6 \u90e8\u7f72\u653e\u85aa\u7ba1\u5bb6\u5e94\u7528 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 MongoDB\u96c6\u7fa4 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 Consul\u96c6\u7fa4 \u90e8\u7f72consul\u96c6\u7fa4 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 2 redis\u4e3b\u5907 \u90e8\u7f72redis\u548ckeepalived 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 MySQL\u96c6\u7fa4 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 RabbitMQ\u96c6\u7fa4 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 2 \u53cc\u6d3b\u70ed\u5907\u8f6f\u4ef6 HAProxy+keepalived","title":"\u751f\u4ea7\u914d\u7f6e\u63a8\u8350"},{"location":"manifests/sit.html","text":"\u673a\u5668\u914d\u7f6e \u53f0\u6570 \u7528\u9014 \u5907\u6ce8 8\u6838 32GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 2 \u90e8\u7f72\u653e\u85aa\u7ba1\u5bb6\u5e94\u7528 8\u6838 16GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 MongoDB\u96c6\u7fa4 UAT\u548cSIT\u5171\u7528 4\u6838 8GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 Consul\u96c6\u7fa4/MySQL\u96c6\u7fa4 UAT\u548cSIT\u5171\u7528 4\u6838 8GB 40GB\u7cfb\u7edf\u76d8 500GB\u6570\u636e\u76d8 3 RabbitMQ\u96c6\u7fa4/Redis\u96c6\u7fa4 UAT\u548cSIT\u5171\u7528","title":"SIT\u914d\u7f6e\u63a8\u8350"},{"location":"manifests/software.html","text":"\u8f6f\u4ef6\u540d \u7248\u672c \u7528\u9014 \u670d\u52a1\u63d0\u4f9b\u65b9 oracle jdk 1.8.231/11.0.9 \u57fa\u7840\u8bed\u8a00\u73af\u5883 \u63d0\u4f9b\u90e8\u7f72\u65b9\u6848 MySQL 5.6.47 \u6570\u636e\u5e93 \u63d0\u4f9b\u90e8\u7f72\u65b9\u6848 Redis 5.0.8 \u6570\u636e\u7f13\u5b58 \u63d0\u4f9b\u90e8\u7f72\u65b9\u6848 Consul 1.9.3 \u6ce8\u518c\u4e2d\u5fc3 \u63d0\u4f9b\u90e8\u7f72\u65b9\u6848 MongoDB 4.4.4 \u6570\u636e\u5e93 \u63d0\u4f9b\u90e8\u7f72\u65b9\u6848 RadditMQ 3.7 \u6d88\u606f\u961f\u5217 \u63d0\u4f9b\u90e8\u7f72\u65b9\u6848 Gradle 4.9/6.2.2/6.5.1 \u5e94\u7528\u6253\u5305\u73af\u5883 \u884c\u65b9 TFTP 1.0.0 \u6587\u4ef6\u4f20\u8f93 \u884c\u65b9","title":"\u8f6f\u4ef6"},{"location":"service/consul.html","text":"Consul\u96c6\u7fa4\u90e8\u7f72 \u4e00\u3001\u73af\u5883\u89c4\u5212 \u8f6f\u4ef6\u7248\u672c \u8f6f\u4ef6 \u7248\u672c centos 7.9 consul v1.9.3 keepalived v1.3.5 \u673a\u5668\u89c4\u5212 \u89d2\u8272 ip \u7ec4\u4ef6 server01 192.168.40.121 consul server02 192.168.40.122 consul server03 192.168.40.153 consul client01(\u4e3b) 192.168.40.134 consul clinet client02(\u5907) 192.168.40.132 consul clinet client03(\u5907) 192.168.40.133 consul clinet \u7f51\u7edc\u62d3\u6251\u56fe\uff1a \u4e8c\u3001\u5b89\u88c5consul \u4e0b\u8f7d\u89e3\u538b \u8f6f\u4ef6\u4e0b\u8f7d\uff1ahttps://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip wget --no-check-certificate https://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip unzip consul_1.9.3_linux_amd64.zip mkdir -p /opt/consul/{bin,log,conf,data} mv consul /opt/consul/bin \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export CONSUL_HOME=/opt/consul export PATH=\\${PATH}:\\${CONSUL_HOME}/bin EOF source ~/.bash_profile Consul\u547d\u4ee4 \u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684mark consul keygen EXz7LFN8hpQ4id8EDYiFoQ== \u4e09\u3001\u914d\u7f6eConsul\u7684Server\u914d\u7f6e\u6587\u4ef6 \u4e09\u4e2aserver\u4e4b\u95f4\u4f1a\u9009\u4e3e\u51fa\u4e00\u4e2aserver-leader 192.168.40.121 cat /opt/consul/conf/server.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.121\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 3, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } \"bind_addr\": \"0.0.0.0\" \u4f5c\u7528\uff1a\u6307\u660e\u8282\u70b9\u7684IP\u5730\u5740,\u8fd9\u662fConsul\u4fa6\u542c\u7684\u5730\u5740\uff0c\u5b83\u5fc5\u987b\u53ef\u4ee5\u88ab\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u5176\u4ed6\u8282\u70b9\u8bbf\u95ee\uff0c\u5199server\u6240\u5728\u670d\u52a1\u5668\u7684\u5185\u7f51IP\u6216\u80050.0.0.0, \"client_addr\": \"0.0.0.0\" \u4f5c\u7528\uff1a\u6307\u5b9a\u8282\u70b9\u4e3aclient\uff0c\u6307\u5b9a\u5ba2\u6237\u7aef\u63a5\u53e3\u7684\u7ed1\u5b9a\u5730\u5740,\u9ed8\u8ba4\u662f127.0.0.1\uff0c\u53ea\u5141\u8bb8\u56de\u73af\u63a5\u53e3\u8bbf\u95ee,\u5199server\u6240\u5728\u670d\u52a1\u5668\u7684\u5185\u7f51IP\u6216\u80050.0.0.0 \"datacenter\": \"dc1\" \u4f5c\u7528\uff1a\u6307\u5b9a\u673a\u5668\u52a0\u5165\u5230\u54ea\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u4e2d \"data_dir\": \"/opt/consul/data\" \u4f5c\u7528\uff1a\u6307\u5b9aagent\u50a8\u5b58\u72b6\u6001\u7684\u6570\u636e\u76ee\u5f55\uff0c\u8fd9\u662f\u6240\u6709agent\u90fd\u5fc5\u987b\u7684,\u5bf9server\u5c24\u5176\u91cd\u8981\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5fc5\u987b\u6301\u4e45\u5316\u96c6\u7fa4\u7684\u72b6\u6001 \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\" \u4f5c\u7528\uff1a\u6b64\u5904\u914d\u7f6e\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32\u6240\u6709\u8282\u70b9\u5fc5\u987b\u7edf\u4e00\uff0c\u5426\u5219\u901a\u8baf\u4f1a\u5f02\u5e38 \"node_name\": \"192.168.40.134\" \u4f5c\u7528\uff1a\u6307\u5b9a\u8282\u70b9\u5728\u96c6\u7fa4\u4e2d\u7684\u540d\u79f0\uff0c\u8be5\u540d\u79f0\u5728\u96c6\u7fa4\u4e2d\u5fc5\u987b\u662f\u552f\u4e00\u7684\uff08\u9ed8\u8ba4\u8fd9\u662f\u673a\u5668\u7684\u4e3b\u673a\u540d\uff09\uff0c\u76f4\u63a5\u91c7\u7528\u673a\u5668\u7684IP \"log_file\": \"/opt/consul/log/consul.log\" \u914d\u7f6e\u65e5\u5fd7\u6587\u4ef6\u4e0e\u76ee\u5f55 \"log_rotate_duration\": \"24h\" \u8bbe\u7f6e\u65e5\u5fd7\u8f6e\u8f6c \"enable_syslog\": false, \u7981\u6b62consul\u65e5\u5fd7\u5199\u5165\u7cfb\u7edf\u65e5\u5fd7 \"server\": true \u5b9a\u4e49agent\u8fd0\u884c\u5728server\u6a21\u5f0f\uff0c\u6bcf\u4e2a\u6570\u636e\u4e2d\u5fc3\uff08DC\uff09\u7684server\u6570\u63a8\u83503-5\u4e2a\u3002 \"ui\": true \u662f\u5426\u5f00\u542f\u56fe\u5f62\u5316\u754c\u9762 \"bootstrap_expect\": 3 \u4f5c\u7528\uff1a \u53c2\u6570\u8868\u660e\u8be5\u670d\u52a1\u8fd0\u884c\u65f6\u6700\u4f4e\u5f00\u59cb\u8fdb\u884c\u9009\u4e3e\u7684\u8282\u70b9\u6570\uff0c\u5f53\u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u5219\u610f\u5473\u5141\u8bb8\u8282\u70b9\u4e3a\u4e00\u4e2a\u65f6\u4e5f\u8fdb\u884c\u9009\u4e3e\uff1b\u5f53\u8bbe\u7f6e\u4e3a3\u65f6\uff0c\u5219\u7b49\u52303\u53f0\u8282\u70b9\u540c\u65f6\u8fd0\u884cconsul\u5e76\u52a0\u5165\u5230server\u624d\u80fd\u53c2\u4e0e\u9009\u4e3e\uff0c\u9009\u4e3e\u5b8c\u96c6\u7fa4\u624d\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u3002 \u4e00\u822c\u5efa\u8bae\u670d\u52a1\u5668\u7ed3\u70b93-5\u4e2a\u3002 192.168.40.122 cat /opt/consul/conf/server.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.122\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 3, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } 192.168.40.153 cat /opt/consul/conf/server.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.153\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 3, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001bind_addr\u548cclient_addr\u6539\u4e3a0.0.0.0 2\u3001datacenter\u4e3adc1 3\u3001data_dir\u548clog_file\u8def\u5f84\u8981\u6307\u5bf9 4\u3001node_name\u8981\u552f\u4e00\uff0c\u8fd9\u91cc\u4ee5IP\u547d\u540d 5\u3001server: true \u8868\u793a\u5f00\u542fserver\u6a21\u5f0f\uff0cbootstrap_expect \u6709\u51e0\u4e2aserver \u8fd9\u91cc\u6570\u503c\u5c31\u4e3a\u51e0 \u56db\u3001\u914d\u7f6eConsul\u7684client\u914d\u7f6e\u6587\u4ef6 192.168.40.134 cat /opt/consul/conf/client.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.134\", \"ui\": true, \"server\": false, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } 192.168.40.132 cat /opt/consul/conf/client.json { \"bind_addr\": \"192.168.40.132\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.132\", \"ui\": true, \"server\": false, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } 192.168.40.133 cat /opt/consul/conf/client.json { \"bind_addr\": \"192.168.40.133\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.133\", \"ui\": true, \"server\": false, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u628a \"server\": \u7684\u503c\u6539\u4e3afalse\uff0c\u8868\u793a\u4e3aclient\u8282\u70b9 2\u3001bind_addr\u6700\u597d\u8fd8\u662f\u6307\u5b9a0.0.0.0\uff0c\u5982\u679c\u542f\u52a8\u62a5\u9519\uff0c\u5c31\u6307\u5b9a\u4e00\u4e2aip\u5730\u5740\u5427\uff0c\u5982\u679c\u6307\u5b9aIP\u5730\u5740,\u8bbf\u95eemembers\u7684\u8bdd\uff0c\u90a3\u4e48consul members\u547d\u4ee4\u5c31\u9700\u8981\u52a0\u4e0a --http-addr 192.168.40.133:8500 \u624d\u80fd\u67e5\u770b\u4e86 \u4e94\u3001consul\u542f\u52a8 \u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7528\u6237\u6765\u5bf9consul\u670d\u52a1\u8fdb\u884c\u7ba1\u7406\uff1a useradd consul \u66f4\u6539consul\u670d\u52a1\u76ee\u5f55\u5c5e\u4e3b\uff1a chown -R consul.consul /opt/consul \u547d\u4ee4\u542f\u52a8 consul agent -config-dir=/opt/consul/conf \u901a\u8fc7systemd\u542f\u52a8 \u9700\u8981\u4f7f\u7528ROOT\u6743\u9650\u53bb\u7f16\u5199consul.service\u6587\u4ef6 cat /usr/lib/systemd/system/consul.service [Unit] Description=Consul-node1 Documentation=https://www.consul.io/docs/ Wants=network-online.target After=network-online.target [Service] User=consul Group=consul Type=simple ExecStart=/opt/consul/bin/consul agent -config-dir=/opt/consul/conf [Install] WantedBy=multi-user.target \u91cd\u8f7dsystemd\u914d\u7f6e sudo systemctl daemon-reload \u4f7f\u7528systemd\u542f\u52a8consul\u670d\u52a1\uff1a sudo systemctl start consul \u4f7f\u7528systemd\u5f00\u673a\u81ea\u542f\u52a8\uff1a sudo systemctl enable consul \u4f7f\u7528systemd\u67e5\u770bconsul\u670d\u52a1\u7684\u72b6\u6001\uff1a sudo systemctl status consul \u4f7f\u7528systemd\u505c\u6b62consul\u670d\u52a1\uff1a sudo systemctl stop consul \u4f7f\u7528systemd\u91cd\u542fconsul\u670d\u52a1\uff1a sudo systemctl restart consul \u516d\u3001consul\u76f8\u5173\u547d\u4ee4 \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6 consul reload consul\u8fd0\u884c\u72b6\u6001\u4fe1\u606f consul info \u67e5\u770bconsul lan # consul members Node Address Status Type Build Protocol DC Segment 192.168.40.121 192.168.40.121:8301 alive server 1.9.3 2 dc1 <all> 192.168.40.122 192.168.40.122:8301 alive server 1.9.3 2 dc1 <all> 192.168.40.153 192.168.40.153:8301 alive server 1.9.3 2 dc1 <all> 192.168.40.132 192.168.40.132:8301 alive client 1.9.3 2 dc1 <default> 192.168.40.133 192.168.40.133:8301 alive client 1.9.3 2 dc1 <default> 192.168.40.134 192.168.40.134:8301 alive client 1.9.3 2 dc1 <default> consul members --http-addr 192.168.40.122:8500 \u52a0\u4e0a--http-addr 192.168.40.122:8500\u8868\u793a\u8bbf\u95ee\u7684\u662f192.168.40.122 \u7684consul lan\u4fe1\u606f \u67e5\u770bconsul\u8fd0\u884c\u65e5\u5fd7 consul monitor --http-addr=192.168.40.122:8500 \u4e03\u3001HAProxy\u914d\u7f6e cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen consul_cluster_8500 # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:8500 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.132:8500 check inter 5000 rise 2 fall 2 server node2 192.168.40.133:8500 check inter 5000 rise 2 fall 2 server node3 192.168.40.134:8500 check inter 5000 rise 2 fall 2 EOF cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen consul_cluster_8600 # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:8600 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.132:8600 check inter 5000 rise 2 fall 2 server node2 192.168.40.133:8600 check inter 5000 rise 2 fall 2 server node3 192.168.40.134:8600 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"Consul\u96c6\u7fa4"},{"location":"service/consul.html#consul","text":"","title":"Consul\u96c6\u7fa4\u90e8\u7f72"},{"location":"service/consul.html#_1","text":"\u8f6f\u4ef6\u7248\u672c \u8f6f\u4ef6 \u7248\u672c centos 7.9 consul v1.9.3 keepalived v1.3.5 \u673a\u5668\u89c4\u5212 \u89d2\u8272 ip \u7ec4\u4ef6 server01 192.168.40.121 consul server02 192.168.40.122 consul server03 192.168.40.153 consul client01(\u4e3b) 192.168.40.134 consul clinet client02(\u5907) 192.168.40.132 consul clinet client03(\u5907) 192.168.40.133 consul clinet \u7f51\u7edc\u62d3\u6251\u56fe\uff1a","title":"\u4e00\u3001\u73af\u5883\u89c4\u5212"},{"location":"service/consul.html#consul_1","text":"\u4e0b\u8f7d\u89e3\u538b \u8f6f\u4ef6\u4e0b\u8f7d\uff1ahttps://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip wget --no-check-certificate https://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip unzip consul_1.9.3_linux_amd64.zip mkdir -p /opt/consul/{bin,log,conf,data} mv consul /opt/consul/bin \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export CONSUL_HOME=/opt/consul export PATH=\\${PATH}:\\${CONSUL_HOME}/bin EOF source ~/.bash_profile Consul\u547d\u4ee4 \u751f\u6210\u4e00\u4e2a\u552f\u4e00\u7684mark consul keygen EXz7LFN8hpQ4id8EDYiFoQ==","title":"\u4e8c\u3001\u5b89\u88c5consul"},{"location":"service/consul.html#consulserver","text":"\u4e09\u4e2aserver\u4e4b\u95f4\u4f1a\u9009\u4e3e\u51fa\u4e00\u4e2aserver-leader 192.168.40.121 cat /opt/consul/conf/server.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.121\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 3, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } \"bind_addr\": \"0.0.0.0\" \u4f5c\u7528\uff1a\u6307\u660e\u8282\u70b9\u7684IP\u5730\u5740,\u8fd9\u662fConsul\u4fa6\u542c\u7684\u5730\u5740\uff0c\u5b83\u5fc5\u987b\u53ef\u4ee5\u88ab\u96c6\u7fa4\u4e2d\u7684\u6240\u6709\u5176\u4ed6\u8282\u70b9\u8bbf\u95ee\uff0c\u5199server\u6240\u5728\u670d\u52a1\u5668\u7684\u5185\u7f51IP\u6216\u80050.0.0.0, \"client_addr\": \"0.0.0.0\" \u4f5c\u7528\uff1a\u6307\u5b9a\u8282\u70b9\u4e3aclient\uff0c\u6307\u5b9a\u5ba2\u6237\u7aef\u63a5\u53e3\u7684\u7ed1\u5b9a\u5730\u5740,\u9ed8\u8ba4\u662f127.0.0.1\uff0c\u53ea\u5141\u8bb8\u56de\u73af\u63a5\u53e3\u8bbf\u95ee,\u5199server\u6240\u5728\u670d\u52a1\u5668\u7684\u5185\u7f51IP\u6216\u80050.0.0.0 \"datacenter\": \"dc1\" \u4f5c\u7528\uff1a\u6307\u5b9a\u673a\u5668\u52a0\u5165\u5230\u54ea\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u4e2d \"data_dir\": \"/opt/consul/data\" \u4f5c\u7528\uff1a\u6307\u5b9aagent\u50a8\u5b58\u72b6\u6001\u7684\u6570\u636e\u76ee\u5f55\uff0c\u8fd9\u662f\u6240\u6709agent\u90fd\u5fc5\u987b\u7684,\u5bf9server\u5c24\u5176\u91cd\u8981\uff0c\u56e0\u4e3a\u4ed6\u4eec\u5fc5\u987b\u6301\u4e45\u5316\u96c6\u7fa4\u7684\u72b6\u6001 \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\" \u4f5c\u7528\uff1a\u6b64\u5904\u914d\u7f6e\u7684\u52a0\u5bc6\u5b57\u7b26\u4e32\u6240\u6709\u8282\u70b9\u5fc5\u987b\u7edf\u4e00\uff0c\u5426\u5219\u901a\u8baf\u4f1a\u5f02\u5e38 \"node_name\": \"192.168.40.134\" \u4f5c\u7528\uff1a\u6307\u5b9a\u8282\u70b9\u5728\u96c6\u7fa4\u4e2d\u7684\u540d\u79f0\uff0c\u8be5\u540d\u79f0\u5728\u96c6\u7fa4\u4e2d\u5fc5\u987b\u662f\u552f\u4e00\u7684\uff08\u9ed8\u8ba4\u8fd9\u662f\u673a\u5668\u7684\u4e3b\u673a\u540d\uff09\uff0c\u76f4\u63a5\u91c7\u7528\u673a\u5668\u7684IP \"log_file\": \"/opt/consul/log/consul.log\" \u914d\u7f6e\u65e5\u5fd7\u6587\u4ef6\u4e0e\u76ee\u5f55 \"log_rotate_duration\": \"24h\" \u8bbe\u7f6e\u65e5\u5fd7\u8f6e\u8f6c \"enable_syslog\": false, \u7981\u6b62consul\u65e5\u5fd7\u5199\u5165\u7cfb\u7edf\u65e5\u5fd7 \"server\": true \u5b9a\u4e49agent\u8fd0\u884c\u5728server\u6a21\u5f0f\uff0c\u6bcf\u4e2a\u6570\u636e\u4e2d\u5fc3\uff08DC\uff09\u7684server\u6570\u63a8\u83503-5\u4e2a\u3002 \"ui\": true \u662f\u5426\u5f00\u542f\u56fe\u5f62\u5316\u754c\u9762 \"bootstrap_expect\": 3 \u4f5c\u7528\uff1a \u53c2\u6570\u8868\u660e\u8be5\u670d\u52a1\u8fd0\u884c\u65f6\u6700\u4f4e\u5f00\u59cb\u8fdb\u884c\u9009\u4e3e\u7684\u8282\u70b9\u6570\uff0c\u5f53\u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u5219\u610f\u5473\u5141\u8bb8\u8282\u70b9\u4e3a\u4e00\u4e2a\u65f6\u4e5f\u8fdb\u884c\u9009\u4e3e\uff1b\u5f53\u8bbe\u7f6e\u4e3a3\u65f6\uff0c\u5219\u7b49\u52303\u53f0\u8282\u70b9\u540c\u65f6\u8fd0\u884cconsul\u5e76\u52a0\u5165\u5230server\u624d\u80fd\u53c2\u4e0e\u9009\u4e3e\uff0c\u9009\u4e3e\u5b8c\u96c6\u7fa4\u624d\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u3002 \u4e00\u822c\u5efa\u8bae\u670d\u52a1\u5668\u7ed3\u70b93-5\u4e2a\u3002 192.168.40.122 cat /opt/consul/conf/server.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.122\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 3, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } 192.168.40.153 cat /opt/consul/conf/server.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.153\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 3, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001bind_addr\u548cclient_addr\u6539\u4e3a0.0.0.0 2\u3001datacenter\u4e3adc1 3\u3001data_dir\u548clog_file\u8def\u5f84\u8981\u6307\u5bf9 4\u3001node_name\u8981\u552f\u4e00\uff0c\u8fd9\u91cc\u4ee5IP\u547d\u540d 5\u3001server: true \u8868\u793a\u5f00\u542fserver\u6a21\u5f0f\uff0cbootstrap_expect \u6709\u51e0\u4e2aserver \u8fd9\u91cc\u6570\u503c\u5c31\u4e3a\u51e0","title":"\u4e09\u3001\u914d\u7f6eConsul\u7684Server\u914d\u7f6e\u6587\u4ef6"},{"location":"service/consul.html#consulclient","text":"192.168.40.134 cat /opt/consul/conf/client.json { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.134\", \"ui\": true, \"server\": false, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } 192.168.40.132 cat /opt/consul/conf/client.json { \"bind_addr\": \"192.168.40.132\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.132\", \"ui\": true, \"server\": false, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } 192.168.40.133 cat /opt/consul/conf/client.json { \"bind_addr\": \"192.168.40.133\", \"client_addr\": \"0.0.0.0\", \"datacenter\": \"dc1\", \"data_dir\": \"/opt/consul/data\", \"encrypt\": \"EXz7LFN8hpQ4id8EDYiFoQ==\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"enable_syslog\": false, \"enable_debug\": true, \"node_name\": \"192.168.40.133\", \"ui\": true, \"server\": false, \"retry_join\": [ \"192.168.40.121\", \"192.168.40.122\", \"192.168.40.153\" ] } \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u628a \"server\": \u7684\u503c\u6539\u4e3afalse\uff0c\u8868\u793a\u4e3aclient\u8282\u70b9 2\u3001bind_addr\u6700\u597d\u8fd8\u662f\u6307\u5b9a0.0.0.0\uff0c\u5982\u679c\u542f\u52a8\u62a5\u9519\uff0c\u5c31\u6307\u5b9a\u4e00\u4e2aip\u5730\u5740\u5427\uff0c\u5982\u679c\u6307\u5b9aIP\u5730\u5740,\u8bbf\u95eemembers\u7684\u8bdd\uff0c\u90a3\u4e48consul members\u547d\u4ee4\u5c31\u9700\u8981\u52a0\u4e0a --http-addr 192.168.40.133:8500 \u624d\u80fd\u67e5\u770b\u4e86","title":"\u56db\u3001\u914d\u7f6eConsul\u7684client\u914d\u7f6e\u6587\u4ef6"},{"location":"service/consul.html#consul_2","text":"\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7528\u6237\u6765\u5bf9consul\u670d\u52a1\u8fdb\u884c\u7ba1\u7406\uff1a useradd consul \u66f4\u6539consul\u670d\u52a1\u76ee\u5f55\u5c5e\u4e3b\uff1a chown -R consul.consul /opt/consul \u547d\u4ee4\u542f\u52a8 consul agent -config-dir=/opt/consul/conf \u901a\u8fc7systemd\u542f\u52a8 \u9700\u8981\u4f7f\u7528ROOT\u6743\u9650\u53bb\u7f16\u5199consul.service\u6587\u4ef6 cat /usr/lib/systemd/system/consul.service [Unit] Description=Consul-node1 Documentation=https://www.consul.io/docs/ Wants=network-online.target After=network-online.target [Service] User=consul Group=consul Type=simple ExecStart=/opt/consul/bin/consul agent -config-dir=/opt/consul/conf [Install] WantedBy=multi-user.target \u91cd\u8f7dsystemd\u914d\u7f6e sudo systemctl daemon-reload \u4f7f\u7528systemd\u542f\u52a8consul\u670d\u52a1\uff1a sudo systemctl start consul \u4f7f\u7528systemd\u5f00\u673a\u81ea\u542f\u52a8\uff1a sudo systemctl enable consul \u4f7f\u7528systemd\u67e5\u770bconsul\u670d\u52a1\u7684\u72b6\u6001\uff1a sudo systemctl status consul \u4f7f\u7528systemd\u505c\u6b62consul\u670d\u52a1\uff1a sudo systemctl stop consul \u4f7f\u7528systemd\u91cd\u542fconsul\u670d\u52a1\uff1a sudo systemctl restart consul","title":"\u4e94\u3001consul\u542f\u52a8"},{"location":"service/consul.html#consul_3","text":"\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6 consul reload consul\u8fd0\u884c\u72b6\u6001\u4fe1\u606f consul info \u67e5\u770bconsul lan # consul members Node Address Status Type Build Protocol DC Segment 192.168.40.121 192.168.40.121:8301 alive server 1.9.3 2 dc1 <all> 192.168.40.122 192.168.40.122:8301 alive server 1.9.3 2 dc1 <all> 192.168.40.153 192.168.40.153:8301 alive server 1.9.3 2 dc1 <all> 192.168.40.132 192.168.40.132:8301 alive client 1.9.3 2 dc1 <default> 192.168.40.133 192.168.40.133:8301 alive client 1.9.3 2 dc1 <default> 192.168.40.134 192.168.40.134:8301 alive client 1.9.3 2 dc1 <default> consul members --http-addr 192.168.40.122:8500 \u52a0\u4e0a--http-addr 192.168.40.122:8500\u8868\u793a\u8bbf\u95ee\u7684\u662f192.168.40.122 \u7684consul lan\u4fe1\u606f \u67e5\u770bconsul\u8fd0\u884c\u65e5\u5fd7 consul monitor --http-addr=192.168.40.122:8500","title":"\u516d\u3001consul\u76f8\u5173\u547d\u4ee4"},{"location":"service/consul.html#haproxy","text":"cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen consul_cluster_8500 # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:8500 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.132:8500 check inter 5000 rise 2 fall 2 server node2 192.168.40.133:8500 check inter 5000 rise 2 fall 2 server node3 192.168.40.134:8500 check inter 5000 rise 2 fall 2 EOF cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen consul_cluster_8600 # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:8600 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.132:8600 check inter 5000 rise 2 fall 2 server node2 192.168.40.133:8600 check inter 5000 rise 2 fall 2 server node3 192.168.40.134:8600 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"\u4e03\u3001HAProxy\u914d\u7f6e"},{"location":"service/dolphinscheduler.html","text":"\u5b9a\u65f6\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0 \u5148\u5b89\u88c5 docker-compose , docker-compose \u7684\u5b89\u88c5\u8bf7\u53c2\u8003SIT\u73af\u5883\u5b89\u88c5 Docker\u5bb9\u5668\u7ba1\u7406 \u7ae0\u8282 \u4e00\u3001\u5bfc\u5165\u955c\u50cf docker load < dolphinscheduler.tar \u6ce8\uff1a\u5b89\u88c5\u8f6f\u4ef6\u5305\u5df2\u7ecf\u63d0\u4f9b\u540c\u540d\u955c\u50cf\u538b\u7f29\u5305 \u5bfc\u5165\u5b8c\u6210\u540e,\u6267\u884cdocker images \u786e\u8ba4\u955c\u50cf\u5bfc\u5165\u6210\u529f\uff0c\u5982\u4e0b\u56fe\u793a\u4f8b REPOSITORY TAG IMAGE ID CREATED SIZE bitnami/zookeeper latest 50e37f589df3 8 weeks ago 466MB apache/dolphinscheduler latest 843e3e74b8df 2 months ago 692MB bitnami/postgresql latest c6e34729e2db 2 months ago 253MB \u4e8c\u3001\u4e0b\u8f7d\u6e90\u7801 zip \u5305 \u8bf7\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684\u6e90\u7801\u5305\u5e76\u8fdb\u884c\u89e3\u538b # \u521b\u5efa\u6e90\u7801\u5b58\u653e\u76ee\u5f55 mkdir -p /opt/soft/dolphinscheduler; cd /opt/soft/dolphinscheduler; # \u901a\u8fc7wget\u4e0b\u8f7d\u6e90\u7801\u5305 wget https://mirrors.tuna.tsinghua.edu.cn/apache/incubator/dolphinscheduler/1.3.5/apache-dolphinscheduler-incubating-1.3.5-src.zip # \u901a\u8fc7curl\u4e0b\u8f7d\u6e90\u7801\u5305 curl -O https://mirrors.tuna.tsinghua.edu.cn/apache/incubator/dolphinscheduler/1.3.5/apache-dolphinscheduler-incubating-1.3.5-src.zip \u6ce8\uff1a\u5b89\u88c5\u8f6f\u4ef6\u5305\u5df2\u7ecf\u63d0\u4f9b\u540c\u540d\u8f6f\u4ef6\u538b\u7f29\u5305 # \u89e3\u538b\u7f29 unzip apache-dolphinscheduler-incubating-1.3.5-src.zip mv apache-dolphinscheduler-incubating-1.3.5-src-release dolphinscheduler-src \u4e09\u3001\u5b89\u88c5\u5e76\u542f\u52a8\u670d\u52a1 cd dolphinscheduler-src/docker/docker-swarm docker-compose up -d \u56db\u3001\u767b\u5f55\u7cfb\u7edf \u8bbf\u95ee\u524d\u7aef\u9875\u9762\uff1a http://192.168.xx.xx:12345/dolphinscheduler \u9ed8\u8ba4\u7684\u7528\u6237\u662fadmin\uff0c\u9ed8\u8ba4\u7684\u5bc6\u7801\u662fdolphinscheduler123 \u4e94\u3001\u7528\u6237\u64cd\u4f5c\u624b\u518c \u7528\u6237\u64cd\u4f5c\u624b\u518c","title":"\u5b9a\u65f6\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0"},{"location":"service/dolphinscheduler.html#_1","text":"\u5148\u5b89\u88c5 docker-compose , docker-compose \u7684\u5b89\u88c5\u8bf7\u53c2\u8003SIT\u73af\u5883\u5b89\u88c5 Docker\u5bb9\u5668\u7ba1\u7406 \u7ae0\u8282","title":"\u5b9a\u65f6\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0"},{"location":"service/dolphinscheduler.html#_2","text":"docker load < dolphinscheduler.tar \u6ce8\uff1a\u5b89\u88c5\u8f6f\u4ef6\u5305\u5df2\u7ecf\u63d0\u4f9b\u540c\u540d\u955c\u50cf\u538b\u7f29\u5305 \u5bfc\u5165\u5b8c\u6210\u540e,\u6267\u884cdocker images \u786e\u8ba4\u955c\u50cf\u5bfc\u5165\u6210\u529f\uff0c\u5982\u4e0b\u56fe\u793a\u4f8b REPOSITORY TAG IMAGE ID CREATED SIZE bitnami/zookeeper latest 50e37f589df3 8 weeks ago 466MB apache/dolphinscheduler latest 843e3e74b8df 2 months ago 692MB bitnami/postgresql latest c6e34729e2db 2 months ago 253MB","title":"\u4e00\u3001\u5bfc\u5165\u955c\u50cf"},{"location":"service/dolphinscheduler.html#zip","text":"\u8bf7\u4e0b\u8f7d\u6700\u65b0\u7248\u672c\u7684\u6e90\u7801\u5305\u5e76\u8fdb\u884c\u89e3\u538b # \u521b\u5efa\u6e90\u7801\u5b58\u653e\u76ee\u5f55 mkdir -p /opt/soft/dolphinscheduler; cd /opt/soft/dolphinscheduler; # \u901a\u8fc7wget\u4e0b\u8f7d\u6e90\u7801\u5305 wget https://mirrors.tuna.tsinghua.edu.cn/apache/incubator/dolphinscheduler/1.3.5/apache-dolphinscheduler-incubating-1.3.5-src.zip # \u901a\u8fc7curl\u4e0b\u8f7d\u6e90\u7801\u5305 curl -O https://mirrors.tuna.tsinghua.edu.cn/apache/incubator/dolphinscheduler/1.3.5/apache-dolphinscheduler-incubating-1.3.5-src.zip \u6ce8\uff1a\u5b89\u88c5\u8f6f\u4ef6\u5305\u5df2\u7ecf\u63d0\u4f9b\u540c\u540d\u8f6f\u4ef6\u538b\u7f29\u5305 # \u89e3\u538b\u7f29 unzip apache-dolphinscheduler-incubating-1.3.5-src.zip mv apache-dolphinscheduler-incubating-1.3.5-src-release dolphinscheduler-src","title":"\u4e8c\u3001\u4e0b\u8f7d\u6e90\u7801 zip \u5305"},{"location":"service/dolphinscheduler.html#_3","text":"cd dolphinscheduler-src/docker/docker-swarm docker-compose up -d","title":"\u4e09\u3001\u5b89\u88c5\u5e76\u542f\u52a8\u670d\u52a1"},{"location":"service/dolphinscheduler.html#_4","text":"\u8bbf\u95ee\u524d\u7aef\u9875\u9762\uff1a http://192.168.xx.xx:12345/dolphinscheduler \u9ed8\u8ba4\u7684\u7528\u6237\u662fadmin\uff0c\u9ed8\u8ba4\u7684\u5bc6\u7801\u662fdolphinscheduler123","title":"\u56db\u3001\u767b\u5f55\u7cfb\u7edf"},{"location":"service/dolphinscheduler.html#_5","text":"\u7528\u6237\u64cd\u4f5c\u624b\u518c","title":"\u4e94\u3001\u7528\u6237\u64cd\u4f5c\u624b\u518c"},{"location":"service/ha.html","text":"HAPorxy+keepalived \u4e00\u3001\u73af\u5883\u51c6\u5907 \u8f6f\u4ef6 \u7248\u672c CentOS 7.9 HA-proxy v1.5.18 keepalived v1.3.5 IP \u7ec4\u4ef6 192.168.40.137 HA-proxy keepalived 192.168.40.138 HA-proxy keepalived \u7f51\u7edc\u62d3\u6251\u56fe: \u4e00\u3001HAProxy \u5b89\u88c5haproxy rpm -ivh haproxy-1.5.18-9.el7.x86_64.rpm \u5907\u4efd\u65e7\u7684\u914d\u7f6e\u4e2d\u6587\u4ef6 mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg_default HAProxy\u914d\u7f6e\u6587\u4ef6 cat >> /etc/haproxy/haproxy.cfg << EOF # \u53c2\u6570\u662f\u8fdb\u7a0b\u7ea7\u7684\uff0c\u901a\u5e38\u548c\u64cd\u4f5c\u7cfb\u7edf\uff08OS\uff09\u76f8\u5173 global #\u4ee5\u6307\u5b9a\u7684uid\u548cgid\u8fd0\u884c uid 99 gid 99 daemon quiet #\u6307\u5b9a\u542f\u52a8\u7684haproxy\u8fdb\u7a0b\u7684\u4e2a\u6570 nbproc 20 pidfile /var/run/haproxy.pid #\u6307\u5b9ahaproxy\u7684\u5de5\u4f5c\u76ee\u5f55 chroot /var/lib/haproxy log 127.0.0.1 local0 info #\u6bcf\u4e2ahaproxy\u8fdb\u7a0b\u6240\u63a5\u53d7\u7684\u6700\u5927\u5e76\u53d1\u8fde\u63a5\u6570 maxconn 5120 defaults log global # \u4f7f\u7528\u56db\u5c42\u4ee3\u7406\u6a21\u5f0f,\"mode http\" \u4e3a7\u5c42\u4ee3\u7406\u6a21\u5f0f mode tcp # if you set mode to tcp,then you must change httplog into tcplog option tcplog option dontlognull option redispatch maxconn 2000 contimeout 5s # \u5ba2\u6237\u7aef\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\u4e3a60\u79d2\uff0c\u8fc7\u4e86\u8be5\u65f6\u95f4\uff0cHA\u53d1\u8d77\u91cd\u8fde\u673a\u5236 clitimeout 60s # \u670d\u52a1\u7aef\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u4e3a15\u79d2\uff0c\u8fc7\u4e86\u8be5\u65f6\u95f4\uff0cHA\u53d1\u8d77\u91cd\u8fde\u673a\u5236 srvtimeout 15s retries 3 # \u914d\u7f6e haproxy web \u76d1\u63a7\uff0c\u67e5\u770b\u7edf\u8ba1\u4fe1\u606f listen stats bind *:8100 mode http option httplog stats enable # \u8bbe\u7f6e haproxy \u76d1\u63a7\u5730\u5740\u4e3a\uff1ahttp://localhost:8100/haproxy stats uri /haproxy stats refresh 5s EOF \u542f\u52a8haproxy systemctl start haproxy systemctl status haproxy systemctl enable haproxy web\u754c\u9762\u8bbf\u95ee\uff1a http://192.168.40.137:8100/haproxy \u4e8c\u3001keepalived rpm\u5b89\u88c5 rpm -ivh net-snmp-libs-5.7.2-49.el7_9.1.x86_64.rpm rpm -ivh lm_sensors-libs-3.4.0-8.20160601gitf9185e5.el7.x86_64.rpm rpm -ivh net-snmp-agent-libs-5.7.2-49.el7_9.1.x86_64.rpm rpm -ivh ipset-libs-7.1-1.el7.x86_64.rpm rpm -ivh keepalived-1.3.5-19.el7.x86_64.rpm 192.168.40.137 mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf_default cat >> /etc/keepalived/keepalived.conf << EOF #\u8fd9\u4e2a\u811a\u672c\u68c0\u67e5haproxy\u6b63\u4e0d\u6b63\u5e38\uff0c\u5982\u679c\u4e0d\u6b63\u5e38\uff0c\u5c31\u5b9e\u73b0\u6545\u969c\u8f6c\u79fb vrrp_script check_haproxy { script \"/home/oyb/check_haproxy.sh\" } vrrp_instance VI_1 { state MASTER # \u89d2\u8272 interface ens33 # \u7f51\u5361\u540d\u79f0 virtual_router_id 40 # VRRP\u8def\u7531ID\u5b9e\u4f8b priority 100 # \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8 advert_int 1 # \u6307\u5b9aVRRP \u5fc3\u8df3\u5305\u901a\u544a\u95f4\u9694\u65f6\u95f4\uff0c\u9ed8\u8ba41\u79d2 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.40.195/24 } #\u4f7f\u7528\u8fd9\u4e2a\u811a\u672c\u5b9a\u671f\u68c0\u67e5 track_script { check_haproxy } } EOF 192.168.40.138 mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf_default cat >> /etc/keepalived/keepalived.conf << EOF vrrp_script check_haproxy { script \"/home/git/check_haproxy.sh\" } vrrp_instance VI_1 { state BACKUP # \u89d2\u8272 interface ens33 # \u7f51\u5361\u540d\u79f0 virtual_router_id 40 # VRRP\u8def\u7531ID\u5b9e\u4f8b priority 90 # \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8 advert_int 1 # \u6307\u5b9aVRRP \u5fc3\u8df3\u5305\u901a\u544a\u95f4\u9694\u65f6\u95f4\uff0c\u9ed8\u8ba41\u79d2 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.40.195/24 } #\u4f7f\u7528\u8fd9\u4e2a\u811a\u672c\u5b9a\u671f\u68c0\u67e5 track_script { check_haproxy } } EOF \u4e09\u3001\u6ce8\u610f\u4e8b\u9879 1\u3001state \u89d2\u8272\u72b6\u6001\u6709\u4e00\u4e2a\u6307\u5b9a\u4e3aMASTER\uff0c\u5176\u4ed6\u4e3aBACKUP 2\u3001interface\u8981\u6307\u5b9a\u4f60\u5f53\u524d\u673a\u5668\u7684\u7f51\u5361\u540d\u5b57 3\u3001\u4f18\u5148\u7ea7master\u8981\u8bbe\u7f6e\u6bd4\u5176\u4ed6BACKUP\u9ad8\uff0c\u8fd9\u6837master\u6302\u6389\u6062\u590d\u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u628a\u865a\u62dfIP\u62a2\u56de\u6765\uff0cBACKUP\u4e4b\u95f4\u4f18\u5148\u7ea7\u4e5f\u8981\u6709\u9ad8\u4f4e 4\u3001\u6307\u5b9a\u4e00\u4e2a\u865a\u62dfIP\uff0c\u8be5\u865a\u62dfIP\u7f51\u7edc\u4e2d\u6ca1\u6709\u88ab\u4f7f\u7528 5\u3001\u6307\u5b9a\u5065\u5eb7\u68c0\u67e5\u811a\u672c\u8def\u5f84/home/git/check_haproxy.sh \u5065\u5eb7\u68c0\u67e5\u811a\u672c \u68c0\u6d4bhaproxy\u670d\u52a1\u6709\u6ca1\u6709\u6302\u6389\uff0c\u5982\u679c\u6302\u6389\uff0c\u5c31\u628akeepalived\u670d\u52a1\u505c\u6389\uff0c\u90a3\u4e48\u865a\u62dfIP\u5c31\u98d8\u9038\u5230\u5176\u4ed6client\u8282\u70b9\u4e86 cat >> /home/git/check_haproxy.sh << EOF count=$(ps -ef |grep haproxy |egrep -cv \"grep|$$\") if [ \"$count\" -eq 0 ];then systemctl stop keepalived fi EOF chmod +x /home/git/check_haproxy.sh \u542f\u52a8keepalived systemctl start keepalived systemctl status keepalived systemctl enable keepalived \u5728192.168.40.137\u4e0a\u67e5\u770b\u865a\u62dfip\uff1a # ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:0c:29:54:ec:a8 brd ff:ff:ff:ff:ff:ff inet 192.168.40.137/24 brd 192.168.40.255 scope global ens33 valid_lft forever preferred_lft forever inet 192.168.40.195/24 scope global secondary ens33 valid_lft forever preferred_lft forever inet6 fe80::6491:b30d:b588:921b/64 scope link valid_lft forever preferred_lft forever \u53ef\u4ee5\u770b\u5230 192.168.40.195/24 \u8fd9\u4e2a \u865a\u62dfIP\u5730\u5740","title":"\u53cc\u6d3b\u70ed\u5907\u8f6f\u4ef6"},{"location":"service/ha.html#haporxykeepalived","text":"","title":"HAPorxy+keepalived"},{"location":"service/ha.html#_1","text":"\u8f6f\u4ef6 \u7248\u672c CentOS 7.9 HA-proxy v1.5.18 keepalived v1.3.5 IP \u7ec4\u4ef6 192.168.40.137 HA-proxy keepalived 192.168.40.138 HA-proxy keepalived \u7f51\u7edc\u62d3\u6251\u56fe:","title":"\u4e00\u3001\u73af\u5883\u51c6\u5907"},{"location":"service/ha.html#haproxy","text":"\u5b89\u88c5haproxy rpm -ivh haproxy-1.5.18-9.el7.x86_64.rpm \u5907\u4efd\u65e7\u7684\u914d\u7f6e\u4e2d\u6587\u4ef6 mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg_default HAProxy\u914d\u7f6e\u6587\u4ef6 cat >> /etc/haproxy/haproxy.cfg << EOF # \u53c2\u6570\u662f\u8fdb\u7a0b\u7ea7\u7684\uff0c\u901a\u5e38\u548c\u64cd\u4f5c\u7cfb\u7edf\uff08OS\uff09\u76f8\u5173 global #\u4ee5\u6307\u5b9a\u7684uid\u548cgid\u8fd0\u884c uid 99 gid 99 daemon quiet #\u6307\u5b9a\u542f\u52a8\u7684haproxy\u8fdb\u7a0b\u7684\u4e2a\u6570 nbproc 20 pidfile /var/run/haproxy.pid #\u6307\u5b9ahaproxy\u7684\u5de5\u4f5c\u76ee\u5f55 chroot /var/lib/haproxy log 127.0.0.1 local0 info #\u6bcf\u4e2ahaproxy\u8fdb\u7a0b\u6240\u63a5\u53d7\u7684\u6700\u5927\u5e76\u53d1\u8fde\u63a5\u6570 maxconn 5120 defaults log global # \u4f7f\u7528\u56db\u5c42\u4ee3\u7406\u6a21\u5f0f,\"mode http\" \u4e3a7\u5c42\u4ee3\u7406\u6a21\u5f0f mode tcp # if you set mode to tcp,then you must change httplog into tcplog option tcplog option dontlognull option redispatch maxconn 2000 contimeout 5s # \u5ba2\u6237\u7aef\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\u4e3a60\u79d2\uff0c\u8fc7\u4e86\u8be5\u65f6\u95f4\uff0cHA\u53d1\u8d77\u91cd\u8fde\u673a\u5236 clitimeout 60s # \u670d\u52a1\u7aef\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u4e3a15\u79d2\uff0c\u8fc7\u4e86\u8be5\u65f6\u95f4\uff0cHA\u53d1\u8d77\u91cd\u8fde\u673a\u5236 srvtimeout 15s retries 3 # \u914d\u7f6e haproxy web \u76d1\u63a7\uff0c\u67e5\u770b\u7edf\u8ba1\u4fe1\u606f listen stats bind *:8100 mode http option httplog stats enable # \u8bbe\u7f6e haproxy \u76d1\u63a7\u5730\u5740\u4e3a\uff1ahttp://localhost:8100/haproxy stats uri /haproxy stats refresh 5s EOF \u542f\u52a8haproxy systemctl start haproxy systemctl status haproxy systemctl enable haproxy web\u754c\u9762\u8bbf\u95ee\uff1a http://192.168.40.137:8100/haproxy","title":"\u4e00\u3001HAProxy"},{"location":"service/ha.html#keepalived","text":"rpm\u5b89\u88c5 rpm -ivh net-snmp-libs-5.7.2-49.el7_9.1.x86_64.rpm rpm -ivh lm_sensors-libs-3.4.0-8.20160601gitf9185e5.el7.x86_64.rpm rpm -ivh net-snmp-agent-libs-5.7.2-49.el7_9.1.x86_64.rpm rpm -ivh ipset-libs-7.1-1.el7.x86_64.rpm rpm -ivh keepalived-1.3.5-19.el7.x86_64.rpm 192.168.40.137 mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf_default cat >> /etc/keepalived/keepalived.conf << EOF #\u8fd9\u4e2a\u811a\u672c\u68c0\u67e5haproxy\u6b63\u4e0d\u6b63\u5e38\uff0c\u5982\u679c\u4e0d\u6b63\u5e38\uff0c\u5c31\u5b9e\u73b0\u6545\u969c\u8f6c\u79fb vrrp_script check_haproxy { script \"/home/oyb/check_haproxy.sh\" } vrrp_instance VI_1 { state MASTER # \u89d2\u8272 interface ens33 # \u7f51\u5361\u540d\u79f0 virtual_router_id 40 # VRRP\u8def\u7531ID\u5b9e\u4f8b priority 100 # \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8 advert_int 1 # \u6307\u5b9aVRRP \u5fc3\u8df3\u5305\u901a\u544a\u95f4\u9694\u65f6\u95f4\uff0c\u9ed8\u8ba41\u79d2 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.40.195/24 } #\u4f7f\u7528\u8fd9\u4e2a\u811a\u672c\u5b9a\u671f\u68c0\u67e5 track_script { check_haproxy } } EOF 192.168.40.138 mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf_default cat >> /etc/keepalived/keepalived.conf << EOF vrrp_script check_haproxy { script \"/home/git/check_haproxy.sh\" } vrrp_instance VI_1 { state BACKUP # \u89d2\u8272 interface ens33 # \u7f51\u5361\u540d\u79f0 virtual_router_id 40 # VRRP\u8def\u7531ID\u5b9e\u4f8b priority 90 # \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u9ad8 advert_int 1 # \u6307\u5b9aVRRP \u5fc3\u8df3\u5305\u901a\u544a\u95f4\u9694\u65f6\u95f4\uff0c\u9ed8\u8ba41\u79d2 authentication { auth_type PASS auth_pass 1111 } virtual_ipaddress { 192.168.40.195/24 } #\u4f7f\u7528\u8fd9\u4e2a\u811a\u672c\u5b9a\u671f\u68c0\u67e5 track_script { check_haproxy } } EOF","title":"\u4e8c\u3001keepalived"},{"location":"service/ha.html#_2","text":"1\u3001state \u89d2\u8272\u72b6\u6001\u6709\u4e00\u4e2a\u6307\u5b9a\u4e3aMASTER\uff0c\u5176\u4ed6\u4e3aBACKUP 2\u3001interface\u8981\u6307\u5b9a\u4f60\u5f53\u524d\u673a\u5668\u7684\u7f51\u5361\u540d\u5b57 3\u3001\u4f18\u5148\u7ea7master\u8981\u8bbe\u7f6e\u6bd4\u5176\u4ed6BACKUP\u9ad8\uff0c\u8fd9\u6837master\u6302\u6389\u6062\u590d\u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u628a\u865a\u62dfIP\u62a2\u56de\u6765\uff0cBACKUP\u4e4b\u95f4\u4f18\u5148\u7ea7\u4e5f\u8981\u6709\u9ad8\u4f4e 4\u3001\u6307\u5b9a\u4e00\u4e2a\u865a\u62dfIP\uff0c\u8be5\u865a\u62dfIP\u7f51\u7edc\u4e2d\u6ca1\u6709\u88ab\u4f7f\u7528 5\u3001\u6307\u5b9a\u5065\u5eb7\u68c0\u67e5\u811a\u672c\u8def\u5f84/home/git/check_haproxy.sh \u5065\u5eb7\u68c0\u67e5\u811a\u672c \u68c0\u6d4bhaproxy\u670d\u52a1\u6709\u6ca1\u6709\u6302\u6389\uff0c\u5982\u679c\u6302\u6389\uff0c\u5c31\u628akeepalived\u670d\u52a1\u505c\u6389\uff0c\u90a3\u4e48\u865a\u62dfIP\u5c31\u98d8\u9038\u5230\u5176\u4ed6client\u8282\u70b9\u4e86 cat >> /home/git/check_haproxy.sh << EOF count=$(ps -ef |grep haproxy |egrep -cv \"grep|$$\") if [ \"$count\" -eq 0 ];then systemctl stop keepalived fi EOF chmod +x /home/git/check_haproxy.sh \u542f\u52a8keepalived systemctl start keepalived systemctl status keepalived systemctl enable keepalived \u5728192.168.40.137\u4e0a\u67e5\u770b\u865a\u62dfip\uff1a # ip addr 1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:0c:29:54:ec:a8 brd ff:ff:ff:ff:ff:ff inet 192.168.40.137/24 brd 192.168.40.255 scope global ens33 valid_lft forever preferred_lft forever inet 192.168.40.195/24 scope global secondary ens33 valid_lft forever preferred_lft forever inet6 fe80::6491:b30d:b588:921b/64 scope link valid_lft forever preferred_lft forever \u53ef\u4ee5\u770b\u5230 192.168.40.195/24 \u8fd9\u4e2a \u865a\u62dfIP\u5730\u5740","title":"\u4e09\u3001\u6ce8\u610f\u4e8b\u9879"},{"location":"service/mongodb.html","text":"MongoDB\u526f\u672c\u96c6\u5206\u7247\u96c6\u7fa4 \u4e00\u3001\u73af\u5883\u89c4\u5212 \u8f6f\u4ef6 \u7248\u672c centos 7.9 mongodb v4.4.4 192.168.40.121 192.168.40.122 192.168.40.153 mongos 20000 mongos 20000 mongos 20000 config 21000 config 21000 config 21000 shard1 27001 \u4e3b shard1 27001 \u4ece shard1 27001 \u4ef2\u88c1 shard2 27002 \u4ef2\u88c1 shard2 27002 \u4e3b shard2 27002 \u4ece shard3 27003 \u4ece shard3 27003 \u4ef2\u88c1 shard3 27003 \u4e3b mongos\u662f\u8def\u7531\u670d\u52a1\u5668\uff0cconfig\u662f\u914d\u7f6e\u670d\u52a1\u5668\uff0cshard1\u3001shard2\u3001shard3\u662f\u5206\u7247\u670d\u52a1\u5668 \u7f51\u7edc\u62d3\u6251\u56fe\uff1a \u4e8c\u3001\u5b89\u88c5mongodb \u4e0b\u8f7d\u89e3\u538b \u8f6f\u4ef6\u4e0b\u8f7d\uff1ahttps://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.4.tgz wget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.4.tgz tar -xzvf mongodb-linux-x86_64-rhel70-4.4.4.tgz -C /opt/ cd /opt mv mongodb-linux-x86_64-rhel70-4.4.4 mongodb mkdir -p /opt/mongodb/{conf,data,log} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export MONGODB_HOME=/opt/mongodb export PATH=\\${PATH}:\\${MONGODB_HOME}/bin EOF source ~/.bash_profile \u521b\u5efa\u6570\u636e\u76ee\u5f55 \u521b\u5efa\u8def\u7531\u914d\u7f6e\u76ee\u5f55 mkdir /opt/mongodb/data/20000 -p \u521b\u5efa\u914d\u7f6e\u670d\u52a1\u5668\u76ee\u5f55 mkdir /opt/mongodb/data/21000 -p \u521b\u5efashard\u76ee\u5f55 mkdir /opt/mongodb/data/27001 -p mkdir /opt/mongodb/data/27002 -p mkdir /opt/mongodb/data/27003 -p \u521b\u5efa\u65e5\u5fd7\u76ee\u5f55 mkdir /opt/mongodb/log/20000 -p mkdir /opt/mongodb/log/21000 -p mkdir /opt/mongodb/log/27001 -p mkdir /opt/mongodb/log/27002 -p mkdir /opt/mongodb/log/27003 -p \u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7528\u6237\u6765\u5bf9mongodb\u670d\u52a1\u8fdb\u884c\u7ba1\u7406\uff1a useradd mongodb \u66f4\u6539mongodb\u670d\u52a1\u76ee\u5f55\u5c5e\u4e3b\uff1a chown -R mongodb.mongodb /opt/mongodb \u4e09\u3001\u914d\u7f6e\u89d2\u8272\u642d\u5efa\uff08configsvr\uff09 \u4e09\u53f0\u670d\u52a1\u5668\u914d\u7f6e\u90fd\u4e00\u6837\uff0cbindIp\u90fd\u4e3a0.0.0.0 3.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/config.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/21000/mongodb.log storage: dbPath: /opt/mongodb/data/21000 journal: enabled: true processManagement: fork: true net: port: 21000 bindIp: 0.0.0.0 replication: replSetName: conf sharding: clusterRole: configsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001path\u548cdbPath\u8def\u5f84\u8981\u5bf9 2\u3001\u6307\u5b9a\u89d2\u8272\u540dconfigsvr 3\u3001\u8be5\u89d2\u8272\u7684\u526f\u672c\u96c6\u540d\u5b57\u53ebconf 3.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/config.conf 3.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 \u914d\u7f6e\u89d2\u8272\u7684\u4e00\u4e2a\u526f\u672c\u96c6\u642d\u5efa mongo 192.168.40.121:21000 config = { _id:\"conf\", members:[ {_id:0,host:\"192.168.40.121:21000\"}, {_id:1,host:\"192.168.40.122:21000\"}, {_id:2,host:\"192.168.40.153:21000\"} ] } #\u521d\u59cb\u5316 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() \u5176\u4e2d\uff0c_id:\"conf\"\u5e94\u4e0e\u914d\u7f6e\u6587\u4ef6\u4e2d \u7684replSetName \u4e00\u81f4\uff0c\"members\"\u4e2d\u7684\"host\"\u4e3a\u4e09\u4e2a\u8282\u70b9\u7684ip\u548cport \u56db\u3001\u8def\u7531\u89d2\u8272\u642d\u5efa\uff08mongos\uff09 \u4e09\u53f0\u670d\u52a1\u5668\u914d\u7f6e\u90fd\u4e00\u6837\uff0cbindIp\u90fd\u4e3a0.0.0.0 4.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/mongos.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/20000/mongos.log processManagement: fork: true net: port: 20000 bindIp: 0.0.0.0 sharding: configDB: conf/192.168.40.121:21000,192.168.40.122:21000,192.168.40.153:21000 \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001log\u7684\u8def\u5f84\u8981\u6307\u5bf9 2\u3001sharding.configDB \u8868\u793a\u76d1\u542c\u7684\u914d\u7f6e\u670d\u52a1\u5668\uff0cconf\u8868\u793a\u914d\u7f6e\u89d2\u8272\u7684\u526f\u672c\u96c6\u7684\u540d\u5b57 4.2\u3001\u542f\u52a8 \u8def\u7531\u89d2\u8272\u4f7f\u7528mongos\u547d\u4ee4\u6765\u542f\u52a8\uff0c\u5176\u4ed6\u89d2\u8272\u90fd\u662f\u7528mongod\u547d\u4ee4\u6765\u542f\u52a8 /opt/mongodb/bin/mongos -f /opt/mongodb/conf/mongos.conf \u4e94\u3001\u6570\u636e\u89d2\u8272\u642d\u5efa\uff08shard\uff09 \u4e09\u4e2ashard\uff0c\u5171\u6709\u4e09\u4e2a\u526f\u672c\u96c6\u3002 5.1\u3001Shard1 5.1.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/shard1.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/27001/mongodb.log storage: dbPath: /opt/mongodb/data/27001/ journal: enabled: true processManagement: fork: true net: port: 27001 bindIp: 0.0.0.0 replication: replSetName: data1 sharding: clusterRole: shardsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u526f\u672c\u96c6\u540d\u5b57data1 2\u3001\u7aef\u53e327001 5.1.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard1.conf 5.1.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 mongo 192.168.40.121:27001 config = { _id:\"data1\", members:[ {_id:0,host:\"192.168.40.121:27001\",priority:2}, {_id:1,host:\"192.168.40.122:27001\",priority:1}, {_id:2,host:\"192.168.40.153:27001\",arbiterOnly:true} ] } #\u521d\u59cb\u5316\u526f\u672c\u96c6 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u5373\u6210\u4e3a\u4e3b\u8282\u70b9 2\u3001arbiterOnly\u8868\u793a\u4ef2\u88c1\u8282\u70b9 5.2\u3001Shard2 5.2.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/shard2.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/27002/mongodb.log storage: dbPath: /opt/mongodb/data/27002/ journal: enabled: true processManagement: fork: true net: port: 27002 bindIp: 0.0.0.0 replication: replSetName: data2 sharding: clusterRole: shardsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u526f\u672c\u96c6\u540d\u5b57data2 2\u3001\u7aef\u53e327002 5.2.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard2.conf 5.2.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 mongo 192.168.40.122:27002 config = { _id:\"data2\", members:[ {_id:0,host:\"192.168.40.121:27002\",arbiterOnly:true}, {_id:1,host:\"192.168.40.122:27002\",priority:2}, {_id:2,host:\"192.168.40.153:27002\",priority:1} ] } #\u521d\u59cb\u5316\u526f\u672c\u96c6 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() 5.3\u3001Shard3 5.3.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/shard3.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/27003/mongodb.log storage: dbPath: /opt/mongodb/data/27003/ journal: enabled: true processManagement: fork: true net: port: 27003 bindIp: 0.0.0.0 replication: replSetName: data3 sharding: clusterRole: shardsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u526f\u672c\u96c6\u540d\u5b57data3 2\u3001\u7aef\u53e327003 5.3.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard3.conf 5.3.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 mongo 192.168.40.153:27003 config = { _id:\"data3\", members:[ {_id:0,host:\"192.168.40.121:27003\",priority:1}, {_id:1,host:\"192.168.40.122:27003\",arbiterOnly:true}, {_id:2,host:\"192.168.40.153:27003\",priority:2} ] } #\u521d\u59cb\u5316\u526f\u672c\u96c6 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() \u516d\u3001\u542f\u7528\u5206\u7247 \u8def\u7531\u670d\u52a1\u5668\uff1a mongo 192.168.40.121:20000 \u6dfb\u52a0\u5206\u7247\u4fe1\u606f sh.addShard(\"data1/192.168.40.121:27001,192.168.40.122:27001,192.168.40.153:27001\"); sh.addShard(\"data2/192.168.40.121:27002,192.168.40.122:27002,192.168.40.153:27002\"); sh.addShard(\"data3/192.168.40.121:27003,192.168.40.122:27003,192.168.40.153:27003\"); #\u67e5\u770b\u96c6\u7fa4\u72b6\u6001 sh.status() \u4e03\u3001\u5f00\u542f\u5b89\u5168\u8ba4\u8bc1 \u526f\u672c\u96c6\u52a0\u5206\u7247\u7684\u5b89\u5168\u8ba4\u8bc1\u9700\u8981\u914d\u7f6e\u4e24\u65b9\u9762\u7684\uff0c 1\u3001\u526f\u672c\u96c6\u5404\u4e2a\u8282\u70b9\u4e4b\u95f4\u4f7f\u7528\u5185\u90e8\u8eab\u4efd\u9a8c\u8bc1\uff0c\u7528\u4e8e\u5185\u90e8\u5404\u4e2amongo\u5b9e\u4f8b\u7684\u901a\u4fe1\uff0c\u53ea\u6709\u76f8\u540ckeyfile\u624d\u80fd\u76f8\u4e92\u8bbf\u95ee\u3002\u6240\u4ee5\u90fd\u8981\u5f00\u542fkeyFile: /opt/mongodb/conf/KeyFile.file 2\u3001\u5bf9\u4e8e\u6240\u6709\u7684mongod\uff0c\u624d\u662f\u771f\u6b63\u7684\u4fdd\u5b58\u6570\u636e\u7684\u5206\u7247\u3002mongos\u53ea\u505a\u8def\u7531\uff0c\u4e0d\u4fdd\u5b58\u6570\u636e\u3002\u6240\u4ee5\u6240\u6709\u7684mongod\u5f00\u542f\u8bbf\u95ee\u6570\u636e\u7684\u6388\u6743authorization:enabled\u3002\u8fd9\u6837\u7528\u6237\u53ea\u6709\u8d26\u53f7\u5bc6\u7801\u6b63\u786e\u624d\u80fd\u8bbf\u95ee\u5230\u6570\u636e \u526f\u672c\u96c6\u7684\u5404\u4e2a\u8282\u70b9\u6210\u5458\u4e4b\u95f4\u4f7f\u7528\u5185\u90e8\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4f7f\u7528keyfile\u7684\u5185\u5bb9\u4f5c\u4e3a\u5171\u4eab\u5bc6\u7801 \u751f\u6210\u5bc6\u94a5\u6587\u4ef6 openssl rand -base64 756 > /opt/mongodb/conf/KeyFile.file chmod 400 /opt/mongodb/conf/KeyFile.file \u7136\u540e\u590d\u5236\u5230\u5176\u4ed6\u4e24\u4e2a\u8282\u70b9\u4e0a scp /opt/mongodb/conf/KeyFile.file 192.168.40.122:/opt/mongodb/conf/ scp /opt/mongodb/conf/KeyFile.file 192.168.40.153:/opt/mongodb/conf/ \u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5\u5230mongodb\u96c6\u7fa4\u65f6\uff0c\u5f00\u542f\u8bbf\u95ee\u6388\u6743 \u8fde\u63a5\u5230\u4e0b\u9762\u6bcf\u4e00\u4e2amongo\u5b9e\u5217\u4e3b\u8282\u70b9\u4e2d\uff0c\u7136\u540e\u5728\u91cc\u9762\u53bb\u521b\u5efa\u4e00\u4e2a\u7ba1\u7406\u5458\u8d26\u53f7\u548c\u5bc6\u7801 \u8def\u7531\u89d2\u8272\u4e3b\uff1a mongo 192.168.40.140:20000 \u914d\u7f6e\u89d2\u8272\u4e3b mongo 192.168.40.140:21000 share1\u4e3b\uff1a mongo 192.168.40.141:27001 share2\u4e3b\uff1a mongo 192.168.40.142:27002 shard3\u4e3b\uff1a mongo 192.168.40.143:27003 \u521b\u5efa\u7ba1\u7406\u5458\u8d26\u53f7\u548c\u5bc6\u7801 use admin db.createUser({ user: \"root\", pwd: \"MongoDB.2019\", roles:[{role:\"root\",db:\"admin\"}] }) \u521b\u5efa\u5b8c\u8d26\u53f7\u4e4b\u540e\uff0c\u6211\u4eec\u9700\u8981\u53bb\u5f00\u542f\u8ba4\u8bc1 \u5148\u5173\u6389\u6240\u6709mongo ps -ef | grep mongo | awk '{print $2}' | xargs kill -9 \u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\uff0c\u5f00\u542f\u8ba4\u8bc1\uff0c\u8ba9mongo\u9700\u8981\u7528\u6237\u540d\u548c\u5bc6\u7801\u624d\u80fd\u8bbf\u95ee mongod\u914d\u7f6e\u6587\u4ef6(\u5206\u7247\u6821\u8272+\u914d\u7f6e\u89d2\u8272) security: keyFile: /opt/mongodb/conf/KeyFile.file authorization: enabled mongos\u914d\u7f6e\u6587\u4ef6(\u8def\u7531\u89d2\u8272) security: keyFile: /opt/mongodb/conf/KeyFile.file \u542f\u52a8\u6240\u6709mongo /opt/mongodb/bin/mongod -f /opt/mongodb/conf/config.conf /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard1.conf /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard2.conf /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard3.conf /opt/mongodb/bin/mongos -f /opt/mongodb/conf/mongos.conf \u9a8c\u8bc1\uff1a show dbs #\u6ca1\u6709\u8ba4\u8bc1\uff0c\u67e5\u770b\u4e0d\u5230\u6570\u636e\u5e93 use admin #\u8981\u5207\u6362\u5230admin\u6570\u636e\u5e93\u4e0b\uff0c\u8ba4\u8bc1\u7528\u6237\u540d\u548c\u5bc6\u7801 db.auth(\"root\",\"MongoDB.2019\") #\u5982\u679c\u8fd4\u56de1\u8868\u793a\u8fde\u63a5\u6210\u529f show dbs #\u8ba4\u8bc1\u4e86\uff0c\u67e5\u770b\u5230\u6570\u636e\u5e93","title":"MongoDB\u526f\u672c\u96c6\u5206\u7247\u96c6\u7fa4"},{"location":"service/mongodb.html#mongodb","text":"","title":"MongoDB\u526f\u672c\u96c6\u5206\u7247\u96c6\u7fa4"},{"location":"service/mongodb.html#_1","text":"\u8f6f\u4ef6 \u7248\u672c centos 7.9 mongodb v4.4.4 192.168.40.121 192.168.40.122 192.168.40.153 mongos 20000 mongos 20000 mongos 20000 config 21000 config 21000 config 21000 shard1 27001 \u4e3b shard1 27001 \u4ece shard1 27001 \u4ef2\u88c1 shard2 27002 \u4ef2\u88c1 shard2 27002 \u4e3b shard2 27002 \u4ece shard3 27003 \u4ece shard3 27003 \u4ef2\u88c1 shard3 27003 \u4e3b mongos\u662f\u8def\u7531\u670d\u52a1\u5668\uff0cconfig\u662f\u914d\u7f6e\u670d\u52a1\u5668\uff0cshard1\u3001shard2\u3001shard3\u662f\u5206\u7247\u670d\u52a1\u5668 \u7f51\u7edc\u62d3\u6251\u56fe\uff1a","title":"\u4e00\u3001\u73af\u5883\u89c4\u5212"},{"location":"service/mongodb.html#mongodb_1","text":"\u4e0b\u8f7d\u89e3\u538b \u8f6f\u4ef6\u4e0b\u8f7d\uff1ahttps://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.4.tgz wget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.4.tgz tar -xzvf mongodb-linux-x86_64-rhel70-4.4.4.tgz -C /opt/ cd /opt mv mongodb-linux-x86_64-rhel70-4.4.4 mongodb mkdir -p /opt/mongodb/{conf,data,log} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export MONGODB_HOME=/opt/mongodb export PATH=\\${PATH}:\\${MONGODB_HOME}/bin EOF source ~/.bash_profile \u521b\u5efa\u6570\u636e\u76ee\u5f55 \u521b\u5efa\u8def\u7531\u914d\u7f6e\u76ee\u5f55 mkdir /opt/mongodb/data/20000 -p \u521b\u5efa\u914d\u7f6e\u670d\u52a1\u5668\u76ee\u5f55 mkdir /opt/mongodb/data/21000 -p \u521b\u5efashard\u76ee\u5f55 mkdir /opt/mongodb/data/27001 -p mkdir /opt/mongodb/data/27002 -p mkdir /opt/mongodb/data/27003 -p \u521b\u5efa\u65e5\u5fd7\u76ee\u5f55 mkdir /opt/mongodb/log/20000 -p mkdir /opt/mongodb/log/21000 -p mkdir /opt/mongodb/log/27001 -p mkdir /opt/mongodb/log/27002 -p mkdir /opt/mongodb/log/27003 -p \u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7528\u6237\u6765\u5bf9mongodb\u670d\u52a1\u8fdb\u884c\u7ba1\u7406\uff1a useradd mongodb \u66f4\u6539mongodb\u670d\u52a1\u76ee\u5f55\u5c5e\u4e3b\uff1a chown -R mongodb.mongodb /opt/mongodb","title":"\u4e8c\u3001\u5b89\u88c5mongodb"},{"location":"service/mongodb.html#configsvr","text":"\u4e09\u53f0\u670d\u52a1\u5668\u914d\u7f6e\u90fd\u4e00\u6837\uff0cbindIp\u90fd\u4e3a0.0.0.0 3.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/config.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/21000/mongodb.log storage: dbPath: /opt/mongodb/data/21000 journal: enabled: true processManagement: fork: true net: port: 21000 bindIp: 0.0.0.0 replication: replSetName: conf sharding: clusterRole: configsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001path\u548cdbPath\u8def\u5f84\u8981\u5bf9 2\u3001\u6307\u5b9a\u89d2\u8272\u540dconfigsvr 3\u3001\u8be5\u89d2\u8272\u7684\u526f\u672c\u96c6\u540d\u5b57\u53ebconf 3.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/config.conf 3.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 \u914d\u7f6e\u89d2\u8272\u7684\u4e00\u4e2a\u526f\u672c\u96c6\u642d\u5efa mongo 192.168.40.121:21000 config = { _id:\"conf\", members:[ {_id:0,host:\"192.168.40.121:21000\"}, {_id:1,host:\"192.168.40.122:21000\"}, {_id:2,host:\"192.168.40.153:21000\"} ] } #\u521d\u59cb\u5316 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() \u5176\u4e2d\uff0c_id:\"conf\"\u5e94\u4e0e\u914d\u7f6e\u6587\u4ef6\u4e2d \u7684replSetName \u4e00\u81f4\uff0c\"members\"\u4e2d\u7684\"host\"\u4e3a\u4e09\u4e2a\u8282\u70b9\u7684ip\u548cport","title":"\u4e09\u3001\u914d\u7f6e\u89d2\u8272\u642d\u5efa\uff08configsvr\uff09"},{"location":"service/mongodb.html#mongos","text":"\u4e09\u53f0\u670d\u52a1\u5668\u914d\u7f6e\u90fd\u4e00\u6837\uff0cbindIp\u90fd\u4e3a0.0.0.0 4.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/mongos.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/20000/mongos.log processManagement: fork: true net: port: 20000 bindIp: 0.0.0.0 sharding: configDB: conf/192.168.40.121:21000,192.168.40.122:21000,192.168.40.153:21000 \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001log\u7684\u8def\u5f84\u8981\u6307\u5bf9 2\u3001sharding.configDB \u8868\u793a\u76d1\u542c\u7684\u914d\u7f6e\u670d\u52a1\u5668\uff0cconf\u8868\u793a\u914d\u7f6e\u89d2\u8272\u7684\u526f\u672c\u96c6\u7684\u540d\u5b57 4.2\u3001\u542f\u52a8 \u8def\u7531\u89d2\u8272\u4f7f\u7528mongos\u547d\u4ee4\u6765\u542f\u52a8\uff0c\u5176\u4ed6\u89d2\u8272\u90fd\u662f\u7528mongod\u547d\u4ee4\u6765\u542f\u52a8 /opt/mongodb/bin/mongos -f /opt/mongodb/conf/mongos.conf","title":"\u56db\u3001\u8def\u7531\u89d2\u8272\u642d\u5efa\uff08mongos\uff09"},{"location":"service/mongodb.html#shard","text":"\u4e09\u4e2ashard\uff0c\u5171\u6709\u4e09\u4e2a\u526f\u672c\u96c6\u3002 5.1\u3001Shard1 5.1.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/shard1.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/27001/mongodb.log storage: dbPath: /opt/mongodb/data/27001/ journal: enabled: true processManagement: fork: true net: port: 27001 bindIp: 0.0.0.0 replication: replSetName: data1 sharding: clusterRole: shardsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u526f\u672c\u96c6\u540d\u5b57data1 2\u3001\u7aef\u53e327001 5.1.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard1.conf 5.1.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 mongo 192.168.40.121:27001 config = { _id:\"data1\", members:[ {_id:0,host:\"192.168.40.121:27001\",priority:2}, {_id:1,host:\"192.168.40.122:27001\",priority:1}, {_id:2,host:\"192.168.40.153:27001\",arbiterOnly:true} ] } #\u521d\u59cb\u5316\u526f\u672c\u96c6 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u5373\u6210\u4e3a\u4e3b\u8282\u70b9 2\u3001arbiterOnly\u8868\u793a\u4ef2\u88c1\u8282\u70b9 5.2\u3001Shard2 5.2.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/shard2.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/27002/mongodb.log storage: dbPath: /opt/mongodb/data/27002/ journal: enabled: true processManagement: fork: true net: port: 27002 bindIp: 0.0.0.0 replication: replSetName: data2 sharding: clusterRole: shardsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u526f\u672c\u96c6\u540d\u5b57data2 2\u3001\u7aef\u53e327002 5.2.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard2.conf 5.2.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 mongo 192.168.40.122:27002 config = { _id:\"data2\", members:[ {_id:0,host:\"192.168.40.121:27002\",arbiterOnly:true}, {_id:1,host:\"192.168.40.122:27002\",priority:2}, {_id:2,host:\"192.168.40.153:27002\",priority:1} ] } #\u521d\u59cb\u5316\u526f\u672c\u96c6 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status() 5.3\u3001Shard3 5.3.1\u3001\u914d\u7f6e\u6587\u4ef6 cat /opt/mongodb/conf/shard3.conf systemLog: destination: file logAppend: true path: /opt/mongodb/log/27003/mongodb.log storage: dbPath: /opt/mongodb/data/27003/ journal: enabled: true processManagement: fork: true net: port: 27003 bindIp: 0.0.0.0 replication: replSetName: data3 sharding: clusterRole: shardsvr \u6ce8\u610f\u4e8b\u9879\uff1a 1\u3001\u526f\u672c\u96c6\u540d\u5b57data3 2\u3001\u7aef\u53e327003 5.3.2\u3001\u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard3.conf 5.3.3\u3001\u914d\u7f6e\u526f\u672c\u96c6 mongo 192.168.40.153:27003 config = { _id:\"data3\", members:[ {_id:0,host:\"192.168.40.121:27003\",priority:1}, {_id:1,host:\"192.168.40.122:27003\",arbiterOnly:true}, {_id:2,host:\"192.168.40.153:27003\",priority:2} ] } #\u521d\u59cb\u5316\u526f\u672c\u96c6 rs.initiate(config) #\u67e5\u770b\u72b6\u6001 rs.status()","title":"\u4e94\u3001\u6570\u636e\u89d2\u8272\u642d\u5efa\uff08shard\uff09"},{"location":"service/mongodb.html#_2","text":"\u8def\u7531\u670d\u52a1\u5668\uff1a mongo 192.168.40.121:20000 \u6dfb\u52a0\u5206\u7247\u4fe1\u606f sh.addShard(\"data1/192.168.40.121:27001,192.168.40.122:27001,192.168.40.153:27001\"); sh.addShard(\"data2/192.168.40.121:27002,192.168.40.122:27002,192.168.40.153:27002\"); sh.addShard(\"data3/192.168.40.121:27003,192.168.40.122:27003,192.168.40.153:27003\"); #\u67e5\u770b\u96c6\u7fa4\u72b6\u6001 sh.status()","title":"\u516d\u3001\u542f\u7528\u5206\u7247"},{"location":"service/mongodb.html#_3","text":"\u526f\u672c\u96c6\u52a0\u5206\u7247\u7684\u5b89\u5168\u8ba4\u8bc1\u9700\u8981\u914d\u7f6e\u4e24\u65b9\u9762\u7684\uff0c 1\u3001\u526f\u672c\u96c6\u5404\u4e2a\u8282\u70b9\u4e4b\u95f4\u4f7f\u7528\u5185\u90e8\u8eab\u4efd\u9a8c\u8bc1\uff0c\u7528\u4e8e\u5185\u90e8\u5404\u4e2amongo\u5b9e\u4f8b\u7684\u901a\u4fe1\uff0c\u53ea\u6709\u76f8\u540ckeyfile\u624d\u80fd\u76f8\u4e92\u8bbf\u95ee\u3002\u6240\u4ee5\u90fd\u8981\u5f00\u542fkeyFile: /opt/mongodb/conf/KeyFile.file 2\u3001\u5bf9\u4e8e\u6240\u6709\u7684mongod\uff0c\u624d\u662f\u771f\u6b63\u7684\u4fdd\u5b58\u6570\u636e\u7684\u5206\u7247\u3002mongos\u53ea\u505a\u8def\u7531\uff0c\u4e0d\u4fdd\u5b58\u6570\u636e\u3002\u6240\u4ee5\u6240\u6709\u7684mongod\u5f00\u542f\u8bbf\u95ee\u6570\u636e\u7684\u6388\u6743authorization:enabled\u3002\u8fd9\u6837\u7528\u6237\u53ea\u6709\u8d26\u53f7\u5bc6\u7801\u6b63\u786e\u624d\u80fd\u8bbf\u95ee\u5230\u6570\u636e \u526f\u672c\u96c6\u7684\u5404\u4e2a\u8282\u70b9\u6210\u5458\u4e4b\u95f4\u4f7f\u7528\u5185\u90e8\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4f7f\u7528keyfile\u7684\u5185\u5bb9\u4f5c\u4e3a\u5171\u4eab\u5bc6\u7801 \u751f\u6210\u5bc6\u94a5\u6587\u4ef6 openssl rand -base64 756 > /opt/mongodb/conf/KeyFile.file chmod 400 /opt/mongodb/conf/KeyFile.file \u7136\u540e\u590d\u5236\u5230\u5176\u4ed6\u4e24\u4e2a\u8282\u70b9\u4e0a scp /opt/mongodb/conf/KeyFile.file 192.168.40.122:/opt/mongodb/conf/ scp /opt/mongodb/conf/KeyFile.file 192.168.40.153:/opt/mongodb/conf/ \u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5\u5230mongodb\u96c6\u7fa4\u65f6\uff0c\u5f00\u542f\u8bbf\u95ee\u6388\u6743 \u8fde\u63a5\u5230\u4e0b\u9762\u6bcf\u4e00\u4e2amongo\u5b9e\u5217\u4e3b\u8282\u70b9\u4e2d\uff0c\u7136\u540e\u5728\u91cc\u9762\u53bb\u521b\u5efa\u4e00\u4e2a\u7ba1\u7406\u5458\u8d26\u53f7\u548c\u5bc6\u7801 \u8def\u7531\u89d2\u8272\u4e3b\uff1a mongo 192.168.40.140:20000 \u914d\u7f6e\u89d2\u8272\u4e3b mongo 192.168.40.140:21000 share1\u4e3b\uff1a mongo 192.168.40.141:27001 share2\u4e3b\uff1a mongo 192.168.40.142:27002 shard3\u4e3b\uff1a mongo 192.168.40.143:27003 \u521b\u5efa\u7ba1\u7406\u5458\u8d26\u53f7\u548c\u5bc6\u7801 use admin db.createUser({ user: \"root\", pwd: \"MongoDB.2019\", roles:[{role:\"root\",db:\"admin\"}] }) \u521b\u5efa\u5b8c\u8d26\u53f7\u4e4b\u540e\uff0c\u6211\u4eec\u9700\u8981\u53bb\u5f00\u542f\u8ba4\u8bc1 \u5148\u5173\u6389\u6240\u6709mongo ps -ef | grep mongo | awk '{print $2}' | xargs kill -9 \u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\uff0c\u5f00\u542f\u8ba4\u8bc1\uff0c\u8ba9mongo\u9700\u8981\u7528\u6237\u540d\u548c\u5bc6\u7801\u624d\u80fd\u8bbf\u95ee mongod\u914d\u7f6e\u6587\u4ef6(\u5206\u7247\u6821\u8272+\u914d\u7f6e\u89d2\u8272) security: keyFile: /opt/mongodb/conf/KeyFile.file authorization: enabled mongos\u914d\u7f6e\u6587\u4ef6(\u8def\u7531\u89d2\u8272) security: keyFile: /opt/mongodb/conf/KeyFile.file \u542f\u52a8\u6240\u6709mongo /opt/mongodb/bin/mongod -f /opt/mongodb/conf/config.conf /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard1.conf /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard2.conf /opt/mongodb/bin/mongod -f /opt/mongodb/conf/shard3.conf /opt/mongodb/bin/mongos -f /opt/mongodb/conf/mongos.conf \u9a8c\u8bc1\uff1a show dbs #\u6ca1\u6709\u8ba4\u8bc1\uff0c\u67e5\u770b\u4e0d\u5230\u6570\u636e\u5e93 use admin #\u8981\u5207\u6362\u5230admin\u6570\u636e\u5e93\u4e0b\uff0c\u8ba4\u8bc1\u7528\u6237\u540d\u548c\u5bc6\u7801 db.auth(\"root\",\"MongoDB.2019\") #\u5982\u679c\u8fd4\u56de1\u8868\u793a\u8fde\u63a5\u6210\u529f show dbs #\u8ba4\u8bc1\u4e86\uff0c\u67e5\u770b\u5230\u6570\u636e\u5e93","title":"\u4e03\u3001\u5f00\u542f\u5b89\u5168\u8ba4\u8bc1"},{"location":"service/mysql.html","text":"MySQL\u96c6\u7fa4 \u4e00\u3001\u73af\u5883\u89c4\u5212 \u8f6f\u4ef6 \u7248\u672c centos 7.9 Percona-XtraDB-Cluster v5.6.45 \u89d2\u8272 IP \u7ec4\u4ef6 node1 192.168.40.140 Percona-XtraDB-Cluster node2 192.168.40.141 Percona-XtraDB-Cluster node3 192.168.40.142 Percona-XtraDB-Cluster \u7f51\u7edc\u62d3\u6251\u56fe: \u4e8c\u3001\u5b89\u88c5PXC \u5b89\u88c5\u4f9d\u8d56 yum install perl-IO-Socket-SSL perl-DBD-MySQL perl-Time-HiRes socat nc -y \u5b89\u88c5xtrabackup yum install https://repo.percona.com/yum/percona-release-latest.noarch.rpm yum install -y percona-xtrabackup-24.x86_64 \u8f6f\u4ef6\u5305\u4e0b\u8f7d\u4e0e\u89e3\u538b tar -xzvf Percona-XtraDB-Cluster-5.6.45-rel86.1-28.36.1.Linux.x86_64.ssl101.tar.gz mv Percona-XtraDB-Cluster-5.6.45-rel86.1-28.36.1.Linux.x86_64.ssl101 /opt/mysql \u521b\u5efa\u76f8\u5173\u76ee\u5f55\u5e76\u4fee\u6539\u6743\u9650 mkdir -p /opt/mysql/data mkdir -p /opt/mysql/logs useradd mysql chown -R mysql:mysql /opt/mysql \u914d\u7f6eMySQL\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export PATH=\\$PATH:/opt/mysql/bin EOF source ~/.bash_profile \u4e09\u3001\u914d\u7f6e\u6587\u4ef6 node1 \u521d\u59cb\u5316\u6570\u636e\u5e93 /opt/mysql/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql --datadir=/opt/mysql/data \u6ce8\u610f\uff1a node2\u548cnode3\u4e0d\u9700\u8981\u521d\u59cb\u5316\u6570\u636e\u5e93 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log max_connections = 1024 server-id = 121 # PXC wsrep_provider=/opt/mysql/lib/libgalera_smm.so wsrep_cluster_name=pxc-cluster wsrep_cluster_address=gcomm://192.168.40.121,192.168.40.122,192.168.40.161 wsrep_node_name=pxc1 wsrep_node_address=192.168.40.121 wsrep_sst_method=xtrabackup-v2 wsrep_sst_auth=sst:fxgjpwd default_storage_engine=InnoDB EOF node2 node2\u548cnode3 \u53ea\u9700\u8981\u4fee\u6539 server-id\uff0cwsrep_node_name \u4ee5\u53ca wsrep_node_address \u8fd9\u4e09\u4e2a\u53c2\u6570 server-id = 122 wsrep_node_name=pxc2 wsrep_node_address=192.168.40.122 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log max_connections = 1024 server-id = 122 # PXC wsrep_provider=/opt/mysql/lib/libgalera_smm.so wsrep_cluster_name=pxc-cluster wsrep_cluster_address=gcomm://192.168.40.121,192.168.40.122,192.168.40.161 wsrep_node_name=pxc2 wsrep_node_address=192.168.40.122 wsrep_sst_method=xtrabackup-v2 wsrep_sst_auth=sst:fxgjpwd default_storage_engine=InnoDB EOF node3 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log max_connections = 1024 server-id = 161 # PXC wsrep_provider=/opt/mysql/lib/libgalera_smm.so wsrep_cluster_name=pxc-cluster wsrep_cluster_address=gcomm://192.168.40.121,192.168.40.122,192.168.40.161 wsrep_node_name=pxc3 wsrep_node_address=192.168.40.161 wsrep_sst_method=xtrabackup-v2 wsrep_sst_auth=sst:fxgjpwd default_storage_engine=InnoDB EOF \u56db\u3001\u542f\u52a8 \u542f\u52a8\u7b2c\u4e00\u4e2a\u8282\u70b9\uff1a \u7b2c\u4e00\u4e2a\u8282\u70b9\u542f\u52a8\u9700\u8981\u4f7f\u7528 --wsrep-new-cluster \u53c2\u6570 /opt/mysql/bin/mysqld --defaults-file=/opt/mysql/my.cnf --wsrep-new-cluster & \u521b\u5efasst\u7528\u6237 mysql -uroot -p grant reload, lock tables, replication client, process on *.* to 'sst'@'localhost' identified by 'fxgjpwd'; flush privileges; \u7b2c\u4e8c\u3001\u4e09\u4e2a\u8282\u70b9\u542f\u52a8\uff1a /opt/mysql/bin/mysqld --defaults-file=/opt/mysql/my.cnf & \u4e94\u3001\u67e5\u770b\u96c6\u7fa4\u72b6\u6001 \u67e5\u770b\u96c6\u7fa4\u6210\u5458\u5730\u5740: show variables like 'wsrep_cluster_address'; \u67e5\u770b\u96c6\u7fa4\u6210\u5458\u6570\u91cf\uff1a \u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u4e2d\u6709 3 \u4e2a\u8282\u70b9 show global status like 'wsrep_cluster_size'; \u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff1a show status like 'wsrep%'; wsrep_local_state=4 wsrep_local_state_comment = Synced wsrep_cluster_status = Primary wsrep_connected = ON \u516d\u3001HAProxy\u914d\u7f6e cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen Mysql_cluster # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:3306 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.140:3306 check inter 5000 rise 2 fall 2 server node2 192.168.40.141:3306 check inter 5000 rise 2 fall 2 server node3 192.168.40.142:3306 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"MySQL\u96c6\u7fa4"},{"location":"service/mysql.html#mysql","text":"","title":"MySQL\u96c6\u7fa4"},{"location":"service/mysql.html#_1","text":"\u8f6f\u4ef6 \u7248\u672c centos 7.9 Percona-XtraDB-Cluster v5.6.45 \u89d2\u8272 IP \u7ec4\u4ef6 node1 192.168.40.140 Percona-XtraDB-Cluster node2 192.168.40.141 Percona-XtraDB-Cluster node3 192.168.40.142 Percona-XtraDB-Cluster \u7f51\u7edc\u62d3\u6251\u56fe:","title":"\u4e00\u3001\u73af\u5883\u89c4\u5212"},{"location":"service/mysql.html#pxc","text":"\u5b89\u88c5\u4f9d\u8d56 yum install perl-IO-Socket-SSL perl-DBD-MySQL perl-Time-HiRes socat nc -y \u5b89\u88c5xtrabackup yum install https://repo.percona.com/yum/percona-release-latest.noarch.rpm yum install -y percona-xtrabackup-24.x86_64 \u8f6f\u4ef6\u5305\u4e0b\u8f7d\u4e0e\u89e3\u538b tar -xzvf Percona-XtraDB-Cluster-5.6.45-rel86.1-28.36.1.Linux.x86_64.ssl101.tar.gz mv Percona-XtraDB-Cluster-5.6.45-rel86.1-28.36.1.Linux.x86_64.ssl101 /opt/mysql \u521b\u5efa\u76f8\u5173\u76ee\u5f55\u5e76\u4fee\u6539\u6743\u9650 mkdir -p /opt/mysql/data mkdir -p /opt/mysql/logs useradd mysql chown -R mysql:mysql /opt/mysql \u914d\u7f6eMySQL\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export PATH=\\$PATH:/opt/mysql/bin EOF source ~/.bash_profile","title":"\u4e8c\u3001\u5b89\u88c5PXC"},{"location":"service/mysql.html#_2","text":"node1 \u521d\u59cb\u5316\u6570\u636e\u5e93 /opt/mysql/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql --datadir=/opt/mysql/data \u6ce8\u610f\uff1a node2\u548cnode3\u4e0d\u9700\u8981\u521d\u59cb\u5316\u6570\u636e\u5e93 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log max_connections = 1024 server-id = 121 # PXC wsrep_provider=/opt/mysql/lib/libgalera_smm.so wsrep_cluster_name=pxc-cluster wsrep_cluster_address=gcomm://192.168.40.121,192.168.40.122,192.168.40.161 wsrep_node_name=pxc1 wsrep_node_address=192.168.40.121 wsrep_sst_method=xtrabackup-v2 wsrep_sst_auth=sst:fxgjpwd default_storage_engine=InnoDB EOF node2 node2\u548cnode3 \u53ea\u9700\u8981\u4fee\u6539 server-id\uff0cwsrep_node_name \u4ee5\u53ca wsrep_node_address \u8fd9\u4e09\u4e2a\u53c2\u6570 server-id = 122 wsrep_node_name=pxc2 wsrep_node_address=192.168.40.122 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log max_connections = 1024 server-id = 122 # PXC wsrep_provider=/opt/mysql/lib/libgalera_smm.so wsrep_cluster_name=pxc-cluster wsrep_cluster_address=gcomm://192.168.40.121,192.168.40.122,192.168.40.161 wsrep_node_name=pxc2 wsrep_node_address=192.168.40.122 wsrep_sst_method=xtrabackup-v2 wsrep_sst_auth=sst:fxgjpwd default_storage_engine=InnoDB EOF node3 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log max_connections = 1024 server-id = 161 # PXC wsrep_provider=/opt/mysql/lib/libgalera_smm.so wsrep_cluster_name=pxc-cluster wsrep_cluster_address=gcomm://192.168.40.121,192.168.40.122,192.168.40.161 wsrep_node_name=pxc3 wsrep_node_address=192.168.40.161 wsrep_sst_method=xtrabackup-v2 wsrep_sst_auth=sst:fxgjpwd default_storage_engine=InnoDB EOF","title":"\u4e09\u3001\u914d\u7f6e\u6587\u4ef6"},{"location":"service/mysql.html#_3","text":"\u542f\u52a8\u7b2c\u4e00\u4e2a\u8282\u70b9\uff1a \u7b2c\u4e00\u4e2a\u8282\u70b9\u542f\u52a8\u9700\u8981\u4f7f\u7528 --wsrep-new-cluster \u53c2\u6570 /opt/mysql/bin/mysqld --defaults-file=/opt/mysql/my.cnf --wsrep-new-cluster & \u521b\u5efasst\u7528\u6237 mysql -uroot -p grant reload, lock tables, replication client, process on *.* to 'sst'@'localhost' identified by 'fxgjpwd'; flush privileges; \u7b2c\u4e8c\u3001\u4e09\u4e2a\u8282\u70b9\u542f\u52a8\uff1a /opt/mysql/bin/mysqld --defaults-file=/opt/mysql/my.cnf &","title":"\u56db\u3001\u542f\u52a8"},{"location":"service/mysql.html#_4","text":"\u67e5\u770b\u96c6\u7fa4\u6210\u5458\u5730\u5740: show variables like 'wsrep_cluster_address'; \u67e5\u770b\u96c6\u7fa4\u6210\u5458\u6570\u91cf\uff1a \u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u4e2d\u6709 3 \u4e2a\u8282\u70b9 show global status like 'wsrep_cluster_size'; \u67e5\u770b\u96c6\u7fa4\u72b6\u6001\uff1a show status like 'wsrep%'; wsrep_local_state=4 wsrep_local_state_comment = Synced wsrep_cluster_status = Primary wsrep_connected = ON","title":"\u4e94\u3001\u67e5\u770b\u96c6\u7fa4\u72b6\u6001"},{"location":"service/mysql.html#haproxy","text":"cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen Mysql_cluster # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:3306 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.140:3306 check inter 5000 rise 2 fall 2 server node2 192.168.40.141:3306 check inter 5000 rise 2 fall 2 server node3 192.168.40.142:3306 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"\u516d\u3001HAProxy\u914d\u7f6e"},{"location":"service/rabbitmq.html","text":"RabbitMQ\u96c6\u7fa4 \u4e00\u3001\u73af\u5883\u51c6\u5907 \u8f6f\u4ef6 \u7248\u672c CentOS 7.9 erlang v22.0 rabbitmq v3.7.17 \u4e3b\u673a\u540d IP \u7ec4\u4ef6 node1 192.168.40.121 rabbitmq \u4e3b\u8282\u70b9 node2 192.168.40.122 rabbitmq \u4ece\u8282\u70b9 node3 192.168.40.153 rabbitmq \u4ece\u8282\u70b9 node1\u3001node2\u3001node\u4e3arabbitmq\u96c6\u7fa4\uff0c\u5176\u4e2dnode1\u4f5c\u4e3a\u4e3b\u8282\u70b9\uff0cnode2\u3001node3\u4f5c\u4e3a\u4ece\u8282\u70b9\uff0c \u7f51\u7edc\u62d3\u8865\u56fe\uff1a \u4e8c\u3001RabbitMQ\u5b89\u88c5 \u5b89\u88c5\u4f9d\u8d56\u5305 \u6302\u5728\u955c\u50cf\u76d8\uff0c\u7136\u540e\u4ece\u955c\u50cf\u76d8\u91cc\u9762\u5b89\u88c5\u8fd9\u4e9b\u4f9d\u8d56\u5305 yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel libxml2 libxslt openssl-devel unixODBC unixODBC-devel gtk2 fop gtk2-devel binutils-devel mesa-libGLU-devel erlang\u6e90\u7801\u5b89\u88c5 tar -xvf otp_src_22.0.tar.gz cd otp_src_22.0 mkdir /opt/erlang ./configure --prefix=/opt/erlang make && make install tar -xvf rabbitmq-server-generic-unix-3.7.17.tar mv rabbitmq_server-3.7.17 /opt \u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export ERLANG_HOME=/opt/erlang export PATH=\\${PATH}:\\${ERLANG_HOME}/bin export RABBITMQ_HOME=/opt/rabbitmq_server-3.7.17 export PATH=\\${PATH}:\\${RABBITMQ_HOME}/sbin EOF source ~/.bash_profile \u542f\u52a8 rabbitmq-server & \u4e09\u3001\u542f\u7528\u7ba1\u7406\u63a7\u5236\u53f0 \u8bbe\u7f6eguest\u53ef\u4ee5\u8fdc\u7a0b\u8fde\u63a5\uff0c\u6ca1\u6709rabbitmq.config\u5c31\u65b0\u5efa cat >> /opt/rabbitmq_server-3.7.17/etc/rabbitmq/rabbitmq.config << EOF [{rabbit, [{loopback_users, []}]}]. EOF \u542f\u7528\u7ba1\u7406\u63a7\u5236\u53f0 rabbitmq-plugins enable rabbitmq_management \u91cd\u542f rabbitmq\u751f\u6548 rabbitmqctl stop rabbitmq-server & \u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee:http://192.168.40.121:15672\uff0c\u7528\u6237\u540dguest\uff0c\u5bc6\u7801guest \u56db\u3001RabbitMQ\u96c6\u7fa4\u914d\u7f6e \u540c\u6b65erlang.cookie\u6587\u4ef6 RabbitMQ\u662f\u4f9d\u9644\u4e8eerlang\u8fdb\u884c\u901a\u4fe1\uff0c\u60f3\u8981\u901a\u4fe1\u5fc5\u987b\u6709\u76f8\u540c\u7684.erlang.cookie\u6587\u4ef6 \u4e3b\u8282\u70b9 - 192.168.40.121 \u590d\u5236\u4e3b\u8282\u70b9\u7684 ~/.erlang.cookie\u6587\u4ef6\u5230\u5176\u4ed6slave\u8282\u70b9\uff0c\u5e76\u8986\u76d6 scp ~/.erlang.cookie root@192.168.40.122:~ scp ~/.erlang.cookie root@192.168.40.153:~ \u505c\u6b62mq\u670d\u52a1 rabbitmqctl stop \u542f\u52a8\u96c6\u7fa4 rabbitmq-server -datached & \u4ece\u8282\u70b9 - 192.168.40.122\u548c192.168.40.153 .erlang.cookie\u6587\u4ef6\u88ab\u66ff\u6362\u540e\uff0c\u9700\u8981\u91cd\u65b0\u542f\u52a8\u751f\u6548,\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u91cd\u65b0\u542f\u52a8\u5931\u8d25\uff0c\u53ef\u4ee5kill\u6389\u6240\u6709\u548cRabbitMQ\u76f8\u5173\u7684\u8fdb\u7a0b rabbitmqctl stop rabbitmq-server & Slave\u52a0\u5165\u96c6\u7fa4 HOSTS\u6587\u4ef6\u90fd\u914d\u7f6e3\u4e2a\u7684\u4e3b\u673a\u540dIP\u6620\u5c04 cat >> /etc/hosts << EOF 192.168.40.121 node1 192.168.40.122 node2 192.168.40.153 node3 EOF rabbitmqctl stop_app\u505c\u6b62rabbitmq\u5e94\u7528\uff0c\u4f46\u4e0d\u505c\u6b62erlang,join_cluster\u540e\u9762\u8981\u6307\u5b9a192.168.40.121\u7684\u4e3b\u673a\u540d rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl join_cluster rabbit@node1 rabbitmqctl start_app \u4efb\u610f\u8282\u70b9\u8fdb\u884c\u7684\u67e5\u770b\u96c6\u7fa4\u72b6\u6001 rabbitmqctl cluster_status \u79fb\u9664\u96c6\u7fa4\u8282\u70b9 rabbitmqctl forget_cluster_node rabbit@node2(\u5177\u4f53\u8282\u70b9) \u4fee\u6539\u96c6\u7fa4\u540d\u79f0 rabbitmqctl set_cluster_name rabbitmq_cluster1 \u8bbe\u7f6e\u955c\u50cf\u961f\u5217\u7b56\u7565 \u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u64cd\u4f5c \u5c06\u6240\u6709\u961f\u5217\u8bbe\u7f6e\u4e3a\u955c\u50cf\u961f\u5217\uff0c\u5373\u961f\u5217\u4f1a\u88ab\u590d\u5236\u5230\u5404\u4e2a\u8282\u70b9\uff0c\u5404\u4e2a\u8282\u70b9\u72b6\u6001\u4e00\u81f4\u3002 rabbitmqctl set_policy ha-all \"^\" '{\"ha-mode\":\"all\"}' \u56db\u3001\u5b89\u88c5\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 \u4e0a\u4f20\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 cp rabbitmq_delayed_message_exchange-3.8.0.ez /opt/rabbitmq_server-3.7.17/plugins/ \u5f00\u542f\u63d2\u4ef6\uff1a rabbitmq-plugins enable rabbitmq_delayed_message_exchange \u67e5\u8be2\u5b89\u88c5\u7684\u6240\u6709\u63d2\u4ef6\uff1a rabbitmq-plugins list \u770b\u5230\u8fd9\u4e2a\u67e5\u770brabbitmq_delayed_message_exchange 3.8.0\u8868\u793a\u5b89\u88c5\u6210\u529f \u91cd\u542f\u751f\u6548 rabbitmqctl stop rabbitmq-server & \u4e94\u3001HAProxy\u914d\u7f6e cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen rabbitmq_cluster # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:5672 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9mq\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.121:5672 check inter 5000 rise 2 fall 2 server node2 192.168.40.122:5672 check inter 5000 rise 2 fall 2 server node3 192.168.40.153:5672 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"RabbitMQ\u96c6\u7fa4"},{"location":"service/rabbitmq.html#rabbitmq","text":"","title":"RabbitMQ\u96c6\u7fa4"},{"location":"service/rabbitmq.html#_1","text":"\u8f6f\u4ef6 \u7248\u672c CentOS 7.9 erlang v22.0 rabbitmq v3.7.17 \u4e3b\u673a\u540d IP \u7ec4\u4ef6 node1 192.168.40.121 rabbitmq \u4e3b\u8282\u70b9 node2 192.168.40.122 rabbitmq \u4ece\u8282\u70b9 node3 192.168.40.153 rabbitmq \u4ece\u8282\u70b9 node1\u3001node2\u3001node\u4e3arabbitmq\u96c6\u7fa4\uff0c\u5176\u4e2dnode1\u4f5c\u4e3a\u4e3b\u8282\u70b9\uff0cnode2\u3001node3\u4f5c\u4e3a\u4ece\u8282\u70b9\uff0c \u7f51\u7edc\u62d3\u8865\u56fe\uff1a","title":"\u4e00\u3001\u73af\u5883\u51c6\u5907"},{"location":"service/rabbitmq.html#rabbitmq_1","text":"\u5b89\u88c5\u4f9d\u8d56\u5305 \u6302\u5728\u955c\u50cf\u76d8\uff0c\u7136\u540e\u4ece\u955c\u50cf\u76d8\u91cc\u9762\u5b89\u88c5\u8fd9\u4e9b\u4f9d\u8d56\u5305 yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel libxml2 libxslt openssl-devel unixODBC unixODBC-devel gtk2 fop gtk2-devel binutils-devel mesa-libGLU-devel erlang\u6e90\u7801\u5b89\u88c5 tar -xvf otp_src_22.0.tar.gz cd otp_src_22.0 mkdir /opt/erlang ./configure --prefix=/opt/erlang make && make install tar -xvf rabbitmq-server-generic-unix-3.7.17.tar mv rabbitmq_server-3.7.17 /opt \u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export ERLANG_HOME=/opt/erlang export PATH=\\${PATH}:\\${ERLANG_HOME}/bin export RABBITMQ_HOME=/opt/rabbitmq_server-3.7.17 export PATH=\\${PATH}:\\${RABBITMQ_HOME}/sbin EOF source ~/.bash_profile \u542f\u52a8 rabbitmq-server &","title":"\u4e8c\u3001RabbitMQ\u5b89\u88c5"},{"location":"service/rabbitmq.html#_2","text":"\u8bbe\u7f6eguest\u53ef\u4ee5\u8fdc\u7a0b\u8fde\u63a5\uff0c\u6ca1\u6709rabbitmq.config\u5c31\u65b0\u5efa cat >> /opt/rabbitmq_server-3.7.17/etc/rabbitmq/rabbitmq.config << EOF [{rabbit, [{loopback_users, []}]}]. EOF \u542f\u7528\u7ba1\u7406\u63a7\u5236\u53f0 rabbitmq-plugins enable rabbitmq_management \u91cd\u542f rabbitmq\u751f\u6548 rabbitmqctl stop rabbitmq-server & \u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee:http://192.168.40.121:15672\uff0c\u7528\u6237\u540dguest\uff0c\u5bc6\u7801guest","title":"\u4e09\u3001\u542f\u7528\u7ba1\u7406\u63a7\u5236\u53f0"},{"location":"service/rabbitmq.html#rabbitmq_2","text":"\u540c\u6b65erlang.cookie\u6587\u4ef6 RabbitMQ\u662f\u4f9d\u9644\u4e8eerlang\u8fdb\u884c\u901a\u4fe1\uff0c\u60f3\u8981\u901a\u4fe1\u5fc5\u987b\u6709\u76f8\u540c\u7684.erlang.cookie\u6587\u4ef6 \u4e3b\u8282\u70b9 - 192.168.40.121 \u590d\u5236\u4e3b\u8282\u70b9\u7684 ~/.erlang.cookie\u6587\u4ef6\u5230\u5176\u4ed6slave\u8282\u70b9\uff0c\u5e76\u8986\u76d6 scp ~/.erlang.cookie root@192.168.40.122:~ scp ~/.erlang.cookie root@192.168.40.153:~ \u505c\u6b62mq\u670d\u52a1 rabbitmqctl stop \u542f\u52a8\u96c6\u7fa4 rabbitmq-server -datached & \u4ece\u8282\u70b9 - 192.168.40.122\u548c192.168.40.153 .erlang.cookie\u6587\u4ef6\u88ab\u66ff\u6362\u540e\uff0c\u9700\u8981\u91cd\u65b0\u542f\u52a8\u751f\u6548,\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u91cd\u65b0\u542f\u52a8\u5931\u8d25\uff0c\u53ef\u4ee5kill\u6389\u6240\u6709\u548cRabbitMQ\u76f8\u5173\u7684\u8fdb\u7a0b rabbitmqctl stop rabbitmq-server & Slave\u52a0\u5165\u96c6\u7fa4 HOSTS\u6587\u4ef6\u90fd\u914d\u7f6e3\u4e2a\u7684\u4e3b\u673a\u540dIP\u6620\u5c04 cat >> /etc/hosts << EOF 192.168.40.121 node1 192.168.40.122 node2 192.168.40.153 node3 EOF rabbitmqctl stop_app\u505c\u6b62rabbitmq\u5e94\u7528\uff0c\u4f46\u4e0d\u505c\u6b62erlang,join_cluster\u540e\u9762\u8981\u6307\u5b9a192.168.40.121\u7684\u4e3b\u673a\u540d rabbitmqctl stop_app rabbitmqctl reset rabbitmqctl join_cluster rabbit@node1 rabbitmqctl start_app \u4efb\u610f\u8282\u70b9\u8fdb\u884c\u7684\u67e5\u770b\u96c6\u7fa4\u72b6\u6001 rabbitmqctl cluster_status \u79fb\u9664\u96c6\u7fa4\u8282\u70b9 rabbitmqctl forget_cluster_node rabbit@node2(\u5177\u4f53\u8282\u70b9) \u4fee\u6539\u96c6\u7fa4\u540d\u79f0 rabbitmqctl set_cluster_name rabbitmq_cluster1 \u8bbe\u7f6e\u955c\u50cf\u961f\u5217\u7b56\u7565 \u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u64cd\u4f5c \u5c06\u6240\u6709\u961f\u5217\u8bbe\u7f6e\u4e3a\u955c\u50cf\u961f\u5217\uff0c\u5373\u961f\u5217\u4f1a\u88ab\u590d\u5236\u5230\u5404\u4e2a\u8282\u70b9\uff0c\u5404\u4e2a\u8282\u70b9\u72b6\u6001\u4e00\u81f4\u3002 rabbitmqctl set_policy ha-all \"^\" '{\"ha-mode\":\"all\"}'","title":"\u56db\u3001RabbitMQ\u96c6\u7fa4\u914d\u7f6e"},{"location":"service/rabbitmq.html#_3","text":"\u4e0a\u4f20\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 cp rabbitmq_delayed_message_exchange-3.8.0.ez /opt/rabbitmq_server-3.7.17/plugins/ \u5f00\u542f\u63d2\u4ef6\uff1a rabbitmq-plugins enable rabbitmq_delayed_message_exchange \u67e5\u8be2\u5b89\u88c5\u7684\u6240\u6709\u63d2\u4ef6\uff1a rabbitmq-plugins list \u770b\u5230\u8fd9\u4e2a\u67e5\u770brabbitmq_delayed_message_exchange 3.8.0\u8868\u793a\u5b89\u88c5\u6210\u529f \u91cd\u542f\u751f\u6548 rabbitmqctl stop rabbitmq-server &","title":"\u56db\u3001\u5b89\u88c5\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6"},{"location":"service/rabbitmq.html#haproxy","text":"cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen rabbitmq_cluster # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:5672 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9mq\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.121:5672 check inter 5000 rise 2 fall 2 server node2 192.168.40.122:5672 check inter 5000 rise 2 fall 2 server node3 192.168.40.153:5672 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"\u4e94\u3001HAProxy\u914d\u7f6e"},{"location":"service/redis.html","text":"redis\u4e3b\u5907\u9ad8\u53ef\u7528 \u4e00\u3001\u73af\u5883\u89c4\u5212 \u8f6f\u4ef6 \u7248\u672c centos 7.9 redis v5.0.8 keepalived vv1.3.5 ip \u89d2\u8272 \u7ec4\u4ef6 192.168.40.121 \u4e3b redis keepalived 192.168.40.122 \u4ece redis keepalived 192.168.40.199 VIP \u7f51\u7edc\u62d3\u6251\u56fe: \u4e8c\u3001\u5b89\u88c5 \u5b89\u88c5\u4f9d\u8d56 yum -y install gcc \u7f16\u8bd1\u5b89\u88c5 wget http://download.redis.io/releases/redis-5.0.8.tar.gz tar -xzvf redis-5.0.8.tar.gz mkdir -p /opt/redis cd redis-5.0.8 make CFLAGS=\"-march=x86-64\" PREFIX=/opt/redis install \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p mkdir -p /opt/redis/{data,logs,etc} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export REDIS_HOME=/opt/redis export PATH=\\$PATH:\\$REDIS_HOME/bin EOF source ~/.bash_profile \u4e09\u3001redis\u914d\u7f6e\u6587\u4ef6 \u4e3b\u8282\u70b9 cat >> /opt/redis/etc/redis.conf << EOF daemonize yes bind 0.0.0.0 port 6379 pidfile /opt/redis/redis.pid dir /opt/redis/data/ logfile /opt/redis/logs/redis.log dbfilename dump.rdb requirepass 123.com EOF \u4ece\u8282\u70b9 cat >> /opt/redis/etc/redis.conf << EOF daemonize yes bind 0.0.0.0 port 6379 pidfile /opt/redis/redis.pid dir /opt/redis/data/ logfile /opt/redis/logs/redis.log dbfilename dump.rdb # \u7ed1\u5b9amaster\u7684ip\u548cport replicaof 192.168.40.121 6379 # master\u7684\u8ba4\u8bc1\u53e3\u4ee4 masterauth 123.com EOF \u56db\u3001redis\u542f\u52a8 /opt/redis/bin/redis-server /opt/redis/etc/redis.conf & \u5ba2\u6237\u7aef\u8fde\u63a5 redis-cli -h 192.168.40.121 -p 6379 -a 123.com \u67e5\u770b\u4e3b\u4ece\u4fe1\u606f 192.168.40.121:6379> info replication # Replication role:master connected_slaves:1 slave0:ip=192.168.40.122,port=6379,state=online,offset=2874,lag=1 192.168.40.122:6379> info replication # Replication role:slave master_host:192.168.40.121 master_port:6379 master_link_status:up master_last_io_seconds_ago:10 \u4e94\u3001Keepalived \u4e3b\u914d\u7f6e\u6587\u4ef6 vrrp_script chk_redis { script \"/etc/keepalived/scripts/redis_check.sh\" } vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 168 priority 100 advert_int 1 authentication { auth_type PASS auth_pass 1111 } track_script { chk_redis } virtual_ipaddress { 192.168.40.199 } notify_master /etc/keepalived/scripts/redis_master.sh notify_fault /etc/keepalived/scripts/redis_fault.sh notify_backup /etc/keepalived/scripts/redis_backup.sh notify_stop /etc/keepalived/scripts/redis_stop.sh } \u4ece\u914d\u7f6e\u6587\u4ef6 vrrp_script chk_redis { script \"/etc/keepalived/scripts/redis_check.sh\" } vrrp_instance VI_1 { state BACKUP interface eth0 virtual_router_id 168 priority 90 advert_int 1 authentication { auth_type PASS auth_pass 1111 } track_script { chk_redis } virtual_ipaddress { 192.168.40.199 } notify_master /etc/keepalived/scripts/redis_master.sh notify_backup /etc/keepalived/scripts/redis_backup.sh notify_fault /etc/keepalived/scripts/redis_fault.sh notify_stop /etc/keepalived/scripts/redis_stop.sh } \u516d\u3001\u811a\u672c \u521b\u5efa\u811a\u672c\u76ee\u5f55 mkdir -p /etc/keepalived/scripts touch /etc/keepalived/keepalived-redis-state.log \u4e3b\u8282\u70b9\u811a\u672c cat /etc/keepalived/scripts/redis_master.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com\" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[master]\" >> $LOGFILE date >> $LOGFILE echo \"Being master....\" >> $LOGFILE 2>&1 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.122 6379 >> $LOGFILE 2>&1 sleep 10 #\u5ef6\u8fdf10\u79d2\u4ee5\u540e\u5f85\u6570\u636e\u540c\u6b65\u5b8c\u6210\u540e\u518d\u53d6\u6d88\u540c\u6b65\u72b6\u6001 echo \"Run SLAVEOF NO ONE cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF NO ONE >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_backup.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com\" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[backup]\" >> $LOGFILE date >> $LOGFILE echo \"Being slave....\" >> $LOGFILE 2>&1 sleep 15 #\u5ef6\u8fdf15\u79d2\u5f85\u6570\u636e\u88ab\u5bf9\u65b9\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\u518d\u5207\u6362\u4e3b\u4ece\u89d2\u8272 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.122 6379 >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_fault.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[fault]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_stop.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[stop]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_check.sh #!/bin/bash ALIVE=$(/opt/redis/bin/redis-cli -p 6379 -a 123.com PING) LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" if [ $ALIVE = \"PONG\" ];then echo $ALIVE exit 0 else echo \"killall -9 keepalived\" systemctl stop keepalived exit 1 fi chmod +x /etc/keepalived/scripts/*.sh \u4ece\u8282\u70b9\u811a\u672c cat /etc/keepalived/scripts/redis_master.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com\" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[master]\" >> $LOGFILE date >> $LOGFILE echo \"Being master....\" >> $LOGFILE 2>&1 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.121 6379>> $LOGFILE 2>&1 sleep 10 #\u5ef6\u8fdf10\u79d2\u4ee5\u540e\u5f85\u6570\u636e\u540c\u6b65\u5b8c\u6210\u540e\u518d\u53d6\u6d88\u540c\u6b65\u72b6\u6001 echo \"Run SLAVEOF NO ONE cmd ...\" >> $LOGFILE $REDISCLI -p 6380 SLAVEOF NO ONE >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_backup.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com \" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[backup]\" >> $LOGFILE date >> $LOGFILE echo \"Being slave....\" >> $LOGFILE 2>&1 sleep 15 #\u5ef6\u8fdf15\u79d2\u5f85\u6570\u636e\u88ab\u5bf9\u65b9\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\u518d\u5207\u6362\u4e3b\u4ece\u89d2\u8272 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.121 6379 >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_fault.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[fault]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_stop.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[stop]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_check.sh #!/bin/bash ALIVE=$(/opt/redis/bin/redis-cli -p 6379 -a 123.com PING) LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" if [ $ALIVE = \"PONG\" ];then echo $ALIVE exit 0 else echo \"killall -9 keepalived\" systemctl stop keepalived exit 1 fi chmod +x /etc/keepalived/scripts/*.sh","title":"Redis\u4e3b\u5907"},{"location":"service/redis.html#redis","text":"","title":"redis\u4e3b\u5907\u9ad8\u53ef\u7528"},{"location":"service/redis.html#_1","text":"\u8f6f\u4ef6 \u7248\u672c centos 7.9 redis v5.0.8 keepalived vv1.3.5 ip \u89d2\u8272 \u7ec4\u4ef6 192.168.40.121 \u4e3b redis keepalived 192.168.40.122 \u4ece redis keepalived 192.168.40.199 VIP \u7f51\u7edc\u62d3\u6251\u56fe:","title":"\u4e00\u3001\u73af\u5883\u89c4\u5212"},{"location":"service/redis.html#_2","text":"\u5b89\u88c5\u4f9d\u8d56 yum -y install gcc \u7f16\u8bd1\u5b89\u88c5 wget http://download.redis.io/releases/redis-5.0.8.tar.gz tar -xzvf redis-5.0.8.tar.gz mkdir -p /opt/redis cd redis-5.0.8 make CFLAGS=\"-march=x86-64\" PREFIX=/opt/redis install \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p mkdir -p /opt/redis/{data,logs,etc} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export REDIS_HOME=/opt/redis export PATH=\\$PATH:\\$REDIS_HOME/bin EOF source ~/.bash_profile","title":"\u4e8c\u3001\u5b89\u88c5"},{"location":"service/redis.html#redis_1","text":"\u4e3b\u8282\u70b9 cat >> /opt/redis/etc/redis.conf << EOF daemonize yes bind 0.0.0.0 port 6379 pidfile /opt/redis/redis.pid dir /opt/redis/data/ logfile /opt/redis/logs/redis.log dbfilename dump.rdb requirepass 123.com EOF \u4ece\u8282\u70b9 cat >> /opt/redis/etc/redis.conf << EOF daemonize yes bind 0.0.0.0 port 6379 pidfile /opt/redis/redis.pid dir /opt/redis/data/ logfile /opt/redis/logs/redis.log dbfilename dump.rdb # \u7ed1\u5b9amaster\u7684ip\u548cport replicaof 192.168.40.121 6379 # master\u7684\u8ba4\u8bc1\u53e3\u4ee4 masterauth 123.com EOF","title":"\u4e09\u3001redis\u914d\u7f6e\u6587\u4ef6"},{"location":"service/redis.html#redis_2","text":"/opt/redis/bin/redis-server /opt/redis/etc/redis.conf & \u5ba2\u6237\u7aef\u8fde\u63a5 redis-cli -h 192.168.40.121 -p 6379 -a 123.com \u67e5\u770b\u4e3b\u4ece\u4fe1\u606f 192.168.40.121:6379> info replication # Replication role:master connected_slaves:1 slave0:ip=192.168.40.122,port=6379,state=online,offset=2874,lag=1 192.168.40.122:6379> info replication # Replication role:slave master_host:192.168.40.121 master_port:6379 master_link_status:up master_last_io_seconds_ago:10","title":"\u56db\u3001redis\u542f\u52a8"},{"location":"service/redis.html#keepalived","text":"\u4e3b\u914d\u7f6e\u6587\u4ef6 vrrp_script chk_redis { script \"/etc/keepalived/scripts/redis_check.sh\" } vrrp_instance VI_1 { state MASTER interface eth0 virtual_router_id 168 priority 100 advert_int 1 authentication { auth_type PASS auth_pass 1111 } track_script { chk_redis } virtual_ipaddress { 192.168.40.199 } notify_master /etc/keepalived/scripts/redis_master.sh notify_fault /etc/keepalived/scripts/redis_fault.sh notify_backup /etc/keepalived/scripts/redis_backup.sh notify_stop /etc/keepalived/scripts/redis_stop.sh } \u4ece\u914d\u7f6e\u6587\u4ef6 vrrp_script chk_redis { script \"/etc/keepalived/scripts/redis_check.sh\" } vrrp_instance VI_1 { state BACKUP interface eth0 virtual_router_id 168 priority 90 advert_int 1 authentication { auth_type PASS auth_pass 1111 } track_script { chk_redis } virtual_ipaddress { 192.168.40.199 } notify_master /etc/keepalived/scripts/redis_master.sh notify_backup /etc/keepalived/scripts/redis_backup.sh notify_fault /etc/keepalived/scripts/redis_fault.sh notify_stop /etc/keepalived/scripts/redis_stop.sh }","title":"\u4e94\u3001Keepalived"},{"location":"service/redis.html#_3","text":"\u521b\u5efa\u811a\u672c\u76ee\u5f55 mkdir -p /etc/keepalived/scripts touch /etc/keepalived/keepalived-redis-state.log \u4e3b\u8282\u70b9\u811a\u672c cat /etc/keepalived/scripts/redis_master.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com\" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[master]\" >> $LOGFILE date >> $LOGFILE echo \"Being master....\" >> $LOGFILE 2>&1 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.122 6379 >> $LOGFILE 2>&1 sleep 10 #\u5ef6\u8fdf10\u79d2\u4ee5\u540e\u5f85\u6570\u636e\u540c\u6b65\u5b8c\u6210\u540e\u518d\u53d6\u6d88\u540c\u6b65\u72b6\u6001 echo \"Run SLAVEOF NO ONE cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF NO ONE >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_backup.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com\" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[backup]\" >> $LOGFILE date >> $LOGFILE echo \"Being slave....\" >> $LOGFILE 2>&1 sleep 15 #\u5ef6\u8fdf15\u79d2\u5f85\u6570\u636e\u88ab\u5bf9\u65b9\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\u518d\u5207\u6362\u4e3b\u4ece\u89d2\u8272 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.122 6379 >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_fault.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[fault]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_stop.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[stop]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_check.sh #!/bin/bash ALIVE=$(/opt/redis/bin/redis-cli -p 6379 -a 123.com PING) LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" if [ $ALIVE = \"PONG\" ];then echo $ALIVE exit 0 else echo \"killall -9 keepalived\" systemctl stop keepalived exit 1 fi chmod +x /etc/keepalived/scripts/*.sh \u4ece\u8282\u70b9\u811a\u672c cat /etc/keepalived/scripts/redis_master.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com\" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[master]\" >> $LOGFILE date >> $LOGFILE echo \"Being master....\" >> $LOGFILE 2>&1 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.121 6379>> $LOGFILE 2>&1 sleep 10 #\u5ef6\u8fdf10\u79d2\u4ee5\u540e\u5f85\u6570\u636e\u540c\u6b65\u5b8c\u6210\u540e\u518d\u53d6\u6d88\u540c\u6b65\u72b6\u6001 echo \"Run SLAVEOF NO ONE cmd ...\" >> $LOGFILE $REDISCLI -p 6380 SLAVEOF NO ONE >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_backup.sh #!/bin/bash REDISCLI=\"/opt/redis/bin/redis-cli -a 123.com \" LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[backup]\" >> $LOGFILE date >> $LOGFILE echo \"Being slave....\" >> $LOGFILE 2>&1 sleep 15 #\u5ef6\u8fdf15\u79d2\u5f85\u6570\u636e\u88ab\u5bf9\u65b9\u540c\u6b65\u5b8c\u6210\u4e4b\u540e\u518d\u5207\u6362\u4e3b\u4ece\u89d2\u8272 echo \"Run SLAVEOF cmd ...\" >> $LOGFILE $REDISCLI -p 6379 SLAVEOF 192.168.40.121 6379 >> $LOGFILE 2>&1 cat /etc/keepalived/scripts/redis_fault.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[fault]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_stop.sh #!/bin/bash LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" echo \"[stop]\" >> $LOGFILE date >> $LOGFILE cat /etc/keepalived/scripts/redis_check.sh #!/bin/bash ALIVE=$(/opt/redis/bin/redis-cli -p 6379 -a 123.com PING) LOGFILE=\"/etc/keepalived/keepalived-redis-state.log\" if [ $ALIVE = \"PONG\" ];then echo $ALIVE exit 0 else echo \"killall -9 keepalived\" systemctl stop keepalived exit 1 fi chmod +x /etc/keepalived/scripts/*.sh","title":"\u516d\u3001\u811a\u672c"},{"location":"service/redis2.html","text":"Redis\u96c6\u7fa4 \u4e00\u3001\u73af\u5883\u89c4\u5212 \u8f6f\u4ef6 \u7248\u672c centos 7.9 redis v5.0.8 IP 192.168.40.140 192.168.40.141 192.168.40.142 \u4e3b\u8282\u70b9 8001 8002 8003 \u5907\u8282\u70b9 9001 9002 9003 \u7f51\u7edc\u62d3\u6251\u56fe: \u4e8c\u3001\u5b89\u88c5Redis \u5b89\u88c5\u4f9d\u8d56 yum -y install gcc \u4e0b\u8f7d\u3001\u89e3\u538b\u3001\u7f16\u8bd1\u5b89\u88c5 wget http://download.redis.io/releases/redis-5.0.8.tar.gz tar -xzvf redis-5.0.8.tar.gz cd redis-5.0.8 mkdir /opt/redis make CFLAGS=\"-march=x86-64\" PREFIX=/opt/redis install \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u7b49\u76ee\u5f55 mkdir -p /opt/redis/{etc,data,logs} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export REDIS_HOME=/opt/redis export PATH=\\$PATH:\\$REDIS_HOME/bin EOF source ~/.bash_profile \u4e09\u3001Redis\u914d\u7f6e\u6587\u4ef6 3.1\u3001192.168.40.140 mkdir -p /opt/redis/data/8001 mkdir -p /opt/redis/data/9001 cat >> /opt/redis/etc/redis_8001.conf << EOF daemonize yes bind 0.0.0.0 port 8001 dir /opt/redis/data/8001 pidfile /opt/redis/8001.pid logfile /opt/redis/logs/redis-8001.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-8001.conf cluster-node-timeout 10000 appendonly yes EOF cat >> /opt/redis/etc/redis_9001.conf << EOF daemonize yes bind 0.0.0.0 port 9001 dir /opt/redis/data/9001 pidfile /opt/redis/9001.pid logfile /opt/redis/logs/redis-9001.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-9001.conf cluster-node-timeout 10000 appendonly yes EOF \u542f\u52a8 /opt/redis/bin/redis-server /opt/redis/etc/redis_8001.conf & /opt/redis/bin/redis-server /opt/redis/etc/redis_9001.conf & 3.2\u3001192.168.40.141 mkdir -p /opt/redis/data/8002 mkdir -p /opt/redis/data/9002 cat >> /opt/redis/etc/redis_8002.conf << EOF daemonize yes bind 0.0.0.0 port 8002 dir /opt/redis/data/8002 pidfile /opt/redis/8002.pid logfile /opt/redis/logs/redis-8002.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-8002.conf cluster-node-timeout 10000 appendonly yes EOF cat >> /opt/redis/etc/redis_9002.conf << EOF daemonize yes bind 0.0.0.0 port 9002 dir /opt/redis/data/9002 pidfile /opt/redis/9002.pid logfile /opt/redis/logs/redis-9002.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-9002.conf cluster-node-timeout 10000 appendonly yes EOF /opt/redis/bin/redis-server /opt/redis/etc/redis_8002.conf & /opt/redis/bin/redis-server /opt/redis/etc/redis_9002.conf & 3.3\u3001192.168.40.142 mkdir -p /opt/redis/data/8003 mkdir -p /opt/redis/data/9003 cat >> /opt/redis/etc/redis_8003.conf << EOF daemonize yes bind 0.0.0.0 port 8003 dir /opt/redis/data/8003 pidfile /opt/redis/8003.pid logfile /opt/redis/logs/redis-8003.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-8003.conf cluster-node-timeout 10000 appendonly yes EOF cat >> /opt/redis/etc/redis_9003.conf << EOF daemonize yes bind 0.0.0.0 port 9003 dir /opt/redis/data/9003 pidfile /opt/redis/9003.pid logfile /opt/redis/logs/redis-9003.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-9003.conf cluster-node-timeout 10000 appendonly yes EOF /opt/redis/bin/redis-server /opt/redis/etc/redis_8003.conf & /opt/redis/bin/redis-server /opt/redis/etc/redis_9003.conf & \u56db\u3001\u521b\u5efa\u96c6\u7fa4 redis-cli --cluster create 192.168.40.140:8001 192.168.40.140:9001 192.168.40.141:8002 192.168.40.141:9002 192.168.40.142:8003 192.168.40.142:9003 --cluster-replicas 1 --replicas: \u8868\u793a\u6bcf\u4e2amaster\u6709\u51e0\u4e2aslave \u67e5\u770b\u72b6\u6001 redis-cli --cluster check 192.168.40.140:8001 \u8fde\u63a5 redis-cli -h 192.168.40.140 -p 8001 \u4e94\u3001HAProxy\u914d\u7f6e cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen redis_cluster # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:6379 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.140:8001 check inter 5000 rise 2 fall 2 server node2 192.168.40.141:8002 check inter 5000 rise 2 fall 2 server node3 192.168.40.142:8003 check inter 5000 rise 2 fall 2 server node1 192.168.40.140:9001 check inter 5000 rise 2 fall 2 server node2 192.168.40.141:9002 check inter 5000 rise 2 fall 2 server node3 192.168.40.142:9003 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"Redis\u96c6\u7fa4"},{"location":"service/redis2.html#redis","text":"","title":"Redis\u96c6\u7fa4"},{"location":"service/redis2.html#_1","text":"\u8f6f\u4ef6 \u7248\u672c centos 7.9 redis v5.0.8 IP 192.168.40.140 192.168.40.141 192.168.40.142 \u4e3b\u8282\u70b9 8001 8002 8003 \u5907\u8282\u70b9 9001 9002 9003 \u7f51\u7edc\u62d3\u6251\u56fe:","title":"\u4e00\u3001\u73af\u5883\u89c4\u5212"},{"location":"service/redis2.html#redis_1","text":"\u5b89\u88c5\u4f9d\u8d56 yum -y install gcc \u4e0b\u8f7d\u3001\u89e3\u538b\u3001\u7f16\u8bd1\u5b89\u88c5 wget http://download.redis.io/releases/redis-5.0.8.tar.gz tar -xzvf redis-5.0.8.tar.gz cd redis-5.0.8 mkdir /opt/redis make CFLAGS=\"-march=x86-64\" PREFIX=/opt/redis install \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u7b49\u76ee\u5f55 mkdir -p /opt/redis/{etc,data,logs} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export REDIS_HOME=/opt/redis export PATH=\\$PATH:\\$REDIS_HOME/bin EOF source ~/.bash_profile","title":"\u4e8c\u3001\u5b89\u88c5Redis"},{"location":"service/redis2.html#redis_2","text":"3.1\u3001192.168.40.140 mkdir -p /opt/redis/data/8001 mkdir -p /opt/redis/data/9001 cat >> /opt/redis/etc/redis_8001.conf << EOF daemonize yes bind 0.0.0.0 port 8001 dir /opt/redis/data/8001 pidfile /opt/redis/8001.pid logfile /opt/redis/logs/redis-8001.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-8001.conf cluster-node-timeout 10000 appendonly yes EOF cat >> /opt/redis/etc/redis_9001.conf << EOF daemonize yes bind 0.0.0.0 port 9001 dir /opt/redis/data/9001 pidfile /opt/redis/9001.pid logfile /opt/redis/logs/redis-9001.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-9001.conf cluster-node-timeout 10000 appendonly yes EOF \u542f\u52a8 /opt/redis/bin/redis-server /opt/redis/etc/redis_8001.conf & /opt/redis/bin/redis-server /opt/redis/etc/redis_9001.conf & 3.2\u3001192.168.40.141 mkdir -p /opt/redis/data/8002 mkdir -p /opt/redis/data/9002 cat >> /opt/redis/etc/redis_8002.conf << EOF daemonize yes bind 0.0.0.0 port 8002 dir /opt/redis/data/8002 pidfile /opt/redis/8002.pid logfile /opt/redis/logs/redis-8002.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-8002.conf cluster-node-timeout 10000 appendonly yes EOF cat >> /opt/redis/etc/redis_9002.conf << EOF daemonize yes bind 0.0.0.0 port 9002 dir /opt/redis/data/9002 pidfile /opt/redis/9002.pid logfile /opt/redis/logs/redis-9002.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-9002.conf cluster-node-timeout 10000 appendonly yes EOF /opt/redis/bin/redis-server /opt/redis/etc/redis_8002.conf & /opt/redis/bin/redis-server /opt/redis/etc/redis_9002.conf & 3.3\u3001192.168.40.142 mkdir -p /opt/redis/data/8003 mkdir -p /opt/redis/data/9003 cat >> /opt/redis/etc/redis_8003.conf << EOF daemonize yes bind 0.0.0.0 port 8003 dir /opt/redis/data/8003 pidfile /opt/redis/8003.pid logfile /opt/redis/logs/redis-8003.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-8003.conf cluster-node-timeout 10000 appendonly yes EOF cat >> /opt/redis/etc/redis_9003.conf << EOF daemonize yes bind 0.0.0.0 port 9003 dir /opt/redis/data/9003 pidfile /opt/redis/9003.pid logfile /opt/redis/logs/redis-9003.log cluster-enabled yes cluster-config-file /opt/redis/etc/redis-cluster-9003.conf cluster-node-timeout 10000 appendonly yes EOF /opt/redis/bin/redis-server /opt/redis/etc/redis_8003.conf & /opt/redis/bin/redis-server /opt/redis/etc/redis_9003.conf &","title":"\u4e09\u3001Redis\u914d\u7f6e\u6587\u4ef6"},{"location":"service/redis2.html#_2","text":"redis-cli --cluster create 192.168.40.140:8001 192.168.40.140:9001 192.168.40.141:8002 192.168.40.141:9002 192.168.40.142:8003 192.168.40.142:9003 --cluster-replicas 1 --replicas: \u8868\u793a\u6bcf\u4e2amaster\u6709\u51e0\u4e2aslave \u67e5\u770b\u72b6\u6001 redis-cli --cluster check 192.168.40.140:8001 \u8fde\u63a5 redis-cli -h 192.168.40.140 -p 8001","title":"\u56db\u3001\u521b\u5efa\u96c6\u7fa4"},{"location":"service/redis2.html#haproxy","text":"cat >> /etc/haproxy/haproxy.cfg << EOF # listen\uff1aFrontend\u548cBackend\u7684\u7ec4\u5408\u4f53 listen redis_cluster # \u5b9a\u4e49\u76d1\u542c\u5730\u5740\u548c\u7aef\u53e3 bind 0.0.0.0:6379 # \u914d\u7f6e tcp \u6a21\u5f0f mode tcp # \u7b80\u5355\u7684\u8f6e\u8be2 balance roundrobin #check \u540e\u7aef\u5065\u5eb7\u68c0\u6d4b #inter \u6bcf\u9694\u4e94\u79d2\u5bf9\u96c6\u7fa4\u505a\u5065\u5eb7\u68c0\u67e5\uff0c2\u6b21\u6b63\u786e\u8bc1\u660e\u670d\u52a1\u5668\u53ef\u7528\uff0c #2\u6b21\u5931\u8d25\u8bc1\u660e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u5e76\u4e14\u914d\u7f6e\u4e3b\u5907\u673a\u5236 server node1 192.168.40.140:8001 check inter 5000 rise 2 fall 2 server node2 192.168.40.141:8002 check inter 5000 rise 2 fall 2 server node3 192.168.40.142:8003 check inter 5000 rise 2 fall 2 server node1 192.168.40.140:9001 check inter 5000 rise 2 fall 2 server node2 192.168.40.141:9002 check inter 5000 rise 2 fall 2 server node3 192.168.40.142:9003 check inter 5000 rise 2 fall 2 EOF systemctl restart haproxy","title":"\u4e94\u3001HAProxy\u914d\u7f6e"},{"location":"service/sit.html","text":"SIT\u73af\u5883\u670d\u52a1\u5b89\u88c5 \u4e00\u3001Consul\u6ce8\u518c\u4e2d\u5fc3\u670d\u52a1 \u4e0b\u8f7d\u4e0e\u89e3\u538b wget --no-check-certificate https://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip unzip consul_1.9.3_linux_amd64.zip \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76f8\u5173\u76ee\u5f55 mkdir -p /opt/consul/{bin,conf,data,log} mv consul /opt/consul/bin \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> /etc/profile << EOF export CONSUL_HOME=/opt/consul export PATH=\\${PATH}:\\${CONSUL_HOME}/bin EOF source /etc/profile consul\u914d\u7f6e\u6587\u4ef6 cat >> /opt/consul/conf/server.json << EOF { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"data_dir\": \"/opt/consul/data\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"node_name\": \"192.168.40.121\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 1, } EOF consul\u542f\u52a8 consul agent -config-dir=/opt/consul/conf & \u67e5\u770bconsul\u6210\u5458\u4fe1\u606f consul members consul \u8fd0\u884c\u72b6\u6001\u4fe1\u606f consul info \u4e8c\u3001Rabbitmq\u6d88\u606f\u961f\u5217\u670d\u52a1 \u5b89\u88c5\u4f9d\u8d56\u5305 yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel libxml2-utils libxml2 libxslt openssl-devel unixODBC unixODBC-devel unixODBC-bin gtk2 fop gtk2-devel binutils-devel mesa-libGLU-devel erlang\u6e90\u7801\u7f16\u8bd1 tar -xvf otp_src_20.1.tar.gz mkdir /opt/erlang cd otp_src_20.1 ./configure --prefix=/opt/erlang make && make install rabbitmq\u4e0b\u8f7d\u4e0e\u89e3\u538b tar -xvf rabbitmq-server-generic-unix-3.7.17.tar mv rabbitmq_server-3.7.17 /opt \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export ERLANG_HOME=/opt/erlang export PATH=\\${PATH}:\\${ERLANG_HOME}/bin export RABBITMQ_HOME=/opt/rabbitmq_server-3.7.17 export PATH=\\${PATH}:\\${RABBITMQ_HOME}/sbin EOF source ~/.bash_profile \u542f\u52a8Rabbitmq rabbitmq-server & \u5f00\u542fRabbitmq\u7ba1\u7406\u63a7\u5236\u53f0 cat >> /opt/rabbitmq_server-3.7.17/etc/rabbitmq/rabbitmq.config << EOF [{rabbit, [{loopback_users, []}]}]. EOF \u542f\u7528\u7ba1\u7406\u63a7\u5236\u53f0 rabbitmq-plugins enable rabbitmq_management \u91cd\u542f rabbitmq \u662f\u914d\u7f6e\u751f\u6548 rabbitmqctl stop rabbitmq-server & \u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee:http://192.168.40.121:15672\uff0c\u7528\u6237\u540dguest\uff0c\u5bc6\u7801guest \u5b89\u88c5\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 \u4e0a\u4f20\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 cp rabbitmq_delayed_message_exchange-3.8.0.ez /opt/rabbitmq_server-3.7.17/plugins/ \u5f00\u542f\u63d2\u4ef6\uff1a rabbitmq-plugins enable rabbitmq_delayed_message_exchange \u67e5\u8be2\u5b89\u88c5\u7684\u6240\u6709\u63d2\u4ef6\uff1a rabbitmq-plugins list \u770b\u5230\u8fd9\u4e2a\u67e5\u770brabbitmq_delayed_message_exchange 3.8.0\u8868\u793a\u5b89\u88c5\u6210\u529f \u91cd\u542f\u4f7f\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6\u751f\u6548 rabbitmqctl stop rabbitmq-server & \u4e09\u3001Mongodb\u6570\u636e\u5e93 mongodb\u5b89\u88c5 wget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.4.tgz tar -xzvf mongodb-linux-x86_64-rhel70-4.4.4.tgz -C /opt/ cd /opt mv mongodb-linux-x86_64-rhel70-4.4.4 mongodb \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p /opt/mongodb/{conf,data,log} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export MONGODB_HOME=/opt/mongodb export PATH=\\${PATH}:\\${MONGODB_HOME}/bin EOF source ~/.bash_profile mongod\u914d\u7f6e\u6587\u4ef6 cat >> /opt/mongodb/conf/config.conf << EOF systemLog: destination: file logAppend: true path: /opt/mongodb/log/mongodb.log storage: dbPath: /opt/mongodb/data/ journal: enabled: true processManagement: fork: true net: port: 27017 bindIp: 0.0.0.0 EOF \u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/config.conf \u8fde\u63a5\u5ba2\u6237\u7aef mongo 127.0.0.1:27017 \u56db\u3001Redis\u7f13\u5b58\u670d\u52a1 \u5b89\u88c5\u4f9d\u8d56 yum -y install gcc \u7f16\u8bd1\u5b89\u88c5 wget http://download.redis.io/releases/redis-5.0.8.tar.gz tar -xzvf redis-5.0.8.tar.gz mkdir -p /opt/redis cd redis-5.0.8 make CFLAGS=\"-march=x86-64\" PREFIX=/opt/redis install \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p mkdir -p /opt/redis/{data,logs,etc} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export REDIS_HOME=/opt/redis export PATH=\\$PATH:\\$REDIS_HOME/bin EOF source ~/.bash_profile redis\u914d\u7f6e\u6587\u4ef6 cat >> /opt/redis/etc/redis.conf << EOF daemonize yes bind 0.0.0.0 port 6379 pidfile /opt/redis/redis.pid dir /opt/redis/data/ logfile /opt/redis/logs/redis.log dbfilename dump.rdb EOF redis\u542f\u52a8 /opt/redis/bin/redis-server /opt/redis/etc/redis.conf & \u5ba2\u6237\u7aef\u8fde\u63a5 redis-cli -h 127.0.0.1 -p 6379 \u521d\u59cb\u5316Redis\u5bc6\u7801\uff1a \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e2a\u53c2\u6570\uff1a requirepass \u8fd9\u4e2a\u5c31\u662f\u914d\u7f6eredis\u8bbf\u95ee\u5bc6\u7801\u7684\u53c2\u6570\uff1b \u6bd4\u5982 requirepass test123\uff1b \uff08Ps:\u9700\u91cd\u542fRedis\u624d\u80fd\u751f\u6548\uff09 redis\u7684\u67e5\u8be2\u901f\u5ea6\u662f\u975e\u5e38\u5feb\u7684\uff0c\u5916\u90e8\u7528\u6237\u4e00\u79d2\u5185\u53ef\u4ee5\u5c1d\u8bd5\u591a\u5927150K\u4e2a\u5bc6\u7801\uff1b\u6240\u4ee5\u5bc6\u7801\u8981\u5c3d\u91cf\u957f\uff08\u5bf9\u4e8eDBA \u6ca1\u6709\u5fc5\u8981\u5fc5\u987b\u8bb0\u4f4f\u5bc6\u7801\uff09\uff1b \u4e0d\u91cd\u542fRedis\u8bbe\u7f6e\u5bc6\u7801\uff1a \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6erequirepass\u7684\u5bc6\u7801\uff08\u5f53redis\u91cd\u542f\u65f6\u5bc6\u7801\u4f9d\u7136\u6709\u6548\uff09\u3002 redis 127.0.0.1:6379> config set requirepass test123 \u67e5\u8be2\u5bc6\u7801\uff1a redis 127.0.0.1:6379> config get requirepass (error) ERR operation not permitted \u5bc6\u7801\u9a8c\u8bc1\uff1a redis 127.0.0.1:6379> auth test123 OK \u518d\u6b21\u67e5\u8be2\uff1a redis 127.0.0.1:6379> config get requirepass 1) \"requirepass\" 2) \"test123\" PS\uff1a\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u4e2d\u6ca1\u6dfb\u52a0\u5bc6\u7801 \u90a3\u4e48redis\u91cd\u542f\u540e\uff0c\u5bc6\u7801\u5931\u6548 \u4e94\u3001Mysql\u6570\u636e\u5e93 \u8f6f\u4ef6\u5305\u4e0b\u8f7d\u4e0e\u89e3\u538b tar -xzvf mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz mv mysql-5.6.51-linux-glibc2.12-x86_64 /opt/mysql \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p /opt/mysql/data mkdir -p /opt/mysql/logs useradd mysql chown -R mysql:mysql /opt/mysql \u914d\u7f6eMySQL\u73af\u5883\u53d8\u91cf cat >> /etc/profile << EOF export PATH=\\$PATH:/opt/mysql/bin EOF source /etc/profile \u521d\u59cb\u5316\u6570\u636e\u5e93 /opt/mysql/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql --datadir=/opt/mysql/data \u521d\u59cb\u5316\u6570\u636e\u5e93\u62a5\u9519\uff1a - 1\u3001FATAL ERROR: please install the following Perl modules before executing /opt/mysql/scripts/mysql_install_db: Data::Dumpe yum -y install autoconf 2\u3001Installing MySQL system tables.../opt/mysql/bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory yum install libaio* -y MySQL\u914d\u7f6e\u6587\u4ef6 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log default_storage_engine=Innodb max_connections = 1024 EOF \u4f7f\u7528mysql.server\u547d\u4ee4\u53bb\u542f\u52a8mysql cp /opt/mysql/support-files/mysql.server /opt/mysql/bin \u5728mysql.server\u547d\u4ee4\u91cc\u9762\u6dfb\u52a0basedir\u548cdatadir\u7684\u8def\u5f84 cat mysql.server basedir=/opt/mysql datadir=/opt/mysql/data \u542f\u52a8mysql mysql.server start mysql.server status mysql\u5bc6\u7801\u8bbe\u7f6e mysqladmin -uroot password '2wsx#EDC' mysql \u767b\u5f55 mysql -uroot -p \u521b\u5efaroot\u8fdc\u7a0b\u767b\u5f55\u7528\u6237 GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION; flush privilieges; \u516d\u3001Docker\u5bb9\u5668\u670d\u52a1 \u5b89\u88c5\u4f9d\u8d56 sudo yum install -y yum-utils device-mapper-persistent-data lvm2 \u6dfb\u52a0\u963f\u91cc\u4e91Docker\u6e90 curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo \u5b89\u88c5Docker sudo yum -y install docker-ce \u8fc1\u79fbdocker\u5bb9\u5668\u9ed8\u8ba4\u5b58\u653e\u76ee\u5f55 mv /var/lib/docker /opt/docker ln -s /opt/docker /var/lib/docker \u914d\u7f6eDocker\u955c\u50cf\u52a0\u901f curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io \u67e5\u770b\u955c\u50cf\u52a0\u901f\u914d\u7f6e cat /etc/docker/daemon.json \u542f\u52a8Docker\u670d\u52a1\u5e76\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8 systemctl enable docker systemctl start docker \u5f00\u542f\u8def\u7531\u8f6c\u53d1\u529f\u80fd \u5426\u5219\u5bb9\u5668\u4e2d\u7684\u5b9e\u4f8b\u4e0a\u4e0d\u4e86\u7f51\u3002 echo 1 > /proc/sys/net/ipv4/ip_forward \u4f7f\u7528\u975e root \u7528\u6237\u7ba1\u7406docker \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cdocker\u53ea\u80fd\u5728root\u7528\u6237\u6743\u9650\u4e0b\u8fd0\u884c\uff0c\u975eroot\u7528\u6237\u9700\u8981\u4f7f\u7528sudo\u624d\u80fd\u8fd0\u884c\u3002\u6700\u65b0\u7248\u7684Docker\u901a\u8fc7\u6dfb\u52a0docker\u7528\u6237\u7ec4\u6765\u5b9e\u73b0\u975eroot\u6743\u9650\u7528\u6237\u64cd\u4f5cdocker\u7684\u529f\u80fd\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cdocker\u7528\u6237\u7ec4\u5b9e\u8d28\u4e0a\u548croot\u7528\u6237\u662f\u4e00\u6837\u7684\uff0c\u56e0\u6b64\u5176\u5bf9\u7cfb\u7edf\u5b89\u5168\u7684\u5f71\u54cd\u4e5f\u662f\u4e00\u6837\u7684\u3002\u8981\u4f7f\u7528\u975eroot\u7528\u6237\u7ba1\u7406docker\u3002 \u9996\u5148\u521b\u5efa docker \u7528\u6237\u7ec4\uff1a sudo groupadd docker \u7136\u540e\u5c06\u5f53\u524d\u7528\u6237\u6dfb\u52a0\u5230 docker \u7528\u6237\u7ec4\u4e2d\uff1a sudo usermod -aG docker $USER \u6ce8\u9500\u5f53\u524d\u7528\u6237\u5e76\u91cd\u65b0\u767b\u5f55\uff08\u6216\u8005\u91cd\u542f\u7535\u8111\uff09\u540e\uff0c\u7528\u6237\u5373\u53ef\u88ab\u6dfb\u52a0\u5230 docker \u7528\u6237\u7ec4\u4e2d\u3002\u5728linux\u7cfb\u7edf\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5feb\u901f\u6fc0\u6d3b docker \u7528\u6237\u7ec4\u3002 newgrp docker \u4e03\u3001Docker\u5bb9\u5668\u7ba1\u7406 \u4e0b\u8f7d Docker Compose \u7684\u5f53\u524d\u7a33\u5b9a\u7248\u672c\uff1a sudo curl -L \"https://github.com/docker/compose/releases/download/1.28.5/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose \u5c06\u53ef\u6267\u884c\u6743\u9650\u5e94\u7528\u4e8e\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a sudo chmod +x /usr/local/bin/docker-compose \u6d4b\u8bd5\u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a docker-compose --version \u516b\u3001TFTP\u6587\u4ef6\u670d\u52a1\u811a\u672c cat ftp.sh #!/bin/bash export JAVA_HOME=/root/ftp/jdk1.8.0_231/bin client_primary=/home/admin/www/njbank/wageftp client_success=/home/admin/www/njbank/wagepay for i in $(ls ${client_primary}) do date=$(echo \"$i\" | cut -d \"_\" -f 4 | cut -c 1-8) count=$(java -Desb.cfg.path=/root/ftp/TFTClient/config -jar /root/ftp/TFTClient/tftclient.jar -h 1 -dup -cf $client_primary/$i -sf $i) if [ $count -eq 0 ] ; then mkdir -p ${client_success}/$date mv $client_primary/$i $client_success/$date fi done Client\u6709\u4e09\u4e2a\u76ee\u5f55\uff1a\u4e34\u65f6\u76ee\u5f55\u3001\u4e0a\u4f20\u76ee\u5f55\u3001\u5907\u4efd\u76ee\u5f55 \u4ee3\u7801\u4f1a\u5728\u4e34\u65f6\u76ee\u5f55\u91cc\u9762\u751f\u6210\u5199\u5165\u7684\u6587\u4ef6\uff0c\u5f53\u6587\u4ef6\u5199\u5165\u5b8c\u6210\uff0c\u4ee3\u7801\u4f1a\u79fb\u52a8\u5230\u4e0a\u4f20\u76ee\u5f55\uff0cftp.sh\u811a\u672c\u4f1a\u5b9a\u65f6\u626b\u63cf\u4e0a\u4f20\u76ee\u5f55\u662f\u5426\u6709\u6587\u4ef6\uff0c\u5982\u679c\u6709\u5c31\u4e0a\u4f20\uff0c\u4e0a\u4f20\u6210\u529f\u7684\u540c\u65f6\u4f1a\u628a\u6587\u4ef6\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55 client_primary \u4e0a\u4f20\u6587\u4ef6\u76ee\u5f55\u7684\u8def\u5f84 client_success \u5907\u4efd\u76ee\u5f55\u8def\u5f84 \u8981\u6307\u5b9aJDK\u7684\u547d\u4ee4\u8def\u5f84,\u811a\u672c\u91cc\u9762\u53ef\u80fd\u627e\u4e0d\u5230java\u547d\u4ee4 export JAVA_HOME=/root/ftp/jdk1.8.0_231/bin Client\u5b89\u88c5\u5728/root/ftp/TFTClient/\u4e0b JAVA \u5728\u8c03\u53d6jar\u5305\u65f6\u662f\u8981\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84/root/ftp/TFTClient/tftclient.jar\u3001/root/ftp/TFTClient/config \u6bcf\u5206\u949f\u6267\u884cftp.sh\u811a\u672c * * * * * /bin/sh /root/ftp/ftp.sh \u4e5d\u3001\u6570\u636e\u5e93\u4fe1\u606f \u7528\u9014 \u6570\u636e\u7c7b\u578b \u6570\u636e\u5e93\u540d \u7528\u6237 \u5bc6\u7801 mysql \u4e1a\u52a1\u5e93 mysql sit_kayak_nanjingbank nanjing mongo \u4e1a\u52a1\u5e93 mongodb kayaknanjingbank nanjing mongo \u65e5\u5fd7 mongodblogs nanjingbanklogs nanjinglogs mongo \u5206\u6790\u5e93 nanjingbankdatacount nanjingbankdatacount nanjingdata mongo \u6d88\u606f\u5e93 nanjingbanknews nanjingbanknews nanjingnews mongo ids\u7edf\u4e00\u8ba4\u8bc1 nanjingbankids nanjingbankids nanjingids mongo \u7ecf\u653e\u85aa\u7406\u5e93 nanjingbankmanager nanjingbankmanager anjingmanager \u5341\u3001\u653e\u85aa\u7ecf\u7406\u540c\u6b65python\u811a\u672c\u5b9a\u65f6\u4efb\u52a1 1\u3001python3.7\u73af\u5883\u5b89\u88c5 \u6ce8\u610f\uff1a\u9700\u8981root\u6743\u9650 \u67e5\u770bpython\u7248\u672c: python --version \u4e0b\u8f7dPython-3.7.10 wget https://www.python.org/ftp/python/3.7.10/Python-3.7.10.tgz \u538b\u7f29\u5305\u9644\u5e26\u8f6f\u4ef6\u5305 \u89e3\u538b tar zxvf Python-3.7.10.tgz \u66f4\u6539\u5de5\u4f5c\u76ee\u5f55 cd Python-3.7.10 \u5b89\u88c5\u7cfb\u7edf\u4f9d\u8d56 yum install zlib openssl- \u4fee\u6539\u5b89\u88c5\u6587\u4ef6 Python-3.7.10/Modules/Setup.dist \u627e\u5230SSL \u5177\u4f53\u884c\u6570\u4e3a211,\u6253\u5f00211-214\u884c\u7684\u6ce8\u91ca \u4fee\u6539SSL=/etc/ssl \u4fdd\u5b58\u8bb0\u5f55 \u7136\u540e\u786e\u8ba4\u4e0b\u8def\u5f84/etc/ssl \u8def\u5f84\u6709\u5185\u5bb9 \u4e0d\u9700\u8981\u81ea\u5df1\u521b\u5efa \u7cfb\u7edf\u9ed8\u8ba4\u5b89\u88c5\u6709\u7684 \u5b89\u88c5 ./configure --with-ssl make all make install make clean make distclean \u67e5\u770b\u7248\u672c\u4fe1\u606f /usr/local/bin/python3.7 -V \u5b89\u88c5\u4f9d\u8d56 pip3 install --no-index --find-links=/tmp/packages -r requirments.txt 2\u3001\u811a\u672c\u914d\u7f6e\u65b9\u6cd5 \u6570\u636e\u6307\u6807\u8ba1\u7b97 \u81ea\u52a8\u5316\u90e8\u7f72 \u7ecf\u7406\u6307\u6807\u6570\u636e\u8dd1\u6279\u90e8\u7f72\uff0c\u64cd\u4f5c\u6d41\u7a0b \u524d\u7f6e\u6761\u4ef6\uff1a \u670d\u52a1\u5668\u4e0a\u9700\u8981\u6309\u7167python3\u73af\u5883\u3001mongo\u73af\u5883 1.\u5c06 njcb \u6587\u4ef6\u5939\u62f7\u8d1d\u5230\u670d\u52a1\u5668\u5bf9\u5e94\u7528\u6237\u4e0b\uff0c\u4f4d\u7f6e\u81ea\u5b9a\u4e49 2.\u4fee\u6539\u4ee5\u4e0b\u4e24\u4e2a\u6587\u4ef6\u7684\u5bf9\u5e94\u53d8\u91cf \u3010\u4fee\u6539 python \u547d\u4ee4\u8def\u5f84\u3001mongodb \u547d\u4ee4\u8def\u5f84\u3001\u6570\u636e\u5e93\u5730\u5740\u3001\u7528\u6237\u76ee\u5f55\u7b49\uff0c\u8be6\u89c1\u4ee3\u7801\u6ce8\u91ca\u3011 \u2460/njcb/csv/csvlinux.py \u2461/njcb/count/countlinux.py 3.\u4fee\u6539\u5b8c\u4e4b\u540e \u6267\u884c\u2460csvlinux.py \u5bf9\u5e94\u751f\u6210 \u2462datacount_days.sh \u6267\u884c\u2461countlinux.py \u5bf9\u5e94\u751f\u6210 \u2463fxjl_days.sh \u2462\u2463\u811a\u672c\u5728 host_user \u53d8\u91cf\u6307\u5b9a\u76ee\u5f55\u4e0b\u751f\u6210 4.\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff0c\u6309\u987a\u5e8f\u6267\u884c\u811a\u672c \u2462datacount_days.sh\u3001\u2463fxjl_days.sh \u5e76\u4e14\u2462\u548c\u2463\u811a\u672c\u7684\u6267\u884c\u95f4\u9694\u4e00\u5c0f\u65f6(\u6839\u636e\u6570\u636e\u91cf\u5927\u5c0f\u8c03\u6574\u65f6\u95f4) windows \u5e73\u53f0\u4e0b\u6267\u884ccountwindows.py\u811a\u672c linux \u5e73\u53f0\u4e0b\u6267\u884ccountlinux.py\u811a\u672c \u73af\u5883\u8981\u6c42 linux\u3001window \u670d\u52a1\u73af\u5883\u4e0b\u5fc5\u987b\u5b89\u88c5mongodb\u6570\u636e\u5e93\u3001python3\u73af\u5883 \u914d\u7f6e\u4fee\u6539 1.\u4fee\u6539mongodb\u76f8\u5173\u914d\u7f6e mongo_path\uff1amongodb \u547d\u4ee4\uff0c\u73af\u5883\u53d8\u91cf\u6240\u5728\u7684\u76ee\u5f55 mongo_db_host\uff1amongodb \u6570\u636e\u5e93\u8fde\u63a5 mongo_db_host1\uff1amongodb \u6570\u636e\u5e93\u8fde\u63a5\uff08\u5907\u4efd\u8282\u70b91\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\uff0c\u5c06\u4e09\u4e2a\u914d\u7f6e\u6210\u4e00\u6837\uff09 mongo_db_host2\uff1amongodb \u6570\u636e\u5e93\u8fde\u63a5\uff08\u5907\u4efd\u8282\u70b92\uff09 mongo_db_user\uff1a\u6570\u636e\u5e93\u7528\u6237\u540d mongo_db_password\uff1a\u6570\u636e\u5e93\u5bc6\u7801 2.\u4fee\u6539python\u6267\u884c\u914d\u7f6e python_path\uff1apython\u547d\u4ee4\uff0c\u73af\u5883\u53d8\u91cf\u6240\u5728\u7684\u76ee\u5f55 3.\u4fee\u6539\u670d\u52a1\u5668\u4e3b\u76ee\u5f55 host_user\uff1awindow\u4e0b\uff0c\u4efb\u610f\u76ee\u5f55\u5373\u53ef\u3002linux\u73af\u5883\u4e0b\uff0c\u987b\u6307\u5b9ahome\u76ee\u5f55\u4e0b\u7528\u6237\u7684\u6839\u76ee\u5f55\uff0c\u4f8b\u5982:root\u7528\u6237\uff0c\u5219host_user=/home/root \u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e \u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff1a\u5165\u53e3 fxjl_days.sh \u6587\u4ef6 \u5c06fxjl_days.sh \u811a\u672c\u914d\u7f6e\u6210\u5b9a\u65f6\u8dd1\u6279\u4efb\u52a1 \u5341\u4e00\u3001\u5458\u5de5\u4fe1\u606f\u540c\u6b65 #!/bin/bash export JAVA_HOME=/root/ftp/jdk1.8.0_231 client_primary=/home/admin/www/upload/data_extracting/empsyn client_backup=/home/admin/www/upload/data_extracting/empsyn/backup for i in $(ls ${client_primary} | grep .csv) do count=$(java -Desb.cfg.path=/root/ftp/TFTClient/config -jar /root/ftp/TFTClient/tftclient.jar -h 1 -dup -cf $client_primary/$i -sf $i) if [ $count -eq 0 ] ; then mv $client_primary/$i $client_backup fi done","title":"SIT\u73af\u5883\u90e8\u7f72"},{"location":"service/sit.html#sit","text":"","title":"SIT\u73af\u5883\u670d\u52a1\u5b89\u88c5"},{"location":"service/sit.html#consul","text":"\u4e0b\u8f7d\u4e0e\u89e3\u538b wget --no-check-certificate https://releases.hashicorp.com/consul/1.9.3/consul_1.9.3_linux_amd64.zip unzip consul_1.9.3_linux_amd64.zip \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76f8\u5173\u76ee\u5f55 mkdir -p /opt/consul/{bin,conf,data,log} mv consul /opt/consul/bin \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> /etc/profile << EOF export CONSUL_HOME=/opt/consul export PATH=\\${PATH}:\\${CONSUL_HOME}/bin EOF source /etc/profile consul\u914d\u7f6e\u6587\u4ef6 cat >> /opt/consul/conf/server.json << EOF { \"bind_addr\": \"0.0.0.0\", \"client_addr\": \"0.0.0.0\", \"data_dir\": \"/opt/consul/data\", \"log_level\": \"INFO\", \"log_file\": \"/opt/consul/log/consul.log\", \"log_rotate_duration\": \"24h\", \"node_name\": \"192.168.40.121\", \"server\": true, \"ui\": true, \"bootstrap_expect\": 1, } EOF consul\u542f\u52a8 consul agent -config-dir=/opt/consul/conf & \u67e5\u770bconsul\u6210\u5458\u4fe1\u606f consul members consul \u8fd0\u884c\u72b6\u6001\u4fe1\u606f consul info","title":"\u4e00\u3001Consul\u6ce8\u518c\u4e2d\u5fc3\u670d\u52a1"},{"location":"service/sit.html#rabbitmq","text":"\u5b89\u88c5\u4f9d\u8d56\u5305 yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel libxml2-utils libxml2 libxslt openssl-devel unixODBC unixODBC-devel unixODBC-bin gtk2 fop gtk2-devel binutils-devel mesa-libGLU-devel erlang\u6e90\u7801\u7f16\u8bd1 tar -xvf otp_src_20.1.tar.gz mkdir /opt/erlang cd otp_src_20.1 ./configure --prefix=/opt/erlang make && make install rabbitmq\u4e0b\u8f7d\u4e0e\u89e3\u538b tar -xvf rabbitmq-server-generic-unix-3.7.17.tar mv rabbitmq_server-3.7.17 /opt \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export ERLANG_HOME=/opt/erlang export PATH=\\${PATH}:\\${ERLANG_HOME}/bin export RABBITMQ_HOME=/opt/rabbitmq_server-3.7.17 export PATH=\\${PATH}:\\${RABBITMQ_HOME}/sbin EOF source ~/.bash_profile \u542f\u52a8Rabbitmq rabbitmq-server & \u5f00\u542fRabbitmq\u7ba1\u7406\u63a7\u5236\u53f0 cat >> /opt/rabbitmq_server-3.7.17/etc/rabbitmq/rabbitmq.config << EOF [{rabbit, [{loopback_users, []}]}]. EOF \u542f\u7528\u7ba1\u7406\u63a7\u5236\u53f0 rabbitmq-plugins enable rabbitmq_management \u91cd\u542f rabbitmq \u662f\u914d\u7f6e\u751f\u6548 rabbitmqctl stop rabbitmq-server & \u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee:http://192.168.40.121:15672\uff0c\u7528\u6237\u540dguest\uff0c\u5bc6\u7801guest \u5b89\u88c5\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 \u4e0a\u4f20\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6 cp rabbitmq_delayed_message_exchange-3.8.0.ez /opt/rabbitmq_server-3.7.17/plugins/ \u5f00\u542f\u63d2\u4ef6\uff1a rabbitmq-plugins enable rabbitmq_delayed_message_exchange \u67e5\u8be2\u5b89\u88c5\u7684\u6240\u6709\u63d2\u4ef6\uff1a rabbitmq-plugins list \u770b\u5230\u8fd9\u4e2a\u67e5\u770brabbitmq_delayed_message_exchange 3.8.0\u8868\u793a\u5b89\u88c5\u6210\u529f \u91cd\u542f\u4f7f\u5ef6\u8fdf\u961f\u5217\u63d2\u4ef6\u751f\u6548 rabbitmqctl stop rabbitmq-server &","title":"\u4e8c\u3001Rabbitmq\u6d88\u606f\u961f\u5217\u670d\u52a1"},{"location":"service/sit.html#mongodb","text":"mongodb\u5b89\u88c5 wget --no-check-certificate https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.4.4.tgz tar -xzvf mongodb-linux-x86_64-rhel70-4.4.4.tgz -C /opt/ cd /opt mv mongodb-linux-x86_64-rhel70-4.4.4 mongodb \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p /opt/mongodb/{conf,data,log} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export MONGODB_HOME=/opt/mongodb export PATH=\\${PATH}:\\${MONGODB_HOME}/bin EOF source ~/.bash_profile mongod\u914d\u7f6e\u6587\u4ef6 cat >> /opt/mongodb/conf/config.conf << EOF systemLog: destination: file logAppend: true path: /opt/mongodb/log/mongodb.log storage: dbPath: /opt/mongodb/data/ journal: enabled: true processManagement: fork: true net: port: 27017 bindIp: 0.0.0.0 EOF \u542f\u52a8 /opt/mongodb/bin/mongod -f /opt/mongodb/conf/config.conf \u8fde\u63a5\u5ba2\u6237\u7aef mongo 127.0.0.1:27017","title":"\u4e09\u3001Mongodb\u6570\u636e\u5e93"},{"location":"service/sit.html#redis","text":"\u5b89\u88c5\u4f9d\u8d56 yum -y install gcc \u7f16\u8bd1\u5b89\u88c5 wget http://download.redis.io/releases/redis-5.0.8.tar.gz tar -xzvf redis-5.0.8.tar.gz mkdir -p /opt/redis cd redis-5.0.8 make CFLAGS=\"-march=x86-64\" PREFIX=/opt/redis install \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p mkdir -p /opt/redis/{data,logs,etc} \u914d\u7f6e\u73af\u5883\u53d8\u91cf cat >> ~/.bash_profile << EOF export REDIS_HOME=/opt/redis export PATH=\\$PATH:\\$REDIS_HOME/bin EOF source ~/.bash_profile redis\u914d\u7f6e\u6587\u4ef6 cat >> /opt/redis/etc/redis.conf << EOF daemonize yes bind 0.0.0.0 port 6379 pidfile /opt/redis/redis.pid dir /opt/redis/data/ logfile /opt/redis/logs/redis.log dbfilename dump.rdb EOF redis\u542f\u52a8 /opt/redis/bin/redis-server /opt/redis/etc/redis.conf & \u5ba2\u6237\u7aef\u8fde\u63a5 redis-cli -h 127.0.0.1 -p 6379 \u521d\u59cb\u5316Redis\u5bc6\u7801\uff1a \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e2a\u53c2\u6570\uff1a requirepass \u8fd9\u4e2a\u5c31\u662f\u914d\u7f6eredis\u8bbf\u95ee\u5bc6\u7801\u7684\u53c2\u6570\uff1b \u6bd4\u5982 requirepass test123\uff1b \uff08Ps:\u9700\u91cd\u542fRedis\u624d\u80fd\u751f\u6548\uff09 redis\u7684\u67e5\u8be2\u901f\u5ea6\u662f\u975e\u5e38\u5feb\u7684\uff0c\u5916\u90e8\u7528\u6237\u4e00\u79d2\u5185\u53ef\u4ee5\u5c1d\u8bd5\u591a\u5927150K\u4e2a\u5bc6\u7801\uff1b\u6240\u4ee5\u5bc6\u7801\u8981\u5c3d\u91cf\u957f\uff08\u5bf9\u4e8eDBA \u6ca1\u6709\u5fc5\u8981\u5fc5\u987b\u8bb0\u4f4f\u5bc6\u7801\uff09\uff1b \u4e0d\u91cd\u542fRedis\u8bbe\u7f6e\u5bc6\u7801\uff1a \u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6erequirepass\u7684\u5bc6\u7801\uff08\u5f53redis\u91cd\u542f\u65f6\u5bc6\u7801\u4f9d\u7136\u6709\u6548\uff09\u3002 redis 127.0.0.1:6379> config set requirepass test123 \u67e5\u8be2\u5bc6\u7801\uff1a redis 127.0.0.1:6379> config get requirepass (error) ERR operation not permitted \u5bc6\u7801\u9a8c\u8bc1\uff1a redis 127.0.0.1:6379> auth test123 OK \u518d\u6b21\u67e5\u8be2\uff1a redis 127.0.0.1:6379> config get requirepass 1) \"requirepass\" 2) \"test123\" PS\uff1a\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u4e2d\u6ca1\u6dfb\u52a0\u5bc6\u7801 \u90a3\u4e48redis\u91cd\u542f\u540e\uff0c\u5bc6\u7801\u5931\u6548","title":"\u56db\u3001Redis\u7f13\u5b58\u670d\u52a1"},{"location":"service/sit.html#mysql","text":"\u8f6f\u4ef6\u5305\u4e0b\u8f7d\u4e0e\u89e3\u538b tar -xzvf mysql-5.6.51-linux-glibc2.12-x86_64.tar.gz mv mysql-5.6.51-linux-glibc2.12-x86_64 /opt/mysql \u521b\u5efa\u6570\u636e\u548c\u65e5\u5fd7\u76ee\u5f55 mkdir -p /opt/mysql/data mkdir -p /opt/mysql/logs useradd mysql chown -R mysql:mysql /opt/mysql \u914d\u7f6eMySQL\u73af\u5883\u53d8\u91cf cat >> /etc/profile << EOF export PATH=\\$PATH:/opt/mysql/bin EOF source /etc/profile \u521d\u59cb\u5316\u6570\u636e\u5e93 /opt/mysql/scripts/mysql_install_db --user=mysql --basedir=/opt/mysql --datadir=/opt/mysql/data \u521d\u59cb\u5316\u6570\u636e\u5e93\u62a5\u9519\uff1a - 1\u3001FATAL ERROR: please install the following Perl modules before executing /opt/mysql/scripts/mysql_install_db: Data::Dumpe yum -y install autoconf 2\u3001Installing MySQL system tables.../opt/mysql/bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory yum install libaio* -y MySQL\u914d\u7f6e\u6587\u4ef6 cat >> /opt/mysql/my.cnf << EOF [mysql] socket=/tmp/mysql.sock character-set-server=utf8 [client] socket=/tmp/mysql.sock [mysqld] user = mysql port=3306 socket=/tmp/mysql.sock pid-file=/opt/mysql/mysqld.pid character-set-server=utf8 collation-server = utf8_general_ci basedir=/opt/mysql datadir=/opt/mysql/data log-error=/opt/mysql/logs/mysqld.log default_storage_engine=Innodb max_connections = 1024 EOF \u4f7f\u7528mysql.server\u547d\u4ee4\u53bb\u542f\u52a8mysql cp /opt/mysql/support-files/mysql.server /opt/mysql/bin \u5728mysql.server\u547d\u4ee4\u91cc\u9762\u6dfb\u52a0basedir\u548cdatadir\u7684\u8def\u5f84 cat mysql.server basedir=/opt/mysql datadir=/opt/mysql/data \u542f\u52a8mysql mysql.server start mysql.server status mysql\u5bc6\u7801\u8bbe\u7f6e mysqladmin -uroot password '2wsx#EDC' mysql \u767b\u5f55 mysql -uroot -p \u521b\u5efaroot\u8fdc\u7a0b\u767b\u5f55\u7528\u6237 GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION; flush privilieges;","title":"\u4e94\u3001Mysql\u6570\u636e\u5e93"},{"location":"service/sit.html#docker","text":"\u5b89\u88c5\u4f9d\u8d56 sudo yum install -y yum-utils device-mapper-persistent-data lvm2 \u6dfb\u52a0\u963f\u91cc\u4e91Docker\u6e90 curl -o /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo \u5b89\u88c5Docker sudo yum -y install docker-ce \u8fc1\u79fbdocker\u5bb9\u5668\u9ed8\u8ba4\u5b58\u653e\u76ee\u5f55 mv /var/lib/docker /opt/docker ln -s /opt/docker /var/lib/docker \u914d\u7f6eDocker\u955c\u50cf\u52a0\u901f curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io \u67e5\u770b\u955c\u50cf\u52a0\u901f\u914d\u7f6e cat /etc/docker/daemon.json \u542f\u52a8Docker\u670d\u52a1\u5e76\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8 systemctl enable docker systemctl start docker \u5f00\u542f\u8def\u7531\u8f6c\u53d1\u529f\u80fd \u5426\u5219\u5bb9\u5668\u4e2d\u7684\u5b9e\u4f8b\u4e0a\u4e0d\u4e86\u7f51\u3002 echo 1 > /proc/sys/net/ipv4/ip_forward \u4f7f\u7528\u975e root \u7528\u6237\u7ba1\u7406docker \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cdocker\u53ea\u80fd\u5728root\u7528\u6237\u6743\u9650\u4e0b\u8fd0\u884c\uff0c\u975eroot\u7528\u6237\u9700\u8981\u4f7f\u7528sudo\u624d\u80fd\u8fd0\u884c\u3002\u6700\u65b0\u7248\u7684Docker\u901a\u8fc7\u6dfb\u52a0docker\u7528\u6237\u7ec4\u6765\u5b9e\u73b0\u975eroot\u6743\u9650\u7528\u6237\u64cd\u4f5cdocker\u7684\u529f\u80fd\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cdocker\u7528\u6237\u7ec4\u5b9e\u8d28\u4e0a\u548croot\u7528\u6237\u662f\u4e00\u6837\u7684\uff0c\u56e0\u6b64\u5176\u5bf9\u7cfb\u7edf\u5b89\u5168\u7684\u5f71\u54cd\u4e5f\u662f\u4e00\u6837\u7684\u3002\u8981\u4f7f\u7528\u975eroot\u7528\u6237\u7ba1\u7406docker\u3002 \u9996\u5148\u521b\u5efa docker \u7528\u6237\u7ec4\uff1a sudo groupadd docker \u7136\u540e\u5c06\u5f53\u524d\u7528\u6237\u6dfb\u52a0\u5230 docker \u7528\u6237\u7ec4\u4e2d\uff1a sudo usermod -aG docker $USER \u6ce8\u9500\u5f53\u524d\u7528\u6237\u5e76\u91cd\u65b0\u767b\u5f55\uff08\u6216\u8005\u91cd\u542f\u7535\u8111\uff09\u540e\uff0c\u7528\u6237\u5373\u53ef\u88ab\u6dfb\u52a0\u5230 docker \u7528\u6237\u7ec4\u4e2d\u3002\u5728linux\u7cfb\u7edf\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5feb\u901f\u6fc0\u6d3b docker \u7528\u6237\u7ec4\u3002 newgrp docker","title":"\u516d\u3001Docker\u5bb9\u5668\u670d\u52a1"},{"location":"service/sit.html#docker_1","text":"\u4e0b\u8f7d Docker Compose \u7684\u5f53\u524d\u7a33\u5b9a\u7248\u672c\uff1a sudo curl -L \"https://github.com/docker/compose/releases/download/1.28.5/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose \u5c06\u53ef\u6267\u884c\u6743\u9650\u5e94\u7528\u4e8e\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a sudo chmod +x /usr/local/bin/docker-compose \u6d4b\u8bd5\u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a docker-compose --version","title":"\u4e03\u3001Docker\u5bb9\u5668\u7ba1\u7406"},{"location":"service/sit.html#tftp","text":"cat ftp.sh #!/bin/bash export JAVA_HOME=/root/ftp/jdk1.8.0_231/bin client_primary=/home/admin/www/njbank/wageftp client_success=/home/admin/www/njbank/wagepay for i in $(ls ${client_primary}) do date=$(echo \"$i\" | cut -d \"_\" -f 4 | cut -c 1-8) count=$(java -Desb.cfg.path=/root/ftp/TFTClient/config -jar /root/ftp/TFTClient/tftclient.jar -h 1 -dup -cf $client_primary/$i -sf $i) if [ $count -eq 0 ] ; then mkdir -p ${client_success}/$date mv $client_primary/$i $client_success/$date fi done Client\u6709\u4e09\u4e2a\u76ee\u5f55\uff1a\u4e34\u65f6\u76ee\u5f55\u3001\u4e0a\u4f20\u76ee\u5f55\u3001\u5907\u4efd\u76ee\u5f55 \u4ee3\u7801\u4f1a\u5728\u4e34\u65f6\u76ee\u5f55\u91cc\u9762\u751f\u6210\u5199\u5165\u7684\u6587\u4ef6\uff0c\u5f53\u6587\u4ef6\u5199\u5165\u5b8c\u6210\uff0c\u4ee3\u7801\u4f1a\u79fb\u52a8\u5230\u4e0a\u4f20\u76ee\u5f55\uff0cftp.sh\u811a\u672c\u4f1a\u5b9a\u65f6\u626b\u63cf\u4e0a\u4f20\u76ee\u5f55\u662f\u5426\u6709\u6587\u4ef6\uff0c\u5982\u679c\u6709\u5c31\u4e0a\u4f20\uff0c\u4e0a\u4f20\u6210\u529f\u7684\u540c\u65f6\u4f1a\u628a\u6587\u4ef6\u79fb\u52a8\u5230\u5907\u4efd\u76ee\u5f55 client_primary \u4e0a\u4f20\u6587\u4ef6\u76ee\u5f55\u7684\u8def\u5f84 client_success \u5907\u4efd\u76ee\u5f55\u8def\u5f84 \u8981\u6307\u5b9aJDK\u7684\u547d\u4ee4\u8def\u5f84,\u811a\u672c\u91cc\u9762\u53ef\u80fd\u627e\u4e0d\u5230java\u547d\u4ee4 export JAVA_HOME=/root/ftp/jdk1.8.0_231/bin Client\u5b89\u88c5\u5728/root/ftp/TFTClient/\u4e0b JAVA \u5728\u8c03\u53d6jar\u5305\u65f6\u662f\u8981\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84/root/ftp/TFTClient/tftclient.jar\u3001/root/ftp/TFTClient/config \u6bcf\u5206\u949f\u6267\u884cftp.sh\u811a\u672c * * * * * /bin/sh /root/ftp/ftp.sh","title":"\u516b\u3001TFTP\u6587\u4ef6\u670d\u52a1\u811a\u672c"},{"location":"service/sit.html#_1","text":"\u7528\u9014 \u6570\u636e\u7c7b\u578b \u6570\u636e\u5e93\u540d \u7528\u6237 \u5bc6\u7801 mysql \u4e1a\u52a1\u5e93 mysql sit_kayak_nanjingbank nanjing mongo \u4e1a\u52a1\u5e93 mongodb kayaknanjingbank nanjing mongo \u65e5\u5fd7 mongodblogs nanjingbanklogs nanjinglogs mongo \u5206\u6790\u5e93 nanjingbankdatacount nanjingbankdatacount nanjingdata mongo \u6d88\u606f\u5e93 nanjingbanknews nanjingbanknews nanjingnews mongo ids\u7edf\u4e00\u8ba4\u8bc1 nanjingbankids nanjingbankids nanjingids mongo \u7ecf\u653e\u85aa\u7406\u5e93 nanjingbankmanager nanjingbankmanager anjingmanager","title":"\u4e5d\u3001\u6570\u636e\u5e93\u4fe1\u606f"},{"location":"service/sit.html#python","text":"1\u3001python3.7\u73af\u5883\u5b89\u88c5 \u6ce8\u610f\uff1a\u9700\u8981root\u6743\u9650 \u67e5\u770bpython\u7248\u672c: python --version \u4e0b\u8f7dPython-3.7.10 wget https://www.python.org/ftp/python/3.7.10/Python-3.7.10.tgz \u538b\u7f29\u5305\u9644\u5e26\u8f6f\u4ef6\u5305 \u89e3\u538b tar zxvf Python-3.7.10.tgz \u66f4\u6539\u5de5\u4f5c\u76ee\u5f55 cd Python-3.7.10 \u5b89\u88c5\u7cfb\u7edf\u4f9d\u8d56 yum install zlib openssl- \u4fee\u6539\u5b89\u88c5\u6587\u4ef6 Python-3.7.10/Modules/Setup.dist \u627e\u5230SSL \u5177\u4f53\u884c\u6570\u4e3a211,\u6253\u5f00211-214\u884c\u7684\u6ce8\u91ca \u4fee\u6539SSL=/etc/ssl \u4fdd\u5b58\u8bb0\u5f55 \u7136\u540e\u786e\u8ba4\u4e0b\u8def\u5f84/etc/ssl \u8def\u5f84\u6709\u5185\u5bb9 \u4e0d\u9700\u8981\u81ea\u5df1\u521b\u5efa \u7cfb\u7edf\u9ed8\u8ba4\u5b89\u88c5\u6709\u7684 \u5b89\u88c5 ./configure --with-ssl make all make install make clean make distclean \u67e5\u770b\u7248\u672c\u4fe1\u606f /usr/local/bin/python3.7 -V \u5b89\u88c5\u4f9d\u8d56 pip3 install --no-index --find-links=/tmp/packages -r requirments.txt 2\u3001\u811a\u672c\u914d\u7f6e\u65b9\u6cd5 \u6570\u636e\u6307\u6807\u8ba1\u7b97 \u81ea\u52a8\u5316\u90e8\u7f72 \u7ecf\u7406\u6307\u6807\u6570\u636e\u8dd1\u6279\u90e8\u7f72\uff0c\u64cd\u4f5c\u6d41\u7a0b \u524d\u7f6e\u6761\u4ef6\uff1a \u670d\u52a1\u5668\u4e0a\u9700\u8981\u6309\u7167python3\u73af\u5883\u3001mongo\u73af\u5883 1.\u5c06 njcb \u6587\u4ef6\u5939\u62f7\u8d1d\u5230\u670d\u52a1\u5668\u5bf9\u5e94\u7528\u6237\u4e0b\uff0c\u4f4d\u7f6e\u81ea\u5b9a\u4e49 2.\u4fee\u6539\u4ee5\u4e0b\u4e24\u4e2a\u6587\u4ef6\u7684\u5bf9\u5e94\u53d8\u91cf \u3010\u4fee\u6539 python \u547d\u4ee4\u8def\u5f84\u3001mongodb \u547d\u4ee4\u8def\u5f84\u3001\u6570\u636e\u5e93\u5730\u5740\u3001\u7528\u6237\u76ee\u5f55\u7b49\uff0c\u8be6\u89c1\u4ee3\u7801\u6ce8\u91ca\u3011 \u2460/njcb/csv/csvlinux.py \u2461/njcb/count/countlinux.py 3.\u4fee\u6539\u5b8c\u4e4b\u540e \u6267\u884c\u2460csvlinux.py \u5bf9\u5e94\u751f\u6210 \u2462datacount_days.sh \u6267\u884c\u2461countlinux.py \u5bf9\u5e94\u751f\u6210 \u2463fxjl_days.sh \u2462\u2463\u811a\u672c\u5728 host_user \u53d8\u91cf\u6307\u5b9a\u76ee\u5f55\u4e0b\u751f\u6210 4.\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff0c\u6309\u987a\u5e8f\u6267\u884c\u811a\u672c \u2462datacount_days.sh\u3001\u2463fxjl_days.sh \u5e76\u4e14\u2462\u548c\u2463\u811a\u672c\u7684\u6267\u884c\u95f4\u9694\u4e00\u5c0f\u65f6(\u6839\u636e\u6570\u636e\u91cf\u5927\u5c0f\u8c03\u6574\u65f6\u95f4) windows \u5e73\u53f0\u4e0b\u6267\u884ccountwindows.py\u811a\u672c linux \u5e73\u53f0\u4e0b\u6267\u884ccountlinux.py\u811a\u672c \u73af\u5883\u8981\u6c42 linux\u3001window \u670d\u52a1\u73af\u5883\u4e0b\u5fc5\u987b\u5b89\u88c5mongodb\u6570\u636e\u5e93\u3001python3\u73af\u5883 \u914d\u7f6e\u4fee\u6539 1.\u4fee\u6539mongodb\u76f8\u5173\u914d\u7f6e mongo_path\uff1amongodb \u547d\u4ee4\uff0c\u73af\u5883\u53d8\u91cf\u6240\u5728\u7684\u76ee\u5f55 mongo_db_host\uff1amongodb \u6570\u636e\u5e93\u8fde\u63a5 mongo_db_host1\uff1amongodb \u6570\u636e\u5e93\u8fde\u63a5\uff08\u5907\u4efd\u8282\u70b91\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\uff0c\u5c06\u4e09\u4e2a\u914d\u7f6e\u6210\u4e00\u6837\uff09 mongo_db_host2\uff1amongodb \u6570\u636e\u5e93\u8fde\u63a5\uff08\u5907\u4efd\u8282\u70b92\uff09 mongo_db_user\uff1a\u6570\u636e\u5e93\u7528\u6237\u540d mongo_db_password\uff1a\u6570\u636e\u5e93\u5bc6\u7801 2.\u4fee\u6539python\u6267\u884c\u914d\u7f6e python_path\uff1apython\u547d\u4ee4\uff0c\u73af\u5883\u53d8\u91cf\u6240\u5728\u7684\u76ee\u5f55 3.\u4fee\u6539\u670d\u52a1\u5668\u4e3b\u76ee\u5f55 host_user\uff1awindow\u4e0b\uff0c\u4efb\u610f\u76ee\u5f55\u5373\u53ef\u3002linux\u73af\u5883\u4e0b\uff0c\u987b\u6307\u5b9ahome\u76ee\u5f55\u4e0b\u7528\u6237\u7684\u6839\u76ee\u5f55\uff0c\u4f8b\u5982:root\u7528\u6237\uff0c\u5219host_user=/home/root \u5b9a\u65f6\u4efb\u52a1\u914d\u7f6e \u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff1a\u5165\u53e3 fxjl_days.sh \u6587\u4ef6 \u5c06fxjl_days.sh \u811a\u672c\u914d\u7f6e\u6210\u5b9a\u65f6\u8dd1\u6279\u4efb\u52a1","title":"\u5341\u3001\u653e\u85aa\u7ecf\u7406\u540c\u6b65python\u811a\u672c\u5b9a\u65f6\u4efb\u52a1"},{"location":"service/sit.html#_2","text":"#!/bin/bash export JAVA_HOME=/root/ftp/jdk1.8.0_231 client_primary=/home/admin/www/upload/data_extracting/empsyn client_backup=/home/admin/www/upload/data_extracting/empsyn/backup for i in $(ls ${client_primary} | grep .csv) do count=$(java -Desb.cfg.path=/root/ftp/TFTClient/config -jar /root/ftp/TFTClient/tftclient.jar -h 1 -dup -cf $client_primary/$i -sf $i) if [ $count -eq 0 ] ; then mv $client_primary/$i $client_backup fi done","title":"\u5341\u4e00\u3001\u5458\u5de5\u4fe1\u606f\u540c\u6b65"},{"location":"tuning/docker.html","text":"\u6240\u6709\u64cd\u4f5c\u5747\u5728root\u7528\u4e0b\u8fdb\u884c\u64cd\u4f5c \u786e\u8ba4docker\u670d\u52a1\u76ee\u5f55 docker info \u627e\u5230Docker Root Dir\u9879\u76ee\uff0c\u76ee\u5f55\u662f\u5426\u4e3a/var/lib/docker \u4e00\u3001docker\u670d\u52a1\u9ed8\u8ba4\u76ee\u5f55\u8c03\u6574 1\u3001\u505c\u6b62docker\u670d\u52a1 systemctl stop docker 2\u3001\u62f7\u8d1d\u539fdocker\u5bb9\u5668\u76ee\u5f55\u6587\u4ef6\u5230\u65b0\u6302\u8f7d\u78c1\u76d8\u76ee\u5f55 cp -a /var/lib/docker /data/docker(\u81ea\u5b9a\u4e49\u76ee\u5f55) 3\u3001\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 vim /etc/docker/daemon.json \u6ca1\u6709\u53ef\u4ee5\u521b\u5efa { \"data-root\": \"/data/docker\" } 4\u3001\u91cd\u65b0\u542f\u52a8docker systemctl daemon-reload systemctl restart docker 5\u3001\u9a8c\u8bc1\u76ee\u5f55 docker info \u627e\u5230Docker Root Dir\u9879\u76ee\u786e\u8ba4\u76ee\u5f55\u4fee\u6539\u6210\u529f \u4e8c\u3001docker\u670d\u52a1\u914d\u7f6e\u4f18\u5316 1\u3001\u65b0\u589e\u65e5\u5fd7\u914d\u7f6e vim /etc/docker/daemon.json { \"log-driver\": \"json-file\", \"log-level\": \"warn\", \"log-opts\": { \"max-size\": \"2G\", \"max-file\": \"3\" } } 2\u3001\u91cd\u65b0\u542f\u52a8docker systemctl daemon-reload systemctl restart docker \u4e09\u3001docker\u670d\u52a1\u6700\u7ec8\u914d\u7f6e vim /etc/docker/daemon.json { \"max-concurrent-downloads\": 10, \"log-driver\": \"json-file\", \"log-level\": \"warn\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"3\" }, \"data-root\": \"/data/docker\" }","title":"docker\u670d\u52a1\u8c03\u4f18"},{"location":"tuning/docker.html#docker","text":"1\u3001\u505c\u6b62docker\u670d\u52a1 systemctl stop docker 2\u3001\u62f7\u8d1d\u539fdocker\u5bb9\u5668\u76ee\u5f55\u6587\u4ef6\u5230\u65b0\u6302\u8f7d\u78c1\u76d8\u76ee\u5f55 cp -a /var/lib/docker /data/docker(\u81ea\u5b9a\u4e49\u76ee\u5f55) 3\u3001\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 vim /etc/docker/daemon.json \u6ca1\u6709\u53ef\u4ee5\u521b\u5efa { \"data-root\": \"/data/docker\" } 4\u3001\u91cd\u65b0\u542f\u52a8docker systemctl daemon-reload systemctl restart docker 5\u3001\u9a8c\u8bc1\u76ee\u5f55 docker info \u627e\u5230Docker Root Dir\u9879\u76ee\u786e\u8ba4\u76ee\u5f55\u4fee\u6539\u6210\u529f","title":"\u4e00\u3001docker\u670d\u52a1\u9ed8\u8ba4\u76ee\u5f55\u8c03\u6574"},{"location":"tuning/docker.html#docker_1","text":"1\u3001\u65b0\u589e\u65e5\u5fd7\u914d\u7f6e vim /etc/docker/daemon.json { \"log-driver\": \"json-file\", \"log-level\": \"warn\", \"log-opts\": { \"max-size\": \"2G\", \"max-file\": \"3\" } } 2\u3001\u91cd\u65b0\u542f\u52a8docker systemctl daemon-reload systemctl restart docker","title":"\u4e8c\u3001docker\u670d\u52a1\u914d\u7f6e\u4f18\u5316"},{"location":"tuning/docker.html#docker_2","text":"vim /etc/docker/daemon.json { \"max-concurrent-downloads\": 10, \"log-driver\": \"json-file\", \"log-level\": \"warn\", \"log-opts\": { \"max-size\": \"10m\", \"max-file\": \"3\" }, \"data-root\": \"/data/docker\" }","title":"\u4e09\u3001docker\u670d\u52a1\u6700\u7ec8\u914d\u7f6e"}]}